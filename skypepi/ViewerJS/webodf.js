function Runtime(){}function BrowserRuntime(e){function t(e){var t,n,o=e.length,r=0;for(t=0;o>t;t+=1)n=e.charCodeAt(t),r+=1+(n>128)+(n>2048),n>55040&&57344>n&&(r+=1,t+=1);return r}function n(e,t,n){var o,r,i=e.length;for(t=new Uint8Array(new ArrayBuffer(t)),n?(t[0]=239,t[1]=187,t[2]=191,r=3):r=0,n=0;i>n;n+=1)o=e.charCodeAt(n),128>o?(t[r]=o,r+=1):2048>o?(t[r]=192|o>>>6,t[r+1]=128|63&o,r+=2):55040>=o||o>=57344?(t[r]=224|o>>>12&15,t[r+1]=128|o>>>6&63,t[r+2]=128|63&o,r+=3):(n+=1,o=(o-55296<<10|e.charCodeAt(n)-56320)+65536,t[r]=240|o>>>18&7,t[r+1]=128|o>>>12&63,t[r+2]=128|o>>>6&63,t[r+3]=128|63&o,r+=4);return t}function o(e){var t,n=e.length,o=new Uint8Array(new ArrayBuffer(n));for(t=0;n>t;t+=1)o[t]=255&e.charCodeAt(t);return o}function r(t,n){var o,r,i;void 0!==n?i=t:n=t,e?(r=e.ownerDocument,i&&(o=r.createElement("span"),o.className=i,o.appendChild(r.createTextNode(i)),e.appendChild(o),e.appendChild(r.createTextNode(" "))),o=r.createElement("span"),0<n.length&&"<"===n[0]?o.innerHTML=n:o.appendChild(r.createTextNode(n)),e.appendChild(o),e.appendChild(r.createElement("br"))):console&&console.log(n),l.enableAlerts&&"alert"===i&&alert(n)}function i(e,r,i){if(0!==i.status||i.responseText)if(200===i.status||0===i.status){if(i.response&&"string"!=typeof i.response)"binary"===r?(i=i.response,i=new Uint8Array(i)):i=String(i.response);else if("binary"===r)if(null!==i.responseBody&&"undefined"!==String(typeof VBArray)){i=new VBArray(i.responseBody).toArray();var a=i.length;for(r=new Uint8Array(new ArrayBuffer(a)),e=0;a>e;e+=1)r[e]=i[e];i=r}else{if((e=i.getResponseHeader("Content-Length"))&&(e=parseInt(e,10)),e&&e!==i.responseText.length)e:{a=i.responseText,r=!1;var s=t(a);if("number"==typeof e){if(e!==s&&e!==s+3){a=void 0;break e}r=s+3===e,s=e}a=n(a,s,r)}void 0===a&&(a=o(i.responseText)),i=a}else i=i.responseText;i={err:null,data:i}}else i={err:i.responseText||i.statusText,data:null};else i={err:"File "+e+" is empty.",data:null};return i}function a(e,t,n){var o=new XMLHttpRequest;return o.open("GET",e,n),o.overrideMimeType&&o.overrideMimeType("binary"!==t?"text/plain; charset="+t:"text/plain; charset=x-user-defined"),o}function s(e,t,n){var o=a(e,t,!0);o.onreadystatechange=function(){var r;4===o.readyState&&(r=i(e,t,o),n(r.err,r.data))};try{o.send(null)}catch(r){n(r.message,null)}}var l=this;this.byteArrayFromString=function(e,r){var i;return"utf8"===r?i=n(e,t(e),!1):("binary"!==r&&l.log("unknown encoding: "+r),i=o(e)),i},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.readFile=s,this.read=function(e,t,n,o){s(e,"binary",function(e,r){var i=null;if(r){if("string"==typeof r)throw"This should not happen.";i=r.subarray(t,t+n)}o(e,i)})},this.readFileSync=function(e,t){var n,o=a(e,t,!1);try{if(o.send(null),n=i(e,t,o),n.err)throw n.err;if(null===n.data)throw"No data read from "+e+"."}catch(r){throw r}return n.data},this.writeFile=function(e,t,n){var o,r=new XMLHttpRequest;r.open("PUT",e,!0),r.onreadystatechange=function(){4===r.readyState&&n(0!==r.status||r.responseText?200<=r.status&&300>r.status||0===r.status?null:"Status "+String(r.status)+": "+r.responseText||r.statusText:"File "+e+" is empty.")},o=t.buffer&&!r.sendAsBinary?t.buffer:l.byteArrayToString(t,"binary");try{r.sendAsBinary?r.sendAsBinary(o):r.send(o)}catch(i){l.log("HUH? "+i+" "+t),n(i.message)}},this.deleteFile=function(e,t){var n=new XMLHttpRequest;n.open("DELETE",e,!0),n.onreadystatechange=function(){4===n.readyState&&t(200>n.status&&300<=n.status?n.responseText:null)},n.send(null)},this.loadXML=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){4===n.readyState&&(0!==n.status||n.responseText?200===n.status||0===n.status?t(null,n.responseXML):t(n.responseText,null):t("File "+e+" is empty.",null))};try{n.send(null)}catch(o){t(o.message,null)}},this.log=r,this.enableAlerts=!0,this.assert=Runtime.assert,this.setTimeout=function(e,t){return setTimeout(function(){e()},t)},this.clearTimeout=function(e){clearTimeout(e)},this.libraryPaths=function(){return["lib"]},this.setCurrentDirectory=function(){},this.currentDirectory=function(){return""},this.type=function(){return"BrowserRuntime"},this.getDOMImplementation=function(){return window.document.implementation},this.parseXML=function(e){return(new DOMParser).parseFromString(e,"text/xml")},this.exit=function(e){r("Calling exit with code "+String(e)+", but exit() is not implemented.")},this.getWindow=function(){return window},this.requestAnimationFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,n=0;return t?(t.bind(window),n=t(e)):setTimeout(e,15)},this.cancelAnimationFrame=function(e){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;t?(t.bind(window),t(e)):clearTimeout(e)}}function NodeJSRuntime(){function e(e){var t,n=e.length,o=new Uint8Array(new ArrayBuffer(n));for(t=0;n>t;t+=1)o[t]=e[t];return o}function t(t,n,o){function r(n,r){return n?o(n,null):r?"string"==typeof r?o(n,r):void o(n,e(r)):o("No data for "+t+".",null)}t=a.resolve(s,t),"binary"!==n?i.readFile(t,n,r):i.readFile(t,null,r)}var n,o,r=this,i=require("fs"),a=require("path"),s="";this.byteArrayFromString=function(e,t){var n,o=new Buffer(e,t),r=o.length,i=new Uint8Array(new ArrayBuffer(r));for(n=0;r>n;n+=1)i[n]=o[n];return i},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.readFile=t,this.loadXML=function(e,n){t(e,"utf-8",function(t,o){return t?n(t,null):o?void n(null,r.parseXML(o)):n("No data for "+e+".",null)})},this.writeFile=function(e,t,n){t=new Buffer(t),e=a.resolve(s,e),i.writeFile(e,t,"binary",function(e){n(e||null)})},this.deleteFile=function(e,t){e=a.resolve(s,e),i.unlink(e,t)},this.read=function(t,n,o,r){t=a.resolve(s,t),i.open(t,"r+",666,function(t,a){if(t)r(t,null);else{var s=new Buffer(o);i.read(a,s,0,o,n,function(t){i.close(a),r(t,e(s))})}})},this.readFileSync=function(t,n){var o;if(o=i.readFileSync(t,"binary"===n?null:n),null===o)throw"File "+t+" could not be read.";return"binary"===n&&(o=e(o)),o},this.log=function(e,t){var n;void 0!==t?n=e:t=e,"alert"===n&&process.stderr.write("\n!!!!! ALERT !!!!!\n"),process.stderr.write(t+"\n"),"alert"===n&&process.stderr.write("!!!!! ALERT !!!!!\n")},this.assert=Runtime.assert,this.setTimeout=function(e,t){return setTimeout(function(){e()},t)},this.clearTimeout=function(e){clearTimeout(e)},this.libraryPaths=function(){return[__dirname]},this.setCurrentDirectory=function(e){s=e},this.currentDirectory=function(){return s},this.type=function(){return"NodeJSRuntime"},this.getDOMImplementation=function(){return o},this.parseXML=function(e){return n.parseFromString(e,"text/xml")},this.exit=process.exit,this.getWindow=function(){return null},this.requestAnimationFrame=function(e){return setTimeout(e,15)},this.cancelAnimationFrame=function(e){clearTimeout(e)},n=new(require("xmldom").DOMParser),o=r.parseXML("<a/>").implementation}function RhinoRuntime(){var e,t,n=this,o={},r=o.javax.xml.parsers.DocumentBuilderFactory.newInstance(),i="";r.setValidating(!1),r.setNamespaceAware(!0),r.setExpandEntityReferences(!1),r.setSchema(null),t=o.org.xml.sax.EntityResolver({resolveEntity:function(e,t){var n=new o.java.io.FileReader(t);return new o.org.xml.sax.InputSource(n)}}),e=r.newDocumentBuilder(),e.setEntityResolver(t),this.byteArrayFromString=function(e){var t,n=e.length,o=new Uint8Array(new ArrayBuffer(n));for(t=0;n>t;t+=1)o[t]=255&e.charCodeAt(t);return o},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.loadXML=function(t,n){var r=new o.java.io.File(t),i=null;try{i=e.parse(r)}catch(a){return print(a),n(a,null)}n(null,i)},this.readFile=function(e,t,r){i&&(e=i+"/"+e);var a=new o.java.io.File(e),s="binary"===t?"latin1":t;a.isFile()?((e=readFile(e,s))&&"binary"===t&&(e=n.byteArrayFromString(e,"binary")),r(null,e)):r(e+" is not a file.",null)},this.writeFile=function(e,t,n){i&&(e=i+"/"+e),e=new o.java.io.FileOutputStream(e);var r,a=t.length;for(r=0;a>r;r+=1)e.write(t[r]);e.close(),n(null)},this.deleteFile=function(e,t){i&&(e=i+"/"+e);var n=new o.java.io.File(e),r=e+Math.random(),r=new o.java.io.File(r);n.rename(r)?(r.deleteOnExit(),t(null)):t("Could not delete "+e)},this.read=function(e,t,n,r){i&&(e=i+"/"+e);var a;a=e;var s="binary";new o.java.io.File(a).isFile()?("binary"===s&&(s="latin1"),a=readFile(a,s)):a=null,a?r(null,this.byteArrayFromString(a.substring(t,t+n),"binary")):r("Cannot read "+e,null)},this.readFileSync=function(e,t){if(!t)return"";var n=readFile(e,t);if(null===n)throw"File could not be read.";return n},this.log=function(e,t){var n;void 0!==t?n=e:t=e,"alert"===n&&print("\n!!!!! ALERT !!!!!"),print(t),"alert"===n&&print("!!!!! ALERT !!!!!")},this.assert=Runtime.assert,this.setTimeout=function(e){return e(),0},this.clearTimeout=function(){},this.libraryPaths=function(){return["lib"]},this.setCurrentDirectory=function(e){i=e},this.currentDirectory=function(){return i},this.type=function(){return"RhinoRuntime"},this.getDOMImplementation=function(){return e.getDOMImplementation()},this.parseXML=function(t){return t=new o.java.io.StringReader(t),t=new o.org.xml.sax.InputSource(t),e.parse(t)},this.exit=quit,this.getWindow=function(){return null},this.requestAnimationFrame=function(e){return e(),0},this.cancelAnimationFrame=function(){}}function makeBase64(){function e(e){var t,n=e.length,o=new Uint8Array(new ArrayBuffer(n));for(t=0;n>t;t+=1)o[t]=255&e.charCodeAt(t);return o}function t(e){var t,n,o="",r=e.length-2;for(n=0;r>n;n+=3)t=e[n]<<16|e[n+1]<<8|e[n+2],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>18],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>12&63],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>6&63],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t];return n===r+1?(t=e[n]<<4,o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>6],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t],o+="=="):n===r&&(t=e[n]<<10|e[n+1]<<2,o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>12],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>6&63],o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t],o+="="),o}function n(e){e=e.replace(/[^A-Za-z0-9+\/]+/g,"");var t,n,o=e.length,r=new Uint8Array(new ArrayBuffer(3*o)),i=e.length%4,a=0;for(t=0;o>t;t+=4)n=(y[e.charAt(t)]||0)<<18|(y[e.charAt(t+1)]||0)<<12|(y[e.charAt(t+2)]||0)<<6|(y[e.charAt(t+3)]||0),r[a]=n>>16,r[a+1]=n>>8&255,r[a+2]=255&n,a+=3;return o=3*o-[0,0,2,1][i],r.subarray(0,o)}function o(e){var t,n,o=e.length,r=0,i=new Uint8Array(new ArrayBuffer(3*o));for(t=0;o>t;t+=1)n=e[t],128>n?i[r++]=n:(2048>n?i[r++]=192|n>>>6:(i[r++]=224|n>>>12&15,i[r++]=128|n>>>6&63),i[r++]=128|63&n);return i.subarray(0,r)}function r(e){var t,n,o,r,i=e.length,a=new Uint8Array(new ArrayBuffer(i)),s=0;for(t=0;i>t;t+=1)n=e[t],128>n?a[s++]=n:(t+=1,o=e[t],224>n?a[s++]=(31&n)<<6|63&o:(t+=1,r=e[t],a[s++]=(15&n)<<12|(63&o)<<6|63&r));return a.subarray(0,s)}function i(n){return t(e(n))}function a(e){return String.fromCharCode.apply(String,n(e))}function s(t){return r(e(t))}function l(e){e=r(e);for(var t="",n=0;n<e.length;)t+=String.fromCharCode.apply(String,e.subarray(n,n+45e3)),n+=45e3;return t}function u(e,t,n){var o,r,i,a="";for(i=t;n>i;i+=1)t=255&e.charCodeAt(i),128>t?a+=String.fromCharCode(t):(i+=1,o=255&e.charCodeAt(i),224>t?a+=String.fromCharCode((31&t)<<6|63&o):(i+=1,r=255&e.charCodeAt(i),a+=String.fromCharCode((15&t)<<12|(63&o)<<6|63&r)));return a}function c(e,t){function n(){var i=r+1e5;i>e.length&&(i=e.length),o+=u(e,r,i),r=i,i=r===e.length,t(o,i)&&!i&&runtime.setTimeout(n,0)}var o="",r=0;1e5>e.length?t(u(e,0,e.length),!0):("string"!=typeof e&&(e=e.slice()),n())}function d(t){return o(e(t))}function f(e){return String.fromCharCode.apply(String,o(e))}function p(t){return String.fromCharCode.apply(String,o(e(t)))}var m,g,h,b,y=function(e){var t,n,o={};for(t=0,n=e.length;n>t;t+=1)o[e.charAt(t)]=t;return o}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),v=runtime.getWindow();return v&&v.btoa?(h=v.btoa,m=function(e){return h(p(e))}):(h=i,m=function(e){return t(d(e))}),v&&v.atob?(b=v.atob,g=function(e){return e=b(e),u(e,0,e.length)}):(b=a,g=function(e){return l(n(e))}),core.Base64=function(){return this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=t,this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=n,this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=o,this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=r,this.convertUTF8StringToBase64=i,this.convertBase64ToUTF8String=a,this.convertUTF8StringToUTF16Array=s,this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=l,this.convertUTF8StringToUTF16String=c,this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=d,this.convertUTF16ArrayToUTF8String=f,this.convertUTF16StringToUTF8String=p,this.convertUTF16StringToBase64=m,this.convertBase64ToUTF16String=g,this.fromBase64=a,this.toBase64=i,this.atob=b,this.btoa=h,this.utob=p,this.btou=c,this.encode=m,this.encodeURI=function(e){return m(e).replace(/[+\/]/g,function(e){return"+"===e?"-":"_"}).replace(/\\=+$/,"")},this.decode=function(e){return g(e.replace(/[\-_]/g,function(e){return"-"===e?"+":"/"}))},this},core.Base64}function createXPathSingleton(){function e(e,t,n){return-1!==e&&(t>e||-1===t)&&(n>e||-1===n)}function t(t){for(var n,o=[],r=0,i=t.length;i>r;){var a=t,s=i,l=o,c="",d=[],f=a.indexOf("[",r),p=a.indexOf("/",r),m=a.indexOf("=",r);if(e(p,f,m)?(c=a.substring(r,p),r=p+1):e(f,p,m)?(c=a.substring(r,f),r=u(a,f,d)):e(m,p,f)?(c=a.substring(r,m),r=m):(c=a.substring(r,s),r=s),l.push({location:c,predicates:d}),i>r&&"="===t[r]){if(n=t.substring(r+1,i),2<n.length&&("'"===n[0]||'"'===n[0]))n=n.slice(1,n.length-1);else try{n=parseInt(n,10)}catch(g){}r=i}}return{steps:o,value:n}}function n(){var e=null,t=!1;this.setNode=function(t){e=t},this.reset=function(){t=!1},this.next=function(){var n=t?null:e;return t=!0,n}}function o(e,t,n){this.reset=function(){e.reset()},this.next=function(){for(var o=e.next();o&&(o.nodeType===Node.ELEMENT_NODE&&(o=o.getAttributeNodeNS(t,n)),!o);)o=e.next();return o}}function r(e,t){var n=e.next(),o=null;this.reset=function(){e.reset(),n=e.next(),o=null},this.next=function(){for(;n;){if(o)if(t&&o.firstChild)o=o.firstChild;else{for(;!o.nextSibling&&o!==n;)o=o.parentNode;o===n?n=e.next():o=o.nextSibling}else do(o=n.firstChild)||(n=e.next());while(n&&!o);if(o&&o.nodeType===Node.ELEMENT_NODE)return o}return null}}function i(e,t){this.reset=function(){e.reset()},this.next=function(){for(var n=e.next();n&&!t(n);)n=e.next();return n}}function a(e,t,n){t=t.split(":",2);var o=n(t[0]),r=t[1];return new i(e,function(e){return e.localName===r&&e.namespaceURI===o})}function s(e,t,o){var r=new n,a=l(r,t,o),s=t.value;return void 0===s?new i(e,function(e){return r.setNode(e),a.reset(),null!==a.next()}):new i(e,function(e){return r.setNode(e),a.reset(),(e=a.next())?e.nodeValue===s:!1})}var l,u;return u=function(e,n,o){for(var r=n,i=e.length,a=0;i>r;)"]"===e[r]?(a-=1,0>=a&&o.push(t(e.substring(n,r)))):"["===e[r]&&(0>=a&&(n=r+1),a+=1),r+=1;return r},l=function(e,t,n){var i,l,u,c;for(i=0;i<t.steps.length;i+=1){if(u=t.steps[i],l=u.location,""===l)e=new r(e,!1);else if("@"===l[0]){if(l=l.substr(1).split(":",2),c=n(l[0]),!c)throw"No namespace associated with the prefix "+l[0];e=new o(e,c,l[1])}else"."!==l&&(e=new r(e,!1),-1!==l.indexOf(":")&&(e=a(e,l,n)));for(l=0;l<u.predicates.length;l+=1)c=u.predicates[l],e=s(e,c,n)}return e},{getODFElementsWithXPath:function(e,o,r){var i=e.ownerDocument,a=[],s=null;if(i&&"function"==typeof i.evaluate)for(r=i.evaluate(o,e,r,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),s=r.iterateNext();null!==s;)s.nodeType===Node.ELEMENT_NODE&&a.push(s),s=r.iterateNext();else{for(a=new n,a.setNode(e),e=t(o),a=l(a,e,r),e=[],r=a.next();r;)e.push(r),r=a.next();a=e}return a}}}var webodf_version="0.5.4";Runtime.prototype.getVariable=function(){},Runtime.prototype.toJson=function(){},Runtime.prototype.fromJson=function(){},Runtime.prototype.byteArrayFromString=function(){},Runtime.prototype.byteArrayToString=function(){},Runtime.prototype.read=function(){},Runtime.prototype.readFile=function(){},Runtime.prototype.readFileSync=function(){},Runtime.prototype.loadXML=function(){},Runtime.prototype.writeFile=function(){},Runtime.prototype.deleteFile=function(){},Runtime.prototype.log=function(){},Runtime.prototype.setTimeout=function(){},Runtime.prototype.clearTimeout=function(){},Runtime.prototype.libraryPaths=function(){},Runtime.prototype.currentDirectory=function(){},Runtime.prototype.setCurrentDirectory=function(){},Runtime.prototype.type=function(){},Runtime.prototype.getDOMImplementation=function(){},Runtime.prototype.parseXML=function(){},Runtime.prototype.exit=function(){},Runtime.prototype.getWindow=function(){},Runtime.prototype.requestAnimationFrame=function(){},Runtime.prototype.cancelAnimationFrame=function(){},Runtime.prototype.assert=function(){};var IS_COMPILED_CODE=!0;Runtime.byteArrayToString=function(e,t){function n(e){var t,n="",o=e.length;for(t=0;o>t;t+=1)n+=String.fromCharCode(255&e[t]);return n}function o(e){var t,n,o,r,i,a="",s=e.length,l=[];for(t=0;s>t;t+=1)n=e[t],128>n?l.push(n):(t+=1,o=e[t],n>=194&&224>n?l.push((31&n)<<6|63&o):(t+=1,r=e[t],n>=224&&240>n?l.push((15&n)<<12|(63&o)<<6|63&r):(t+=1,i=e[t],n>=240&&245>n&&(n=(7&n)<<18|(63&o)<<12|(63&r)<<6|63&i,n-=65536,l.push((n>>10)+55296,(1023&n)+56320))))),1e3<=l.length&&(a+=String.fromCharCode.apply(null,l),l.length=0);return a+String.fromCharCode.apply(null,l)}var r;return"utf8"===t?r=o(e):("binary"!==t&&this.log("Unsupported encoding: "+t),r=n(e)),r},Runtime.getVariable=function(f){try{return eval(f)}catch(k){}},Runtime.toJson=function(e){return JSON.stringify(e)},Runtime.fromJson=function(e){return JSON.parse(e)},Runtime.getFunctionName=function(e){return void 0===e.name?(e=/function\s+(\w+)/.exec(e))&&e[1]:e.name},Runtime.assert=function(e,t){if(!e)throw this.log("alert","ASSERTION FAILED:\n"+t),Error(t)},Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime(window.document.getElementById("logoutput")):"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};!function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"}(),function(){function f(e,t,n){var o,r,i=e+"/manifest.json";runtime.log("Loading manifest: "+i);try{o=runtime.readFileSync(i,"utf-8")}catch(a){if(!n)throw console.log(String(a)),a;return void runtime.log("No loadable manifest found.")}n=JSON.parse(o);for(r in n)n.hasOwnProperty(r)&&(t[r]={dir:e,deps:n[r]})}function k(e,t,n){function o(e){if(!a[e]&&!n(e)){if(i[e])throw"Circular dependency detected for "+e+".";if(i[e]=!0,!t[e])throw"Missing dependency information for class "+e+".";var s,l=t[e],u=l.deps,c=u.length;for(s=0;c>s;s+=1)o(u[s]);i[e]=!1,a[e]=!0,r.push(l.dir+"/"+e.replace(".","/")+".js")}}var r=[],i={},a={};return e.forEach(o),r}function a(e,t){return t+("\n//# sourceURL="+e)}function d(d){var c,h;for(c=0;c<d.length;c+=1)h=runtime.readFileSync(d[c],"utf-8"),h=a(d[c],h),eval(h)}function c(e){e=e.split(".");var t,n=q,o=e.length;for(t=0;o>t;t+=1){if(!n.hasOwnProperty(e[t]))return!1;n=n[e[t]]}return!0}var h,q={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=function(e,t){if(IS_COMPILED_CODE||0===e.length)return t&&t();var n;if(!(n=h)){n=[];var o,r=runtime.libraryPaths();for(runtime.currentDirectory()&&-1===r.indexOf(runtime.currentDirectory())&&f(runtime.currentDirectory(),n,!0),o=0;o<r.length;o+=1)f(r[o],n)}if(h=n,e=k(e,h,c),0===e.length)return t&&t();if("BrowserRuntime"===runtime.type()&&t){n=e,r=document.currentScript||document.documentElement.lastChild,o=document.createDocumentFragment();var i,a;for(a=0;a<n.length;a+=1)i=document.createElement("script"),i.type="text/javascript",i.charset="utf-8",i.async=!1,i.setAttribute("src",n[a]),o.appendChild(i);t&&(i.onload=t),r.parentNode.insertBefore(o,r)}else d(e),t&&t()},runtime.loadClass=function(e,t){runtime.loadClasses([e],t)}}(),function(){var e=function(e){return e};runtime.getTranslator=function(){return e},runtime.setTranslator=function(t){e=t},runtime.tr=function(t){var n=e(t);return n&&"string"===String(typeof n)?n:t}}(),function(f){function k(a){if(a.length){var d=a[0];runtime.readFile(d,"utf8",function(c,h){function q(){var a;(a=eval(f))&&runtime.exit(a)}var p="",p=d.lastIndexOf("/"),f=h,p=-1!==p?d.substring(0,p):".";runtime.setCurrentDirectory(p),c?(runtime.log(c),runtime.exit(1)):null===f?(runtime.log("No code found for "+d),runtime.exit(1)):q.apply(null,a)})}}f=f?Array.prototype.slice.call(f):[],k("NodeJSRuntime"===runtime.type()?process.argv.slice(2):"RhinoRuntime"===runtime.type()?f:f.slice(1))}("undefined"!==String(typeof arguments)&&arguments),function(){core.Async=function(){return{forEach:function(e,t,n){function o(e){a!==i&&(e?(a=i,n(e)):(a+=1,a===i&&n(null)))}var r,i=e.length,a=0;for(r=0;i>r;r+=1)t(e[r],o)},destroyAll:function(e,t){function n(o,r){r?t(r):o<e.length?e[o](function(e){n(o+1,e)}):t()}n(0,void 0)}}}()}(),core.Base64=makeBase64(),core.ByteArray=function(e){this.pos=0,this.data=e,this.readUInt32LE=function(){this.pos+=4;var e=this.data,t=this.pos;return e[--t]<<24|e[--t]<<16|e[--t]<<8|e[--t]},this.readUInt16LE=function(){this.pos+=2;var e=this.data,t=this.pos;return e[--t]<<8|e[--t]}},core.ByteArrayWriter=function(e){function t(e){e>r-o&&(r=Math.max(2*r,o+e),e=new Uint8Array(new ArrayBuffer(r)),e.set(i),i=e)}var n=this,o=0,r=1024,i=new Uint8Array(new ArrayBuffer(r));this.appendByteArrayWriter=function(e){n.appendByteArray(e.getByteArray())},this.appendByteArray=function(e){var n=e.length;t(n),i.set(e,o),o+=n},this.appendArray=function(e){var n=e.length;t(n),i.set(e,o),o+=n},this.appendUInt16LE=function(e){n.appendArray([255&e,e>>8&255])},this.appendUInt32LE=function(e){n.appendArray([255&e,e>>8&255,e>>16&255,e>>24&255])},this.appendString=function(t){n.appendByteArray(runtime.byteArrayFromString(t,e))},this.getLength=function(){return o},this.getByteArray=function(){var e=new Uint8Array(new ArrayBuffer(o));return e.set(i.subarray(0,o)),e}},core.CSSUnits=function(){var e=this,t={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(e,n,o){return e*t[o]/t[n]},this.convertMeasure=function(t,n){var o,r;return t&&n&&(o=parseFloat(t),r=t.replace(o.toString(),""),o=e.convert(o,r,n)),o},this.getUnits=function(e){return e.substr(e.length-2,e.length)}},function(){function e(){var e,t,o,r,i,a,s,l,u;return void 0===n&&(t=(e=runtime.getWindow())&&e.document,a=t.documentElement,s=t.body,n={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},t&&(r=t.createElement("div"),r.style.position="absolute",r.style.left="-99999px",r.style.transform="scale(2)",r.style["-webkit-transform"]="scale(2)",i=t.createElement("div"),r.appendChild(i),s.appendChild(r),e=t.createRange(),e.selectNode(i),n.rangeBCRIgnoresElementBCR=0===e.getClientRects().length,i.appendChild(t.createTextNode("Rect transform test")),t=i.getBoundingClientRect(),o=e.getBoundingClientRect(),n.unscaledRangeClientRects=2<Math.abs(t.height-o.height),r.style.transform="",r.style["-webkit-transform"]="",t=a.style.overflow,o=s.style.overflow,l=s.style.height,u=s.scrollTop,a.style.overflow="visible",s.style.overflow="visible",s.style.height="200%",s.scrollTop=s.scrollHeight,n.elementBCRIgnoresBodyScroll=e.getBoundingClientRect().top!==i.getBoundingClientRect().top,s.scrollTop=u,s.style.height=l,s.style.overflow=o,a.style.overflow=t,e.detach(),s.removeChild(r),e=Object.keys(n).map(function(e){return e+":"+String(n[e])}).join(", "),runtime.log("Detected browser quirks - "+e))),n}function t(e,t,n){for(e=e?e.firstElementChild:null;e;){if(e.localName===n&&e.namespaceURI===t)return e;e=e.nextElementSibling}return null}var n;core.DomUtilsImpl=function(){function n(e,t){for(var n,o=0;e.parentNode!==t;)runtime.assert(null!==e.parentNode,"parent is null"),e=e.parentNode;for(n=t.firstChild;n!==e;)o+=1,n=n.nextSibling;return o}function o(e,t){return 0>=e.compareBoundaryPoints(Range.START_TO_START,t)&&0<=e.compareBoundaryPoints(Range.END_TO_END,t)}function r(e,t){return 0>=e.compareBoundaryPoints(Range.END_TO_START,t)&&0<=e.compareBoundaryPoints(Range.START_TO_END,t)}function i(e,t){var n=null;return e.nodeType===Node.TEXT_NODE&&(0===e.length?(e.parentNode.removeChild(e),t.nodeType===Node.TEXT_NODE&&(n=t)):(t.nodeType===Node.TEXT_NODE&&(e.appendData(t.data),t.parentNode.removeChild(t)),n=e)),n}function a(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);return t.removeChild(e),t}function s(e,t){for(var n,o=e.parentNode,r=e.firstChild;r;)n=r.nextSibling,s(r,t),r=n;return o&&t(e)&&a(e),o}function l(e,t){return e===t||Boolean(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function u(t,n){return e().unscaledRangeClientRects?t:t/n}function c(e,t,n){Object.keys(t).forEach(function(o){var r=o.split(":"),i=r[1],a=n(r[0]),r=t[o],s=typeof r;"object"===s?Object.keys(r).length&&(o=a?e.getElementsByTagNameNS(a,i)[0]||e.ownerDocument.createElementNS(a,o):e.getElementsByTagName(i)[0]||e.ownerDocument.createElement(o),e.appendChild(o),c(o,r,n)):a&&(runtime.assert("number"===s||"string"===s,"attempting to map unsupported type '"+s+"' (key: "+o+")"),e.setAttributeNS(a,o,String(r)))})}var d=null;this.splitBoundaries=function(e){var t,o,r,i,a=[];if(e.startContainer.nodeType===Node.TEXT_NODE||e.endContainer.nodeType===Node.TEXT_NODE){if(o=e.endContainer,r=e.endContainer.nodeType!==Node.TEXT_NODE?e.endOffset===e.endContainer.childNodes.length:!1,i=e.endOffset,t=e.endContainer,i<t.childNodes.length)for(t=t.childNodes.item(i),i=0;t.firstChild;)t=t.firstChild;else for(;t.lastChild;)t=t.lastChild,i=t.nodeType===Node.TEXT_NODE?t.textContent.length:t.childNodes.length;if(t===o&&(o=null),e.setEnd(t,i),i=e.endContainer,0!==e.endOffset&&i.nodeType===Node.TEXT_NODE&&(t=i,e.endOffset!==t.length&&(a.push(t.splitText(e.endOffset)),a.push(t))),i=e.startContainer,0!==e.startOffset&&i.nodeType===Node.TEXT_NODE&&(t=i,e.startOffset!==t.length&&(i=t.splitText(e.startOffset),a.push(t),a.push(i),e.setStart(i,0))),null!==o){for(i=e.endContainer;i.parentNode&&i.parentNode!==o;)i=i.parentNode;r=r?o.childNodes.length:n(i,o),e.setEnd(o,r)}}return a},this.containsRange=o,this.rangesIntersect=r,this.rangeIntersection=function(e,t){var n;return r(e,t)&&(n=e.cloneRange(),-1===e.compareBoundaryPoints(Range.START_TO_START,t)&&n.setStart(t.startContainer,t.startOffset),1===e.compareBoundaryPoints(Range.END_TO_END,t)&&n.setEnd(t.endContainer,t.endOffset)),n},this.getNodesInRange=function(e,t,n){var o=[],r=e.commonAncestorContainer,r=r.nodeType===Node.TEXT_NODE?r.parentNode:r;n=e.startContainer.ownerDocument.createTreeWalker(r,n,t,!1);var i,a;if(e.endContainer.childNodes[e.endOffset-1]?(i=e.endContainer.childNodes[e.endOffset-1],a=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(i=e.endContainer,a=Node.DOCUMENT_POSITION_PRECEDING),e.startContainer.childNodes[e.startOffset]?(e=e.startContainer.childNodes[e.startOffset],n.currentNode=e):e.startOffset===(e.startContainer.nodeType===Node.TEXT_NODE?e.startContainer.length:e.startContainer.childNodes.length)?(e=e.startContainer,n.currentNode=e,n.lastChild(),e=n.nextNode()):(e=e.startContainer,n.currentNode=e),e){if(e=n.currentNode,e!==r)for(e=e.parentNode;e&&e!==r;)t(e)===NodeFilter.FILTER_REJECT&&(n.currentNode=e),e=e.parentNode;switch(e=n.currentNode,t(e)){case NodeFilter.FILTER_REJECT:for(e=n.nextSibling();!e&&n.parentNode();)e=n.nextSibling();break;case NodeFilter.FILTER_SKIP:e=n.nextNode()}for(;e&&(t=i.compareDocumentPosition(e),0===t||0!==(t&a));)o.push(e),e=n.nextNode()}return o},this.normalizeTextNodes=function(e){e&&e.nextSibling&&(e=i(e,e.nextSibling)),e&&e.previousSibling&&i(e.previousSibling,e)},this.rangeContainsNode=function(e,t){var n,r=t.ownerDocument.createRange(),i=t.ownerDocument.createRange();return r.setStart(e.startContainer,e.startOffset),r.setEnd(e.endContainer,e.endOffset),i.selectNodeContents(t),n=o(r,i),r.detach(),i.detach(),n},this.mergeIntoParent=a,this.removeUnwantedNodes=s,this.getElementsByTagNameNS=function(e,t,n){var o=[];for(e=e.getElementsByTagNameNS(t,n),o.length=n=e.length,t=0;n>t;t+=1)o[t]=e.item(t);return o},this.getElementsByTagName=function(e,t){var n,o,r,i=[];for(n=e.getElementsByTagName(t),i.length=r=n.length,o=0;r>o;o+=1)i[o]=n.item(o);return i},this.containsNode=function(e,t){return e===t||e.contains(t)},this.comparePoints=function(e,t,o,r){if(e===o)return r-t;var i=e.compareDocumentPosition(o);return 2===i?i=-1:4===i?i=1:10===i?(t=n(e,o),i=r>t?1:-1):(r=n(o,e),i=t>r?-1:1),i},this.adaptRangeDifferenceToZoomLevel=u,this.translateRect=function(e,t,n){return{top:u(e.top-t.top,n),left:u(e.left-t.left,n),bottom:u(e.bottom-t.top,n),right:u(e.right-t.left,n),width:u(e.width,n),height:u(e.height,n)}},this.getBoundingClientRect=function(t){var n=t.ownerDocument,o=e(),r=n.body;if((!1===o.unscaledRangeClientRects||o.rangeBCRIgnoresElementBCR)&&t.nodeType===Node.ELEMENT_NODE)return t=t.getBoundingClientRect(),o.elementBCRIgnoresBodyScroll?{left:t.left+r.scrollLeft,right:t.right+r.scrollLeft,top:t.top+r.scrollTop,bottom:t.bottom+r.scrollTop,width:t.width,height:t.height}:t;var i;return d?i=d:d=i=n.createRange(),o=i,o.selectNode(t),o.getBoundingClientRect()},this.mapKeyValObjOntoNode=function(e,t,n){Object.keys(t).forEach(function(o){var r=o.split(":"),i=r[1],r=n(r[0]),a=t[o];r?(i=e.getElementsByTagNameNS(r,i)[0],i||(i=e.ownerDocument.createElementNS(r,o),e.appendChild(i)),i.textContent=a):runtime.log("Key ignored: "+o)})},this.removeKeyElementsFromNode=function(e,t,n){t.forEach(function(t){var o=t.split(":"),r=o[1];(o=n(o[0]))?(r=e.getElementsByTagNameNS(o,r)[0])?r.parentNode.removeChild(r):runtime.log("Element for "+t+" not found."):runtime.log("Property Name ignored: "+t)})},this.getKeyValRepresentationOfNode=function(e,t){for(var n,o={},r=e.firstElementChild;r;)(n=t(r.namespaceURI))&&(o[n+":"+r.localName]=r.textContent),r=r.nextElementSibling;return o},this.mapObjOntoNode=c,this.cloneEvent=function(e){var t=Object.create(null);return Object.keys(e).forEach(function(n){t[n]=e[n]}),t.prototype=e.constructor.prototype,t},this.getDirectChild=t,function(e){var t,n;n=runtime.getWindow(),null!==n&&(t=n.navigator.appVersion.toLowerCase(),n=-1===t.indexOf("chrome")&&(-1!==t.indexOf("applewebkit")||-1!==t.indexOf("safari")),t=-1!==t.indexOf("msie")||-1!==t.indexOf("trident"),n||t)&&(e.containsNode=l)}(this)},core.DomUtils=new core.DomUtilsImpl}(),core.Cursor=function(e,t){function n(e){e.parentNode&&(l.push(e.previousSibling),l.push(e.nextSibling),e.parentNode.removeChild(e))}function o(e,t,n){if(t.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(t),"putCursorIntoTextNode: invalid container");var o=t.parentNode;runtime.assert(Boolean(o),"putCursorIntoTextNode: container without parent"),runtime.assert(n>=0&&n<=t.length,"putCursorIntoTextNode: offset is out of bounds"),0===n?o.insertBefore(e,t):(n!==t.length&&t.splitText(n),o.insertBefore(e,t.nextSibling))}else t.nodeType===Node.ELEMENT_NODE&&t.insertBefore(e,t.childNodes.item(n));l.push(e.previousSibling),l.push(e.nextSibling)}var r,i,a=e.createElementNS("urn:webodf:names:cursor","cursor"),s=e.createElementNS("urn:webodf:names:cursor","anchor"),l=[],u=e.createRange(),c=core.DomUtils;this.getNode=function(){return a},this.getAnchorNode=function(){return s.parentNode?s:a
},this.getSelectedRange=function(){return i?(u.setStartBefore(a),u.collapse(!0)):(u.setStartAfter(r?s:a),u.setEndBefore(r?a:s)),u},this.setSelectedRange=function(e,t){u&&u!==e&&u.detach(),u=e,r=!1!==t,(i=e.collapsed)?(n(s),n(a),o(a,e.startContainer,e.startOffset)):(n(s),n(a),o(r?a:s,e.endContainer,e.endOffset),o(r?s:a,e.startContainer,e.startOffset)),l.forEach(c.normalizeTextNodes),l.length=0},this.hasForwardSelection=function(){return r},this.remove=function(){n(a),l.forEach(c.normalizeTextNodes),l.length=0},a.setAttributeNS("urn:webodf:names:cursor","memberId",t),s.setAttributeNS("urn:webodf:names:cursor","memberId",t)},core.Destroyable=function(){},core.Destroyable.prototype.destroy=function(){},core.EventSource=function(){},core.EventSource.prototype.subscribe=function(){},core.EventSource.prototype.unsubscribe=function(){},core.EventNotifier=function(e){function t(e){runtime.assert(!n.hasOwnProperty(e),'Duplicated event ids: "'+e+'" registered more than once.'),n[e]=[]}var n={};this.emit=function(e,t){var o,r;for(runtime.assert(n.hasOwnProperty(e),'unknown event fired "'+e+'"'),r=n[e],o=0;o<r.length;o+=1)r[o](t)},this.subscribe=function(e,t){runtime.assert(n.hasOwnProperty(e),'tried to subscribe to unknown event "'+e+'"'),n[e].push(t)},this.unsubscribe=function(e,t){var o;runtime.assert(n.hasOwnProperty(e),'tried to unsubscribe from unknown event "'+e+'"'),o=n[e].indexOf(t),runtime.assert(-1!==o,'tried to unsubscribe unknown callback from event "'+e+'"'),-1!==o&&n[e].splice(o,1)},this.register=t,e&&e.forEach(t)},core.ScheduledTask=function(e,t,n){function o(){a&&(n(i),a=!1)}function r(){o(),e.apply(void 0,s),s=null}var i,a=!1,s=[],l=!1;this.trigger=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),s=Array.prototype.slice.call(arguments),a||(a=!0,i=t(r))},this.triggerImmediate=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),s=Array.prototype.slice.call(arguments),r()},this.processRequests=function(){a&&r()},this.cancel=o,this.restart=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),o(),a=!0,i=t(r)},this.destroy=function(e){o(),l=!0,e()}},function(){var e;core.Task={},core.Task.SUPPRESS_MANUAL_PROCESSING=!1,core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||e.performRedraw()},core.Task.createRedrawTask=function(t){return new core.ScheduledTask(t,e.requestRedrawTask,e.cancelRedrawTask)},core.Task.createTimeoutTask=function(e,t){return new core.ScheduledTask(e,function(e){return runtime.setTimeout(e,t)},runtime.clearTimeout)},e=new function(){var e={};this.requestRedrawTask=function(t){var n=runtime.requestAnimationFrame(function(){t(),delete e[n]});return e[n]=t,n},this.performRedraw=function(){Object.keys(e).forEach(function(t){e[t](),runtime.cancelAnimationFrame(parseInt(t,10))}),e={}},this.cancelRedrawTask=function(t){runtime.cancelAnimationFrame(t),delete e[t]}}}(),core.EventSubscriptions=function(){function e(e,t,o){e.subscribe(t,o),n.push({eventSource:e,eventid:t,callback:o})}function t(){var e=[];n.forEach(function(e){e.eventSource.unsubscribe(e.eventid,e.callback)}),n.length=0,Object.keys(r).forEach(function(t){r[t].forEach(function(t){e.push(t.task.destroy)}),delete r[t]}),core.Async.destroyAll(e,function(){}),o=new core.EventNotifier}var n=[],o=new core.EventNotifier,r={},i=0;this.addSubscription=e,this.addFrameSubscription=function(t,n,a){var s,l,u,c;for(r.hasOwnProperty(n)||(r[n]=[]),u=r[n],c=0;c<u.length;c+=1)if(u[c].eventSource===t){s=u[c];break}s||(l="s"+i,i+=1,o.register(l),s={frameEventId:l,eventSource:t,task:core.Task.createRedrawTask(function(){o.emit(l,void 0)})},u.push(s),e(t,n,s.task.trigger)),o.subscribe(s.frameEventId,a)},this.unsubscribeAll=t,this.destroy=function(e){t(),e()}},core.LazyProperty=function(e){var t,n=!1;this.value=function(){return n||(t=e(),n=!0),t},this.reset=function(){n=!1}},core.LoopWatchDog=function(e,t){var n=Date.now(),o=0;this.check=function(){var r;if(e&&(r=Date.now(),r-n>e))throw runtime.log("alert","watchdog timeout"),"timeout!";if(t>0&&(o+=1,o>t))throw runtime.log("alert","watchdog loop overflow"),"loop overflow"}},core.NodeFilterChain=function(e){var t=NodeFilter.FILTER_REJECT,n=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(o){var r;for(r=0;r<e.length;r+=1)if(e[r].acceptNode(o)===t)return t;return n}},core.PositionIterator=function(e,t,n,o){function r(){this.acceptNode=function(e){return!e||e.nodeType===p&&0===e.length?h:g}}function i(e){this.acceptNode=function(t){return!t||t.nodeType===p&&0===t.length?h:e.acceptNode(t)}}function a(){var e=u.currentNode,t=e.nodeType;c=t===p?e.length-1:t===m?1:0}function s(){if(null===u.previousSibling()){if(!u.parentNode()||u.currentNode===e)return u.firstChild(),!1;c=0}else a();return!0}function l(){var t,n=u.currentNode;if(t=d(n),n!==e)for(n=n.parentNode;n&&n!==e;)d(n)===h&&(u.currentNode=n,t=h),n=n.parentNode;return t===h?(c=u.currentNode.nodeType===p?n.length:1,n=f.nextPosition()):n=t===g?!0:f.nextPosition(),n&&runtime.assert(d(u.currentNode)===g,"moveToAcceptedNode did not result in walker being on an accepted node"),n}var u,c,d,f=this,p=Node.TEXT_NODE,m=Node.ELEMENT_NODE,g=NodeFilter.FILTER_ACCEPT,h=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var t=u.currentNode,n=t.nodeType;if(t===e)return!1;if(0===c&&n===m)null===u.firstChild()&&(c=1);else if(n===p&&c+1<t.length)c+=1;else if(null!==u.nextSibling())c=0;else{if(!u.parentNode())return!1;c=1}return!0},this.previousPosition=function(){var t=!0,n=u.currentNode;return 0===c?t=s():n.nodeType===p?c-=1:null!==u.lastChild()?a():n===e?t=!1:c=0,t},this.previousNode=s,this.container=function(){var e=u.currentNode,t=e.nodeType;return 0===c&&t!==p&&(e=e.parentNode),e},this.rightNode=function(){var e=u.currentNode,t=e.nodeType;if(t===p&&c===e.length)for(e=e.nextSibling;e&&d(e)!==g;)e=e.nextSibling;else t===m&&1===c&&(e=null);return e},this.leftNode=function(){var e=u.currentNode;if(0===c)for(e=e.previousSibling;e&&d(e)!==g;)e=e.previousSibling;else if(e.nodeType===m)for(e=e.lastChild;e&&d(e)!==g;)e=e.previousSibling;return e},this.getCurrentNode=function(){return u.currentNode},this.unfilteredDomOffset=function(){if(u.currentNode.nodeType===p)return c;for(var e=0,t=u.currentNode,t=1===c?t.lastChild:t.previousSibling;t;)e+=1,t=t.previousSibling;return e},this.getPreviousSibling=function(){var e=u.currentNode,t=u.previousSibling();return u.currentNode=e,t},this.getNextSibling=function(){var e=u.currentNode,t=u.nextSibling();return u.currentNode=e,t},this.setPositionBeforeElement=function(e){return runtime.assert(Boolean(e),"setPositionBeforeElement called without element"),u.currentNode=e,c=0,l()},this.setUnfilteredPosition=function(e,t){return runtime.assert(Boolean(e),"PositionIterator.setUnfilteredPosition called without container"),u.currentNode=e,e.nodeType===p?(c=t,runtime.assert(t<=e.length,"Error in setPosition: "+t+" > "+e.length),runtime.assert(t>=0,"Error in setPosition: "+t+" < 0"),t===e.length&&(u.nextSibling()?c=0:u.parentNode()?c=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid."))):t<e.childNodes.length?(u.currentNode=e.childNodes.item(t),c=0):c=1,l()},this.moveToEnd=function(){u.currentNode=e,c=1},this.moveToEndOfNode=function(e){e.nodeType===p?f.setUnfilteredPosition(e,e.length):(u.currentNode=e,c=1)},this.isBeforeNode=function(){return 0===c},this.getNodeFilter=function(){return d},d=(n?new i(n):new r).acceptNode,d.acceptNode=d,t=t||NodeFilter.SHOW_ALL,runtime.assert(e.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes"),u=e.ownerDocument.createTreeWalker(e,t,d,o),c=0,null===u.firstChild()&&(c=1)},core.PositionFilter=function(){},core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3},core.PositionFilter.prototype.acceptPosition=function(){},core.PositionFilterChain=function(){var e=[],t=core.PositionFilter.FilterResult.FILTER_ACCEPT,n=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(o){var r;for(r=0;r<e.length;r+=1)if(e[r].acceptPosition(o)===n)return n;return t},this.addFilter=function(t){e.push(t)}},function(){core.RawInflate=function(){var e;return function(t){e=t()}(function(){return function e(t,n,o){function r(i){if(!n[i]){if(!t[i])throw Error("Cannot find module '"+i+"'");var a=n[i]={exports:{}};t[i][0].call(a.exports,function(e){var n=t[i][1][e];return r(n?n:e)},a,a.exports,e,t,n,o)}return n[i].exports}for(var i=0;i<o.length;i++)r(o[i]);return r}({1:[function(e,t,n){function o(e,t){var n=new d(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}var r=e("./zlib/inflate.js"),i=e("./utils/common"),a=e("./utils/strings"),s=e("./zlib/constants"),l=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),d=function(e){var t=this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});if(t.raw&&0<=t.windowBits&&16>t.windowBits&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&16>t.windowBits)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&48>t.windowBits&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0,e=r.inflateInit2(this.strm,t.windowBits),e!==s.Z_OK)throw Error(l[e]);this.header=new c,r.inflateGetHeader(this.strm,this.header)};d.prototype.push=function(e,t){var n,o,l,u,c,d=this.strm,f=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,d.input="string"==typeof e?a.binstring2buf(e):e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),n=r.inflate(d,s.Z_NO_FLUSH),n!==s.Z_STREAM_END&&n!==s.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0===d.avail_out||n===s.Z_STREAM_END||0===d.avail_in&&o===s.Z_FINISH)&&("string"===this.options.to?(l=a.utf8border(d.output,d.next_out),u=d.next_out-l,c=a.buf2string(d.output,l),d.next_out=u,d.avail_out=f-u,u&&i.arraySet(d.output,d.output,l,u,0),this.onData(c)):this.onData(i.shrinkBuf(d.output,d.next_out)))}while((0<d.avail_in||0===d.avail_out)&&n!==s.Z_STREAM_END);return n===s.Z_STREAM_END&&(o=s.Z_FINISH),o===s.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===s.Z_OK):!0},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===s.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=d,n.inflate=o,n.inflateRaw=function(e,t){return t=t||{},t.raw=!0,o(e,t)},n.ungzip=o},{"./utils/common":2,"./utils/strings":3,"./zlib/constants":5,"./zlib/gzheader":7,"./zlib/inflate.js":9,"./zlib/messages":11,"./zlib/zstream":12}],2:[function(e,t,n){e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,o,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+o),r);else for(var i=0;o>i;i++)e[r+i]=t[n+i]},flattenChunks:function(e){var t,n,o,r,i;for(t=o=0,n=e.length;n>t;t++)o+=e[t].length;for(i=new Uint8Array(o),t=o=0,n=e.length;n>t;t++)r=e[t],i.set(r,o),o+=r.length;return i}},r={arraySet:function(e,t,n,o,r){for(var i=0;o>i;i++)e[r+i]=t[n+i]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,r))},n.setTyped(e)},{}],3:[function(e,t,n){function o(e,t){if(65537>t&&(e.subarray&&a||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",o=0;t>o;o++)n+=String.fromCharCode(e[o]);return n}var r=e("./common"),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(s){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(l){a=!1}var u=new r.Buf8(256);for(e=0;256>e;e++)u[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;u[254]=u[254]=1,n.string2buf=function(e){var t,n,o,i,a,s=e.length,l=0;for(i=0;s>i;i++)n=e.charCodeAt(i),55296===(64512&n)&&s>i+1&&(o=e.charCodeAt(i+1),56320===(64512&o)&&(n=65536+(n-55296<<10)+(o-56320),i++)),l+=128>n?1:2048>n?2:65536>n?3:4;for(t=new r.Buf8(l),i=a=0;l>a;i++)n=e.charCodeAt(i),55296===(64512&n)&&s>i+1&&(o=e.charCodeAt(i+1),56320===(64512&o)&&(n=65536+(n-55296<<10)+(o-56320),i++)),128>n?t[a++]=n:(2048>n?t[a++]=192|n>>>6:(65536>n?t[a++]=224|n>>>12:(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63),t[a++]=128|n>>>6&63),t[a++]=128|63&n);return t},n.buf2binstring=function(e){return o(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,o=t.length;o>n;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,i,a,s=t||e.length,l=Array(2*s);for(n=r=0;s>n;)if(i=e[n++],128>i)l[r++]=i;else if(a=u[i],a>4)l[r++]=65533,n+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&s>n;)i=i<<6|63&e[n++],a--;a>1?l[r++]=65533:65536>i?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return o(l,r)},n.utf8border=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n||0===n?t:n+u[e[n]]>t?n:t}},{"./common":2}],4:[function(e,t){t.exports=function(e,t,n,o){var r=65535&e|0;e=e>>>16&65535|0;for(var i=0;0!==n;){i=n>2e3?2e3:n,n-=i;do r=r+t[o++]|0,e=e+r|0;while(--i);r%=65521,e%=65521}return r|e<<16|0}},{}],5:[function(e,t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],6:[function(e,t){var n=function(){for(var e,t=[],n=0;256>n;n++){e=n;for(var o=0;8>o;o++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,o,r){for(o=r+o,e^=-1;o>r;r++)e=e>>>8^n[255&(e^t[r])];return-1^e}},{}],7:[function(e,t){t.exports=function(){this.os=this.xflags=this.time=this.text=0,this.extra=null,this.extra_len=0,this.comment=this.name="",this.hcrc=0,this.done=!1}},{}],8:[function(e,t){t.exports=function(e,t){var n,o,r,i,a,s,l,u,c,d,f,p,m,g,h,b,y,v,S,N,C,x,E,w;n=e.state,o=e.next_in,E=e.input,r=o+(e.avail_in-5),i=e.next_out,w=e.output,a=i-(t-e.avail_out),s=i+(e.avail_out-257),l=n.dmax,u=n.wsize,c=n.whave,d=n.wnext,f=n.window,p=n.hold,m=n.bits,g=n.lencode,h=n.distcode,b=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do t:for(15>m&&(p+=E[o++]<<m,m+=8,p+=E[o++]<<m,m+=8),v=g[p&b];;){if(S=v>>>24,p>>>=S,m-=S,S=v>>>16&255,0===S)w[i++]=65535&v;else{if(!(16&S)){if(0===(64&S)){v=g[(65535&v)+(p&(1<<S)-1)];continue t}32&S?n.mode=12:(e.msg="invalid literal/length code",n.mode=30);break e}N=65535&v,(S&=15)&&(S>m&&(p+=E[o++]<<m,m+=8),N+=p&(1<<S)-1,p>>>=S,m-=S),15>m&&(p+=E[o++]<<m,m+=8,p+=E[o++]<<m,m+=8),v=h[p&y];n:for(;;){if(S=v>>>24,p>>>=S,m-=S,S=v>>>16&255,!(16&S)){if(0===(64&S)){v=h[(65535&v)+(p&(1<<S)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(v&=65535,S&=15,S>m&&(p+=E[o++]<<m,m+=8,S>m&&(p+=E[o++]<<m,m+=8)),v+=p&(1<<S)-1,v>l){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=S,m-=S,S=i-a,v>S){if(S=v-S,S>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,x=f,0===d){if(C+=u-S,N>S){N-=S;do w[i++]=f[C++];while(--S);C=i-v,x=w}}else if(S>d){if(C+=u+d-S,S-=d,N>S){N-=S;do w[i++]=f[C++];while(--S);if(C=0,N>d){S=d,N-=S;do w[i++]=f[C++];while(--S);C=i-v,x=w}}}else if(C+=d-S,N>S){N-=S;do w[i++]=f[C++];while(--S);C=i-v,x=w}for(;N>2;)w[i++]=x[C++],w[i++]=x[C++],w[i++]=x[C++],N-=3;N&&(w[i++]=x[C++],N>1&&(w[i++]=x[C++]))}else{C=i-v;do w[i++]=w[C++],w[i++]=w[C++],w[i++]=w[C++],N-=3;while(N>2);N&&(w[i++]=w[C++],N>1&&(w[i++]=w[C++]))}break}}break}while(r>o&&s>i);N=m>>3,o-=N,m-=N<<3,e.next_in=o,e.next_out=i,e.avail_in=r>o?5+(r-o):5-(o-r),e.avail_out=s>i?257+(s-i):257-(i-s),n.hold=p&(1<<m)-1,n.bits=m}},{}],9:[function(e,t,n){function o(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.total=this.check=this.dmax=this.flags=0,this.head=null,this.wnext=this.whave=this.wsize=this.wbits=0,this.window=null,this.extra=this.offset=this.length=this.bits=this.hold=0,this.distcode=this.lencode=null,this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.distdyn=this.lendyn=null,this.was=this.back=this.sane=0}function i(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=y,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new d.Buf32(v),t.distcode=t.distdyn=new d.Buf32(S),t.sane=1,t.back=-1,h):b}function a(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,i(e)):b}function s(e,t){var n,o;return e&&e.state?(o=e.state,0>t?(n=0,t=-t):(n=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||t>15)?b:(null!==o.window&&o.wbits!==t&&(o.window=null),o.wrap=n,o.wbits=t,a(e))):b}function l(e,t){var n;return e?(n=new r,e.state=n,n.window=null,n=s(e,t),n!==h&&(e.state=null),n):b}var u,c,d=e("../utils/common"),f=e("./adler32"),p=e("./crc32"),m=e("./inffast"),g=e("./inftrees"),h=0,b=-2,y=1,v=852,S=592,N=!0;n.inflateReset=a,n.inflateReset2=s,n.inflateResetKeep=i,n.inflateInit=function(e){return l(e,15)},n.inflateInit2=l,n.inflate=function(e,t){var n,r,i,a,s,l,v,S,C,x,E,w,T,O;w=0;var A,R,P,D,k,I=new d.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return b;n=e.state,12===n.mode&&(n.mode=13),s=e.next_out,i=e.output,v=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,S=n.hold,C=n.bits,x=l,E=v,k=h;e:for(;;)switch(n.mode){case y:if(0===n.wrap){n.mode=13;break}for(;16>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}if(2&n.wrap&&35615===S){n.check=0,I[0]=255&S,I[1]=S>>>8&255,n.check=p(n.check,I,2,0),C=S=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&S)<<8)+(S>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!==(15&S)){e.msg="unknown compression method",n.mode=30;break}if(S>>>=4,C-=4,T=(15&S)+8,0===n.wbits)n.wbits=T;else if(T>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<T,e.adler=n.check=1,n.mode=512&S?10:12,C=S=0;break;case 2:for(;16>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}if(n.flags=S,8!==(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=S>>8&1),512&n.flags&&(I[0]=255&S,I[1]=S>>>8&255,n.check=p(n.check,I,2,0)),C=S=0,n.mode=3;case 3:for(;32>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}n.head&&(n.head.time=S),512&n.flags&&(I[0]=255&S,I[1]=S>>>8&255,I[2]=S>>>16&255,I[3]=S>>>24&255,n.check=p(n.check,I,4,0)),C=S=0,n.mode=4;case 4:for(;16>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}n.head&&(n.head.xflags=255&S,n.head.os=S>>8),512&n.flags&&(I[0]=255&S,I[1]=S>>>8&255,n.check=p(n.check,I,2,0)),C=S=0,n.mode=5;case 5:if(1024&n.flags){for(;16>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}n.length=S,n.head&&(n.head.extra_len=S),512&n.flags&&(I[0]=255&S,I[1]=S>>>8&255,n.check=p(n.check,I,2,0)),C=S=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(w=n.length,w>l&&(w=l),w&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=Array(n.head.extra_len)),d.arraySet(n.head.extra,r,a,w,T)),512&n.flags&&(n.check=p(n.check,r,w,a)),l-=w,a+=w,n.length-=w),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===l)break e;w=0;do T=r[a+w++],n.head&&T&&65536>n.length&&(n.head.name+=String.fromCharCode(T));while(T&&l>w);if(512&n.flags&&(n.check=p(n.check,r,w,a)),l-=w,a+=w,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===l)break e;w=0;do T=r[a+w++],n.head&&T&&65536>n.length&&(n.head.comment+=String.fromCharCode(T));while(T&&l>w);if(512&n.flags&&(n.check=p(n.check,r,w,a)),l-=w,a+=w,T)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;16>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}if(S!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}C=S=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;32>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}e.adler=n.check=o(S),C=S=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=s,e.avail_out=v,e.next_in=a,e.avail_in=l,n.hold=S,n.bits=C,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){S>>>=7&C,C-=7&C,n.mode=27;break}for(;3>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}switch(n.last=1&S,S>>>=1,C-=1,3&S){case 0:n.mode=14;break;case 1:if(w=n,N){for(T=void 0,u=new d.Buf32(512),c=new d.Buf32(32),T=0;144>T;)w.lens[T++]=8;for(;256>T;)w.lens[T++]=9;for(;280>T;)w.lens[T++]=7;for(;288>T;)w.lens[T++]=8;for(g(1,w.lens,0,288,u,0,w.work,{bits:9}),T=0;32>T;)w.lens[T++]=5;g(2,w.lens,0,32,c,0,w.work,{bits:5}),N=!1}if(w.lencode=u,w.lenbits=9,w.distcode=c,w.distbits=5,n.mode=20,6===t){S>>>=2,C-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}S>>>=2,C-=2;break;case 14:for(S>>>=7&C,C-=7&C;32>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}if((65535&S)!==(S>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&S,C=S=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(w=n.length){if(w>l&&(w=l),w>v&&(w=v),0===w)break e;d.arraySet(i,r,a,w,s),l-=w,a+=w,v-=w,s+=w,n.length-=w;break}n.mode=12;break;case 17:for(;14>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}if(n.nlen=(31&S)+257,S>>>=5,C-=5,n.ndist=(31&S)+1,S>>>=5,C-=5,n.ncode=(15&S)+4,S>>>=4,C-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;3>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}n.lens[F[n.have++]]=7&S,S>>>=3,C-=3}for(;19>n.have;)n.lens[F[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,w={bits:n.lenbits},k=g(0,n.lens,0,19,n.lencode,0,n.work,w),n.lenbits=w.bits,k){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;w=n.lencode[S&(1<<n.lenbits)-1],A=w>>>24,R=w>>>16&255,P=65535&w,!(C>=A);){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}if(16>P)S>>>=A,C-=A,n.lens[n.have++]=P;else{if(16===P){for(w=A+2;w>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}if(S>>>=A,C-=A,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}T=n.lens[n.have-1],w=3+(3&S),S>>>=2,C-=2}else if(17===P){for(w=A+3;w>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}S>>>=A,C-=A,T=0,w=3+(7&S),S>>>=3,C-=3}else{for(w=A+7;w>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}S>>>=A,C-=A,T=0,w=11+(127&S),S>>>=7,C-=7}if(n.have+w>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;w--;)n.lens[n.have++]=T}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,w={bits:n.lenbits},k=g(1,n.lens,0,n.nlen,n.lencode,0,n.work,w),n.lenbits=w.bits,k){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,w={bits:n.distbits},k=g(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,w),n.distbits=w.bits,k){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(l>=6&&v>=258){e.next_out=s,e.avail_out=v,e.next_in=a,e.avail_in=l,n.hold=S,n.bits=C,m(e,E),s=e.next_out,i=e.output,v=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,S=n.hold,C=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;w=n.lencode[S&(1<<n.lenbits)-1],A=w>>>24,R=w>>>16&255,P=65535&w,!(C>=A);){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}if(R&&0===(240&R)){for(T=A,O=R,D=P;w=n.lencode[D+((S&(1<<T+O)-1)>>T)],A=w>>>24,R=w>>>16&255,P=65535&w,!(C>=T+A);){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}S>>>=T,C-=T,n.back+=T}if(S>>>=A,C-=A,n.back+=A,n.length=P,0===R){n.mode=26;break}if(32&R){n.back=-1,n.mode=12;break}if(64&R){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&R,n.mode=22;case 22:if(n.extra){for(w=n.extra;w>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}n.length+=S&(1<<n.extra)-1,S>>>=n.extra,C-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;w=n.distcode[S&(1<<n.distbits)-1],A=w>>>24,R=w>>>16&255,P=65535&w,!(C>=A);){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}if(0===(240&R)){for(T=A,O=R,D=P;w=n.distcode[D+((S&(1<<T+O)-1)>>T)],A=w>>>24,R=w>>>16&255,P=65535&w,!(C>=T+A);){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}S>>>=T,C-=T,n.back+=T}if(S>>>=A,C-=A,n.back+=A,64&R){e.msg="invalid distance code",n.mode=30;break}n.offset=P,n.extra=15&R,n.mode=24;case 24:if(n.extra){for(w=n.extra;w>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}n.offset+=S&(1<<n.extra)-1,S>>>=n.extra,C-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===v)break e;if(w=E-v,n.offset>w){if(w=n.offset-w,w>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}w>n.wnext?(w-=n.wnext,T=n.wsize-w):T=n.wnext-w,w>n.length&&(w=n.length),O=n.window}else O=i,T=s-n.offset,w=n.length;w>v&&(w=v),v-=w,n.length-=w;do i[s++]=O[T++];while(--w);0===n.length&&(n.mode=21);break;case 26:if(0===v)break e;i[s++]=n.length,v--,n.mode=21;break;case 27:if(n.wrap){for(;32>C;){if(0===l)break e;l--,S|=r[a++]<<C,C+=8}if(E-=v,e.total_out+=E,n.total+=E,E&&(e.adler=n.check=n.flags?p(n.check,i,E,s-E):f(n.check,i,E,s-E)),E=v,(n.flags?S:o(S))!==n.check){e.msg="incorrect data check",n.mode=30;break}C=S=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;32>C;){if(0===l)break e;l--,S+=r[a++]<<C,C+=8}if(S!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}C=S=0}n.mode=29;case 29:k=1;break e;case 30:k=-3;break e;case 31:return-4;default:return b}return e.next_out=s,e.avail_out=v,e.next_in=a,e.avail_in=l,n.hold=S,n.bits=C,(n.wsize||E!==e.avail_out&&30>n.mode&&(27>n.mode||4!==t))&&(r=e.output,a=e.next_out,s=E-e.avail_out,v=e.state,null===v.window&&(v.wsize=1<<v.wbits,v.wnext=0,v.whave=0,v.window=new d.Buf8(v.wsize)),s>=v.wsize?(d.arraySet(v.window,r,a-v.wsize,v.wsize,0),v.wnext=0,v.whave=v.wsize):(l=v.wsize-v.wnext,l>s&&(l=s),d.arraySet(v.window,r,a-s,l,v.wnext),(s-=l)?(d.arraySet(v.window,r,a-s,s,0),v.wnext=s,v.whave=v.wsize):(v.wnext+=l,v.wnext===v.wsize&&(v.wnext=0),v.whave<v.wsize&&(v.whave+=l)))),x-=e.avail_in,E-=e.avail_out,e.total_in+=x,e.total_out+=E,n.total+=E,n.wrap&&E&&(e.adler=n.check=n.flags?p(n.check,i,E,e.next_out-E):f(n.check,i,E,e.next_out-E)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===x&&0===E||4===t)&&k===h&&(k=-5),k},n.inflateEnd=function(e){if(!e||!e.state)return b;var t=e.state;return t.window&&(t.window=null),e.state=null,h},n.inflateGetHeader=function(e,t){var n;return e&&e.state?(n=e.state,0===(2&n.wrap)?b:(n.head=t,t.done=!1,h)):b},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":2,"./adler32":4,"./crc32":6,"./inffast":8,"./inftrees":10}],10:[function(e,t){var n=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],i=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,s,l,u,c,d,f){for(var p,m,g,h,b,y,v=f.bits,S=0,N=0,C=0,x=0,E=0,w=0,T=0,O=0,A=0,R=0,P=null,D=0,k=new n.Buf16(16),w=new n.Buf16(16),I=null,F=0,S=0;15>=S;S++)k[S]=0;for(N=0;l>N;N++)k[t[s+N]]++;for(E=v,x=15;x>=1&&0===k[x];x--);if(E>x&&(E=x),0===x)return u[c++]=20971520,u[c++]=20971520,f.bits=1,0;for(C=1;x>C&&0===k[C];C++);for(C>E&&(E=C),S=O=1;15>=S;S++)if(O<<=1,O-=k[S],0>O)return-1;if(O>0&&(0===e||1!==x))return-1;for(w[1]=0,S=1;15>S;S++)w[S+1]=w[S]+k[S];for(N=0;l>N;N++)0!==t[s+N]&&(d[w[t[s+N]]++]=N);switch(e){case 0:P=I=d,g=19;break;case 1:P=o,D-=257,I=r,F-=257,g=256;break;default:P=i,I=a,g=-1}if(N=R=0,S=C,v=c,w=E,T=0,m=-1,A=1<<E,l=A-1,1===e&&A>852||2===e&&A>592)return 1;for(var M=0;;){M++,h=S-T,d[N]<g?(b=0,y=d[N]):d[N]>g?(b=I[F+d[N]],y=P[D+d[N]]):(b=96,y=0),O=1<<S-T,C=p=1<<w;do p-=O,u[v+(R>>T)+p]=h<<24|b<<16|y|0;while(0!==p);for(O=1<<S-1;R&O;)O>>=1;if(0!==O?(R&=O-1,R+=O):R=0,N++,0===--k[S]){if(S===x)break;S=t[s+d[N]]}if(S>E&&(R&l)!==m){for(0===T&&(T=E),v+=C,w=S-T,O=1<<w;x>w+T&&(O-=k[w+T],!(0>=O));)w++,O<<=1;if(A+=1<<w,1===e&&A>852||2===e&&A>592)return 1;m=R&l,u[m]=E<<24|w<<16|v-c|0}}return 0!==R&&(u[v+R]=S-T<<24|4194304),f.bits=E,0}},{"../utils/common":2}],11:[function(e,t){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],12:[function(e,t){t.exports=function(){this.input=null,this.total_in=this.avail_in=this.next_in=0,this.output=null,this.total_out=this.avail_out=this.next_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[1])(1)}),{inflate:function(t){return e.inflateRaw(t)}}}()}(),core.StepDirection={PREVIOUS:1,NEXT:2},core.StepIterator=function(e,t){function n(){u=null,d=c=void 0}function o(){return void 0===d&&(d=e.acceptPosition(t)===f),d}function r(e,o){return n(),t.setUnfilteredPosition(e,o)}function i(){return u||(u=t.container()),u}function a(){return void 0===c&&(c=t.unfilteredDomOffset()),c}function s(){for(n();t.nextPosition();)if(n(),o())return!0;return!1}function l(){for(n();t.previousPosition();)if(n(),o())return!0;return!1}var u,c,d,f=core.PositionFilter.FilterResult.FILTER_ACCEPT,p=core.StepDirection.NEXT;this.isStep=o,this.setPosition=r,this.container=i,this.offset=a,this.nextStep=s,this.previousStep=l,this.advanceStep=function(e){return e===p?s():l()},this.roundToClosestStep=function(){var e,t,n=o();return n||(e=i(),t=a(),n=l(),n||(r(e,t),n=s())),n},this.roundToPreviousStep=function(){var e=o();return e||(e=l()),e},this.roundToNextStep=function(){var e=o();return e||(e=s()),e},this.leftNode=function(){return t.leftNode()},this.snapshot=function(){return new core.StepIterator.StepSnapshot(i(),a())},this.restore=function(e){r(e.container,e.offset)}},core.StepIterator.StepSnapshot=function(e,t){this.container=e,this.offset=t},core.UnitTest=function(){},core.UnitTest.prototype.setUp=function(){},core.UnitTest.prototype.tearDown=function(){},core.UnitTest.prototype.description=function(){},core.UnitTest.prototype.tests=function(){},core.UnitTest.prototype.asyncTests=function(){},core.UnitTest.provideTestAreaDiv=function(){var e=runtime.getWindow().document,t=e.getElementById("testarea");return runtime.assert(!t,'Unclean test environment, found a div with id "testarea".'),t=e.createElement("div"),t.setAttribute("id","testarea"),e.body.appendChild(t),t},core.UnitTest.cleanupTestAreaDiv=function(){var e=runtime.getWindow().document,t=e.getElementById("testarea");runtime.assert(!!t&&t.parentNode===e.body,'Test environment broken, found no div with id "testarea" below body.'),e.body.removeChild(t)},core.UnitTest.createXmlDocument=function(e,t,n){var o="<?xml version='1.0' encoding='UTF-8'?>",o=o+("<"+e);return Object.keys(n).forEach(function(e){o+=" xmlns:"+e+'="'+n[e]+'"'}),o+=">",o+=t,o+="</"+e+">",runtime.parseXML(o)},core.UnitTest.createOdtDocument=function(e,t){return core.UnitTest.createXmlDocument("office:document",e,t)},core.UnitTestLogger=function(){var e=[],t=0,n=0,o="",r="";this.startTest=function(i,a){e=[],t=0,o=i,r=a,n=Date.now()},this.endTest=function(){var i=Date.now();return{description:r,suite:[o,r],success:0===t,log:e,time:i-n}},this.debug=function(t){e.push({category:"debug",message:t})},this.fail=function(n){t+=1,e.push({category:"fail",message:n})},this.pass=function(t){e.push({category:"pass",message:t})
}},core.UnitTestRunner=function(f,k){function a(t){l+=1,e?k.debug(t):k.fail(t)}function d(e,t){var n;try{if(e.length!==t.length)return a("array of length "+e.length+" should be "+t.length+" long"),!1;for(n=0;n<e.length;n+=1)if(e[n]!==t[n])return a(e[n]+" should be "+t[n]+" at array index "+n),!1}catch(o){return!1}return!0}function c(e,t,n){var o,r,i,s=e.attributes,l=s.length;for(o=0;l>o;o+=1)if(r=s.item(o),"xmlns"!==r.prefix&&"urn:webodf:names:steps"!==r.namespaceURI){if(i=t.getAttributeNS(r.namespaceURI,r.localName),!t.hasAttributeNS(r.namespaceURI,r.localName))return a("Attribute "+r.localName+" with value "+r.value+" was not present"),!1;if(i!==r.value)return a("Attribute "+r.localName+" was "+i+" should be "+r.value),!1}return n?!0:c(t,e,!0)}function h(e,t){var n,o;if(n=e.nodeType,o=t.nodeType,n!==o)return a("Nodetype '"+n+"' should be '"+o+"'"),!1;if(n===Node.TEXT_NODE)return e.data===t.data?!0:(a("Textnode data '"+e.data+"' should be '"+t.data+"'"),!1);if(runtime.assert(n===Node.ELEMENT_NODE,"Only textnodes and elements supported."),e.namespaceURI!==t.namespaceURI)return a("namespace '"+e.namespaceURI+"' should be '"+t.namespaceURI+"'"),!1;if(e.localName!==t.localName)return a("localName '"+e.localName+"' should be '"+t.localName+"'"),!1;if(!c(e,t,!1))return!1;for(n=e.firstChild,o=t.firstChild;n;){if(!o)return a("Nodetype '"+n.nodeType+"' is unexpected here."),!1;if(!h(n,o))return!1;n=n.nextSibling,o=o.nextSibling}return o?(a("Nodetype '"+o.nodeType+"' is missing here."),!1):!0}function q(e,t,n){return 0===t?e===t&&1/e===1/t:e===t?!0:null===e||null===t?!1:"number"==typeof t&&isNaN(t)?"number"==typeof e&&isNaN(e):"number"==typeof t&&"number"==typeof e?e===t?!0:(void 0===n&&(n=1e-4),runtime.assert("number"==typeof n,"Absolute tolerance not given as number."),runtime.assert(n>=0,"Absolute tolerance should be given as positive number, was "+n),e=Math.abs(e-t),n>=e):Object.prototype.toString.call(t)===Object.prototype.toString.call([])?d(e,t):"object"==typeof t&&"object"==typeof e?t.constructor===Element||t.constructor===Node?h(e,t):b(e,t):!1}function p(e){if(0===e&&0>1/e)return"-0";if("object"==typeof e)try{return JSON.stringify(e)}catch(t){}return String(e)}function m(b,c,e,d){"string"==typeof c&&"string"==typeof e||k.debug("WARN: shouldBe() expects string arguments");var f,h;try{h=eval(c)}catch(m){f=m}b=eval(e),f?a(c+" should be "+b+". Threw exception "+f):q(h,b,d)?k.pass(c+" is "+e):a(String(typeof h)===String(typeof b)?c+" should be "+p(b)+". Was "+p(h)+".":c+" should be "+b+" (of type "+typeof b+"). Was "+h+" (of type "+typeof h+").")}var l=0,r,b,e=!1;this.resourcePrefix=function(){return f},this.beginExpectFail=function(){r=l,e=!0},this.endExpectFail=function(){var t=r===l;e=!1,l=r,t&&(l+=1,k.fail("Expected at least one failed test, but none registered."))},b=function(e,t){var n=Object.keys(e),o=Object.keys(t);return n.sort(),o.sort(),d(n,o)&&Object.keys(e).every(function(n){var o=e[n],r=t[n];return q(o,r)?!0:(a(o+" should be "+r+" for key "+n),!1)})},this.areNodesEqual=h,this.shouldBeNull=function(e,t){m(e,t,"null")},this.shouldBeNonNull=function(b,c){var e,d;try{d=eval(c)}catch(f){e=f}e?a(c+" should be non-null. Threw exception "+e):null!==d?k.pass(c+" is non-null."):a(c+" should be non-null. Was "+d)},this.shouldBe=m,this.testFailed=a,this.countFailedTests=function(){return l},this.name=function(e){var t,n,o=[],r=e.length;for(o.length=r,t=0;r>t;t+=1){if(n=Runtime.getFunctionName(e[t])||"",""===n)throw"Found a function without a name.";o[t]={f:e[t],name:n}}return o}},core.UnitTester=function(){function e(e,t){return"<span style='color:blue;cursor:pointer' onclick='"+t+"'>"+e+"</span>"}function t(e){n.reporter&&n.reporter(e)}var n=this,o=0,r=new core.UnitTestLogger,i={},a="BrowserRuntime"===runtime.type();this.resourcePrefix="",this.reporter=function(t){var n,o;if(runtime.log(a?"<span>Running "+e(t.description,'runTest("'+t.suite[0]+'","'+t.description+'")')+"</span>":"Running "+t.description),!t.success)for(n=0;n<t.log.length;n+=1)o=t.log[n],runtime.log(o.category,o.message)},this.runTests=function(s,l,u){function c(e){function n(){s&&b.endExpectFail(),t(r.endTest()),y.tearDown(),v[a]=g===b.countFailedTests(),c(e.slice(1))}var a,s;if(0===e.length)i[h]=v,o+=b.countFailedTests(),l();else if(f=e[0].f,a=e[0].name,s=!0===e[0].expectFail,g=b.countFailedTests(),u.length&&-1===u.indexOf(a))c(e.slice(1));else{y.setUp(),r.startTest(h,a),s&&b.beginExpectFail();try{f(n)}catch(d){b.testFailed("Unexpected exception encountered: "+d.toString()+"\n"+d.stack),n()}}}var d,f,p,m,g,h=Runtime.getFunctionName(s)||"",b=new core.UnitTestRunner(n.resourcePrefix,r),y=new s(b),v={};if(i.hasOwnProperty(h))runtime.log("Test "+h+" has already run.");else{for(runtime.log(a?"<span>Running "+e(h,'runSuite("'+h+'");')+": "+y.description()+"</span>":"Running "+h+": "+y.description),p=y.tests(),d=0;d<p.length;d+=1)if(f=p[d].f,s=p[d].name,m=!0===p[d].expectFail,!u.length||-1!==u.indexOf(s)){g=b.countFailedTests(),y.setUp(),r.startTest(h,s),m&&b.beginExpectFail();try{f()}catch(S){b.testFailed("Unexpected exception encountered: "+S.toString()+"\n"+S.stack)}m&&b.endExpectFail(),t(r.endTest()),y.tearDown(),v[s]=g===b.countFailedTests()}c(y.asyncTests())}},this.failedTestsCount=function(){return o},this.results=function(){return i}},core.Utils=function(){function e(t,n){if(n&&Array.isArray(n)){if(t=t||[],!Array.isArray(t))throw"Destination is not an array.";t=t.concat(n.map(function(t){return e(null,t)}))}else if(n&&"object"==typeof n){if(t=t||{},"object"!=typeof t)throw"Destination is not an object.";Object.keys(n).forEach(function(o){t[o]=e(t[o],n[o])})}else t=n;return t}this.hashString=function(e){var t,n,o=0;for(t=0,n=e.length;n>t;t+=1)o=(o<<5)-o+e.charCodeAt(t),o|=0;return o},this.mergeObjects=function(t,n){return Object.keys(n).forEach(function(o){t[o]=e(t[o],n[o])}),t}},core.Zip=function(e,t){function n(e,t,n){g?n(null,g.subarray(e,e+t)):n("File data not loaded",null)}function o(e){var t,n,o=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],r=e.length,i=0,i=0;for(t=-1,n=0;r>n;n+=1)i=255&(t^e[n]),i=o[i],t=t>>>8^i;return-1^t}function r(e){return new Date((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&15,e>>5&63,(31&e)<<1)}function i(e){var t=e.getFullYear();return 1980>t?0:t-1980<<25|e.getMonth()+1<<21|e.getDate()<<16|e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()>>1}function a(e,t){var o,i,a,s,l,u,c,d=this;this.load=function(t){if(null!==d.data)t(null,d.data);else{var o=l+34+i+a+256;o+c>h&&(o=h-c),n(c,o,function(n,o){if(n||null===o)t(n,o);else e:{var r,i=o,a=new core.ByteArray(i),c=a.readUInt32LE();if(67324752!==c)t("File entry signature is wrong."+c.toString()+" "+i.length.toString(),null);else{if(a.pos+=22,c=a.readUInt16LE(),r=a.readUInt16LE(),a.pos+=c+r,s){if(i=i.subarray(a.pos,a.pos+l),l!==i.length){t("The amount of compressed bytes read was "+i.length.toString()+" instead of "+l.toString()+" for "+d.filename+" in "+e+".",null);break e}i=y(i,u)}else i=i.subarray(a.pos,a.pos+u);u!==i.length?t("The amount of bytes read was "+i.length.toString()+" instead of "+u.toString()+" for "+d.filename+" in "+e+".",null):(d.data=i,t(null,i))}}})}},this.set=function(e,t,n,o){d.filename=e,d.data=t,d.compressed=n,d.date=o},this.error=null,t&&(o=t.readUInt32LE(),33639248!==o?this.error="Central directory entry has wrong signature at position "+(t.pos-4).toString()+' for file "'+e+'": '+t.data.length.toString():(t.pos+=6,s=t.readUInt16LE(),this.date=r(t.readUInt32LE()),t.readUInt32LE(),l=t.readUInt32LE(),u=t.readUInt32LE(),i=t.readUInt16LE(),a=t.readUInt16LE(),o=t.readUInt16LE(),t.pos+=8,c=t.readUInt32LE(),this.filename=runtime.byteArrayToString(t.data.subarray(t.pos,t.pos+i),"utf8"),this.data=null,t.pos+=i+a+o))}function s(t,o){if(22!==t.length)o("Central directory length should be 22.",v);else{var r,i=new core.ByteArray(t);r=i.readUInt32LE(),101010256!==r?o("Central directory signature is wrong: "+r.toString(),v):(r=i.readUInt16LE(),0!==r?o("Zip files with non-zero disk numbers are not supported.",v):(r=i.readUInt16LE(),0!==r?o("Zip files with non-zero disk numbers are not supported.",v):(r=i.readUInt16LE(),b=i.readUInt16LE(),r!==b?o("Number of entries is inconsistent.",v):(r=i.readUInt32LE(),i=i.readUInt16LE(),i=h-22-r,n(i,h-i,function(t,n){if(t||null===n)o(t,v);else e:{var r,i,s=new core.ByteArray(n);for(m=[],r=0;b>r;r+=1){if(i=new a(e,s),i.error){o(i.error,v);break e}m[m.length]=i}o(null,v)}})))))}}function l(e,t){var n,o,r=null;for(o=0;o<m.length;o+=1)if(n=m[o],n.filename===e){r=n;break}r?r.data?t(null,r.data):r.load(t):t(e+" not found.",null)}function u(e){var t=new core.ByteArrayWriter("utf8"),n=0;return t.appendArray([80,75,3,4,20,0,0,0,0,0]),e.data&&(n=e.data.length),t.appendUInt32LE(i(e.date)),t.appendUInt32LE(e.data?o(e.data):0),t.appendUInt32LE(n),t.appendUInt32LE(n),t.appendUInt16LE(e.filename.length),t.appendUInt16LE(0),t.appendString(e.filename),e.data&&t.appendByteArray(e.data),t}function c(e,t){var n=new core.ByteArrayWriter("utf8"),r=0;return n.appendArray([80,75,1,2,20,0,20,0,0,0,0,0]),e.data&&(r=e.data.length),n.appendUInt32LE(i(e.date)),n.appendUInt32LE(e.data?o(e.data):0),n.appendUInt32LE(r),n.appendUInt32LE(r),n.appendUInt16LE(e.filename.length),n.appendArray([0,0,0,0,0,0,0,0,0,0,0,0]),n.appendUInt32LE(t),n.appendString(e.filename),n}function d(e,t){if(e===m.length)t(null);else{var n=m[e];null!==n.data?d(e+1,t):n.load(function(n){n?t(n):d(e+1,t)})}}function f(e,t){d(0,function(n){if(n)t(n);else{var o,r,i=new core.ByteArrayWriter("utf8"),a=[0];for(o=0;o<m.length;o+=1)i.appendByteArrayWriter(u(m[o])),a.push(i.getLength());for(n=i.getLength(),o=0;o<m.length;o+=1)r=m[o],i.appendByteArrayWriter(c(r,a[o]));o=i.getLength()-n,i.appendArray([80,75,5,6,0,0,0,0]),i.appendUInt16LE(m.length),i.appendUInt16LE(m.length),i.appendUInt32LE(o),i.appendUInt32LE(n),i.appendArray([0,0]),e(i.getByteArray())}})}function p(e,t){f(function(n){runtime.writeFile(e,n,function(e){e||(g=n,h=g.length),t(e)})},t)}var m,g,h,b,y=core.RawInflate.inflate,v=this,S=new core.Base64;this.load=l,this.save=function(t,n,o,r){var i,s;for(i=0;i<m.length;i+=1)if(s=m[i],s.filename===t)return void s.set(t,n,o,r);s=new a(e),s.set(t,n,o,r),m.push(s)},this.remove=function(e){var t,n;for(t=0;t<m.length;t+=1)if(n=m[t],n.filename===e)return m.splice(t,1),!0;return!1},this.write=function(t){p(e,t)},this.writeAs=p,this.createByteArray=f,this.loadContentXmlAsFragments=function(e,t){v.loadAsString(e,function(e,n){return e?t.rootElementReady(e):void t.rootElementReady(null,n,!0)})},this.loadAsString=function(e,t){l(e,function(e,n){if(e||null===n)return t(e,null);var o=runtime.byteArrayToString(n,"utf8");t(null,o)})},this.loadAsDOM=function(e,t){v.loadAsString(e,function(e,n){if(e||null===n)t(e,null);else{var o=(new DOMParser).parseFromString(n,"text/xml");t(null,o)}})},this.loadAsDataURL=function(e,t,n){l(e,function(e,o){if(e||!o)return n(e,null);var r,i=0;for(t||(t=80===o[1]&&78===o[2]&&71===o[3]?"image/png":255===o[0]&&216===o[1]&&255===o[2]?"image/jpeg":71===o[0]&&73===o[1]&&70===o[2]?"image/gif":""),r="data:"+t+";base64,";i<o.length;)r+=S.convertUTF8ArrayToBase64(o.subarray(i,Math.min(i+45e3,o.length))),i+=45e3;n(null,r)})},this.getEntries=function(){return m.slice()},h=-1,null===t?m=[]:runtime.readFile(e,"binary",function(o,r){"string"==typeof r&&(o="file was read as a string. Should be Uint8Array."),o||!r||0===r.length?t("File '"+e+"' cannot be read. Err: "+(o||"[none]"),v):(g=r,h=g.length,n(h-22,22,function(e,n){e||null===n?t(e,v):s(n,t)}))})},core.SimpleClientRect=null,gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}},gui.SessionConstraints=function(){function e(e){t.hasOwnProperty(e)||(t[e]=!1,n.register(e))}var t={},n=new core.EventNotifier;this.registerConstraint=e,this.subscribe=function(t,o){e(t),n.subscribe(t,o)},this.unsubscribe=function(e,t){n.unsubscribe(e,t)},this.setState=function(e,o){runtime.assert(!0===t.hasOwnProperty(e),"No such constraint"),t[e]!==o&&(t[e]=o,n.emit(e,o))},this.getState=function(e){return runtime.assert(!0===t.hasOwnProperty(e),"No such constraint"),t[e]}},gui.BlacklistNamespaceNodeFilter=function(e){var t={},n=NodeFilter.FILTER_REJECT,o=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(e){return!e||t.hasOwnProperty(e.namespaceURI)?n:o},function(){e.forEach(function(e){t[e]=!0})}()},odf.Namespaces={namespaceMap:{config:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",math:"http://www.w3.org/1998/Math/MathML",meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xforms:"http://www.w3.org/2002/xforms",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},configns:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",mathns:"http://www.w3.org/1998/Math/MathML",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xformsns:"http://www.w3.org/2002/xforms",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"},function(){var e,t=odf.Namespaces.namespaceMap,n=odf.Namespaces.prefixMap;for(e in t)t.hasOwnProperty(e)&&(n[t[e]]=e)}(),odf.Namespaces.forEachPrefix=function(e){var t,n=odf.Namespaces.namespaceMap;for(t in n)n.hasOwnProperty(t)&&e(t,n[t])},odf.Namespaces.lookupNamespaceURI=function(e){var t=null;return odf.Namespaces.namespaceMap.hasOwnProperty(e)&&(t=odf.Namespaces.namespaceMap[e]),t},odf.Namespaces.lookupPrefix=function(e){var t=odf.Namespaces.prefixMap;return t.hasOwnProperty(e)?t[e]:null},odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI,function(){odf.OdfSchemaImpl=function(){var e=[["config:config-item","uncategorized"],["form:item","object"],["form:option","uncategorized"],["math:math","field"],["meta:user-defined","uncategorized"],["number:currency-symbol","uncategorized"],["number:embedded-text","uncategorized"],["number:text","uncategorized"],["presentation:date-time-decl","uncategorized"],["presentation:footer-decl","uncategorized"],["presentation:header-decl","uncategorized"],["svg:desc","text"],["svg:title","text"],["table:desc","uncategorized"],["table:title","uncategorized"],["text:a","text"],["text:author-initials","field"],["text:author-name","field"],["text:bibliography-mark","field"],["text:bookmark-ref","field"],["text:chapter","field"],["text:character-count","field"],["text:conditional-text","field"],["text:creation-date","field"],["text:creation-time","field"],["text:creator","field"],["text:database-display","field"],["text:database-name","field"],["text:database-row-number","field"],["text:date","field"],["text:dde-connection","field"],["text:description","field"],["text:editing-cycles","field"],["text:editing-duration","field"],["text:execute-macro","uncategorized"],["text:expression","uncategorized"],["text:file-name","field"],["text:h","text"],["text:hidden-paragraph","text"],["text:hidden-text","text"],["text:image-count","field"],["text:index-entry-span","uncategorized"],["text:index-title-template","uncategorized"],["text:initial-creator","field"],["text:keywords","field"],["text:linenumbering-separator","style"],["text:measure","uncategorized"],["text:meta","uncategorized"],["text:meta-field","uncategorized"],["text:modification-date","field"],["text:modification-time","field"],["text:note-citation","field"],["text:note-continuation-notice-backward","style"],["text:note-continuation-notice-forward","style"],["text:note-ref","field"],["text:object-count","field"],["text:p","text"],["text:page-continuation","uncategorized"],["text:page-count","field"],["text:page-number","field"],["text:page-variable-get","field"],["text:page-variable-set","field"],["text:paragraph-count","field"],["text:placeholder","field"],["text:print-date","field"],["text:print-time","field"],["text:printed-by","field"],["text:reference-ref","field"],["text:ruby-base","text"],["text:ruby-text","text"],["text:script","text"],["text:sender-city","field"],["text:sender-company","field"],["text:sender-country","field"],["text:sender-email","field"],["text:sender-fax","field"],["text:sender-firstname","field"],["text:sender-initials","field"],["text:sender-lastname","field"],["text:sender-phone-private","field"],["text:sender-phone-work","field"],["text:sender-position","field"],["text:sender-postal-code","field"],["text:sender-state-or-province","field"],["text:sender-street","field"],["text:sender-title","field"],["text:sequence","uncategorized"],["text:sequence-ref","uncategorized"],["text:sheet-name","uncategorized"],["text:span","text"],["text:subject","field"],["text:table-count","field"],["text:table-formula","deprecated"],["text:template-name","uncategorized"],["text:text-input","field"],["text:time","field"],["text:title","field"],["text:user-defined","field"],["text:user-field-get","field"],["text:user-field-input","field"],["text:variable-get","field"],["text:variable-input","field"],["text:variable-set","field"],["text:word-count","field"],["xforms:model","uncategorized"]],t={};this.isTextContainer=function(e,n){return"text"===t[e+":"+n]},this.isField=function(e,n){return"field"===t[e+":"+n]},this.getFields=function(){return e.filter(function(e){return"field"===e[1]}).map(function(e){return e[0]})},function(){e.forEach(function(e){var n=e[1],o=e[0].split(":");e=o[0];var o=o[1],r=odf.Namespaces.lookupNamespaceURI(e);r?t[r+":"+o]=n:runtime.log("DEBUG: OdfSchema - unknown prefix '"+e+"'")})}()},odf.OdfSchema=new odf.OdfSchemaImpl}(),odf.OdfUtilsImpl=function(){function e(e){return"image"===(e&&e.localName)&&e.namespaceURI===k}function t(e){return null!==e&&e.nodeType===Node.ELEMENT_NODE&&"frame"===e.localName&&e.namespaceURI===k&&"as-char"===e.getAttributeNS(D,"anchor-type")}function n(e){var t;return(t="annotation"===(e&&e.localName)&&e.namespaceURI===odf.Namespaces.officens)||(t="div"===(e&&e.localName)&&"annotationWrapper"===e.className),t}function o(e){return"a"===(e&&e.localName)&&e.namespaceURI===D}function r(e){var t=e&&e.localName;return("p"===t||"h"===t)&&e.namespaceURI===D}function i(e,t){for(e&&void 0!==t&&!r(e)&&e.childNodes.item(t)&&(e=e.childNodes.item(t));e&&!r(e);)e=e.parentNode;return e}function a(e,t){for(;e&&e!==t;){if(e.namespaceURI===odf.Namespaces.officens&&"annotation"===e.localName)return e;e=e.parentNode}return null}function s(e){return/^[ \t\r\n]+$/.test(e)}function l(e){if(null===e||e.nodeType!==Node.ELEMENT_NODE)return!1;var t=e.localName;return U.isTextContainer(e.namespaceURI,t)||"span"===t&&"webodf-annotationHighlight"===e.className}function u(e){return null===e||e.nodeType!==Node.ELEMENT_NODE?!1:U.isField(e.namespaceURI,e.localName)}function c(e){var t=e&&e.localName,n=!1;return t&&(e=e.namespaceURI,e===D&&(n="s"===t||"tab"===t||"line-break"===t)),n}function d(e){return c(e)||u(e)||t(e)||n(e)}function f(e){var t=e&&e.localName,n=!1;return t&&(e=e.namespaceURI,e===D&&(n="s"===t)),n}function p(e){return-1!==M.indexOf(e.namespaceURI)}function m(e){if(c(e)||u(e))return!1;if(l(e.parentNode)&&e.nodeType===Node.TEXT_NODE)return 0===e.textContent.length;for(e=e.firstChild;e;){if(p(e)||!m(e))return!1;e=e.nextSibling}return!0}function g(e){for(;null!==e.firstChild&&l(e);)e=e.firstChild;return e}function h(e){for(;null!==e.lastChild&&l(e);)e=e.lastChild;return e}function b(e){for(;!r(e)&&null===e.previousSibling;)e=e.parentNode;return r(e)?null:h(e.previousSibling)}function y(e){for(;!r(e)&&null===e.nextSibling;)e=e.parentNode;return r(e)?null:g(e.nextSibling)}function v(e){for(var t=!1;e;)if(e.nodeType===Node.TEXT_NODE){if(0!==e.length)return!s(e.data.substr(e.length-1,1));e=b(e)}else d(e)?(t=!1===f(e),e=null):e=b(e);return t}function S(e){var t,n=!1;for(e=e&&g(e);e;){if(t=e.nodeType===Node.TEXT_NODE?e.length:0,t>0&&!s(e.data)){n=!0;break}if(d(e)){n=!0;break}e=y(e)}return n}function N(e,t){return s(e.data.substr(t))?!S(y(e)):!1}function C(e,t){var n,o=e.data;return!s(o[t])||d(e.parentNode)?!1:(t>0?s(o[t-1])||(n=!0):v(b(e))&&(n=!0),!0===n?N(e,t)?!1:!0:!1)}function x(e){return(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null}function E(e){return(e=x(e))&&(0>e.value||"%"===e.unit)?null:e}function w(e){return(e=x(e))&&"%"!==e.unit?null:e}function T(e){switch(e.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(e.localName){case"note-body":case"ruby-text":return!1}break;case odf.Namespaces.officens:switch(e.localName){case"annotation":case"binary-data":case"event-listeners":return!1}break;default:switch(e.localName){case"cursor":case"editinfo":return!1}}return!0}function O(e,t){for(;0<t.length&&!F.rangeContainsNode(e,t[0]);)t.shift();for(;0<t.length&&!F.rangeContainsNode(e,t[t.length-1]);)t.pop()}function A(e,t,o){var r;return r=F.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return c(e.parentNode)||u(e.parentNode)||n(e)?t=NodeFilter.FILTER_REJECT:e.nodeType===Node.TEXT_NODE?(o||Boolean(i(e)&&(!s(e.textContent)||C(e,0))))&&(t=NodeFilter.FILTER_ACCEPT):d(e)?t=NodeFilter.FILTER_ACCEPT:(T(e)||l(e))&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),t||O(e,r),r}function R(e,t,o){for(;e;){if(o(e)){t[0]!==e&&t.unshift(e);break}if(n(e))break;e=e.parentNode}}function P(e,t){var n=e;if(t<n.childNodes.length-1)n=n.childNodes[t+1];else{for(;!n.nextSibling;)n=n.parentNode;n=n.nextSibling}for(;n.firstChild;)n=n.firstChild;return n}var D=odf.Namespaces.textns,k=odf.Namespaces.drawns,I=odf.Namespaces.xlinkns,F=core.DomUtils,M=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns],U=odf.OdfSchema;this.isImage=e,this.isCharacterFrame=t,this.isInlineRoot=n,this.isTextSpan=function(e){return"span"===(e&&e.localName)&&e.namespaceURI===D},this.isHyperlink=o,this.getHyperlinkTarget=function(e){return e.getAttributeNS(I,"href")||""},this.isParagraph=r,this.getParagraphElement=i,this.getParentAnnotation=a,this.isWithinAnnotation=function(e,t){return Boolean(a(e,t))},this.getAnnotationCreator=function(e){return e.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent},this.isListItem=function(e){return"list-item"===(e&&e.localName)&&e.namespaceURI===D},this.isLineBreak=function(e){return"line-break"===(e&&e.localName)&&e.namespaceURI===D},this.isODFWhitespace=s,this.isGroupingElement=l,this.isFieldElement=u,this.isCharacterElement=c,this.isAnchoredAsCharacterElement=d,this.isSpaceElement=f,this.isODFNode=p,this.hasNoODFContent=m,this.firstChild=g,this.lastChild=h,this.previousNode=b,this.nextNode=y,this.scanLeftForNonSpace=v,this.lookLeftForCharacter=function(e){var t,n=t=0;return e.nodeType===Node.TEXT_NODE&&(n=e.length),n>0?(t=e.data,t=s(t.substr(n-1,1))?1===n?v(b(e))?2:0:s(t.substr(n-2,1))?0:2:1):d(e)&&(t=1),t},this.lookRightForCharacter=function(e){var t=!1,n=0;return e&&e.nodeType===Node.TEXT_NODE&&(n=e.length),n>0?t=!s(e.data.substr(0,1)):d(e)&&(t=!0),t},this.scanLeftForAnyCharacter=function(e){var t,n=!1;for(e=e&&h(e);e;){if(t=e.nodeType===Node.TEXT_NODE?e.length:0,t>0&&!s(e.data)){n=!0;break}if(d(e)){n=!0;break}e=b(e)}return n},this.scanRightForAnyCharacter=S,this.isTrailingWhitespace=N,this.isSignificantWhitespace=C,this.isDowngradableSpaceElement=function(e){return f(e)?v(b(e))&&S(y(e)):!1},this.parseLength=x,this.parseNonNegativeLength=E,this.parseFoFontSize=function(e){var t;return t=(t=x(e))&&(0>=t.value||"%"===t.unit)?null:t,t||w(e)},this.parseFoLineHeight=function(e){return E(e)||w(e)},this.isTextContentContainingNode=T,this.getTextNodes=function(e,t){var n;return n=F.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return e.nodeType===Node.TEXT_NODE?Boolean(i(e)&&(!s(e.textContent)||C(e,0)))&&(t=NodeFilter.FILTER_ACCEPT):T(e)&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),t||O(e,n),n},this.getTextElements=A,this.getParagraphElements=function(e){var t;return t=F.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return r(e)?t=NodeFilter.FILTER_ACCEPT:(T(e)||l(e))&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT),R(e.startContainer,t,r),t},this.getImageElements=function(t){var n;return n=F.getNodesInRange(t,function(t){var n=NodeFilter.FILTER_SKIP;return e(t)&&(n=NodeFilter.FILTER_ACCEPT),n},NodeFilter.SHOW_ELEMENT),R(t.startContainer,n,e),n},this.getHyperlinkElements=function(e){var t=[],n=e.cloneRange();return e.collapsed&&e.endContainer.nodeType===Node.ELEMENT_NODE&&(e=P(e.endContainer,e.endOffset),e.nodeType===Node.TEXT_NODE&&n.setEnd(e,1)),A(n,!0,!1).forEach(function(e){for(e=e.parentNode;!r(e);){if(o(e)&&-1===t.indexOf(e)){t.push(e);break}e=e.parentNode}}),n.detach(),t},this.getNormalizedFontFamilyName=function(e){return/^(["'])(?:.|[\n\r])*?\1$/.test(e)||(e=e.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(e)&&(e="'"+e.replace(/[ \t\r\n\f]+/g," ")+"'")),e}},odf.OdfUtils=new odf.OdfUtilsImpl,gui.OdfTextBodyNodeFilter=function(){var e=odf.OdfUtils,t=Node.TEXT_NODE,n=NodeFilter.FILTER_REJECT,o=NodeFilter.FILTER_ACCEPT,r=odf.Namespaces.textns;this.acceptNode=function(i){if(i.nodeType===t){if(!e.isGroupingElement(i.parentNode))return n}else if(i.namespaceURI===r&&"tracked-changes"===i.localName)return n;return o}},xmldom.LSSerializerFilter=function(){},xmldom.LSSerializerFilter.prototype.acceptNode=function(){},odf.OdfNodeFilter=function(){this.acceptNode=function(e){return"http://www.w3.org/1999/xhtml"===e.namespaceURI?NodeFilter.FILTER_SKIP:e.namespaceURI&&e.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},xmldom.XPathIterator=function(){},xmldom.XPathIterator.prototype.next=function(){},xmldom.XPathIterator.prototype.reset=function(){},xmldom.XPath=createXPathSingleton(),odf.StyleInfo=function(){function e(t,n){var o,r,i,a,s,l=0;for((o=d[t.localName])&&(i=o[t.namespaceURI])&&(l=i.length),o=0;l>o;o+=1)r=i[o],a=r.ns,s=r.localname,(r=t.getAttributeNS(a,s))&&t.setAttributeNS(a,x[a]+s,n+r);for(i=t.firstElementChild;i;)e(i,n),i=i.nextElementSibling}function t(e,n){var o,r,i,a,s,l=0;for((o=d[e.localName])&&(i=o[e.namespaceURI])&&(l=i.length),o=0;l>o;o+=1)r=i[o],a=r.ns,s=r.localname,(r=e.getAttributeNS(a,s))&&(r=r.replace(n,""),e.setAttributeNS(a,x[a]+s,r));for(i=e.firstElementChild;i;)t(i,n),i=i.nextElementSibling}function n(e,t){var n,o,r,i,a,s=0;for((n=d[e.localName])&&(r=n[e.namespaceURI])&&(s=r.length),n=0;s>n;n+=1)i=r[n],o=i.ns,a=i.localname,(o=e.getAttributeNS(o,a))&&(t=t||{},i=i.keyname,t.hasOwnProperty(i)?t[i][o]=1:(a={},a[o]=1,t[i]=a));return t}function o(e,t){var r,i;for(n(e,t),r=e.firstChild;r;)r.nodeType===Node.ELEMENT_NODE&&(i=r,o(i,t)),r=r.nextSibling}function r(e,t,n){this.key=e,this.name=t,this.family=n,this.requires={}}function i(e,t,n){var o=e+'"'+t,i=n[o];return i||(i=n[o]=new r(o,e,t)),i}function a(e,t,n){var o,r,s,l,u,c=0;if(o=e.getAttributeNS(S,"name"),l=e.getAttributeNS(S,"family"),o&&l&&(t=i(o,l,n)),t)for((o=d[e.localName])&&(s=o[e.namespaceURI])&&(c=s.length),o=0;c>o;o+=1)l=s[o],r=l.ns,u=l.localname,(r=e.getAttributeNS(r,u))&&(l=l.keyname,l=i(r,l,n),t.requires[l.key]=l);for(e=e.firstElementChild;e;)a(e,t,n),e=e.nextElementSibling;return n}function s(e,t){var n=t[e.family];n||(n=t[e.family]={}),n[e.name]=1,Object.keys(e.requires).forEach(function(n){s(e.requires[n],t)})}function l(e,t){var n=a(e,null,{});Object.keys(n).forEach(function(e){e=n[e];var o=t[e.family];o&&o.hasOwnProperty(e.name)&&s(e,t)})}function u(e,t){function n(t){(t=r.getAttributeNS(S,t))&&(e[t]=!0)}var o,r,i=["font-name","font-name-asian","font-name-complex"];
for(o=t&&t.firstElementChild;o;)r=o,i.forEach(n),u(e,r),o=o.nextElementSibling}function c(e,t){function n(e){var n=r.getAttributeNS(S,e);n&&t.hasOwnProperty(n)&&r.setAttributeNS(S,"style:"+e,t[n])}var o,r,i=["font-name","font-name-asian","font-name-complex"];for(o=e&&e.firstElementChild;o;)r=o,i.forEach(n),c(r,t),o=o.nextElementSibling}var d,f=odf.Namespaces.chartns,p=odf.Namespaces.dbns,m=odf.Namespaces.dr3dns,g=odf.Namespaces.drawns,h=odf.Namespaces.formns,b=odf.Namespaces.numberns,y=odf.Namespaces.officens,v=odf.Namespaces.presentationns,S=odf.Namespaces.stylens,N=odf.Namespaces.tablens,C=odf.Namespaces.textns,x={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:","urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:","urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},E={text:[{ens:S,en:"tab-stop",ans:S,a:"leader-text-style"},{ens:S,en:"drop-cap",ans:S,a:"style-name"},{ens:C,en:"notes-configuration",ans:C,a:"citation-body-style-name"},{ens:C,en:"notes-configuration",ans:C,a:"citation-style-name"},{ens:C,en:"a",ans:C,a:"style-name"},{ens:C,en:"alphabetical-index",ans:C,a:"style-name"},{ens:C,en:"linenumbering-configuration",ans:C,a:"style-name"},{ens:C,en:"list-level-style-number",ans:C,a:"style-name"},{ens:C,en:"ruby-text",ans:C,a:"style-name"},{ens:C,en:"span",ans:C,a:"style-name"},{ens:C,en:"a",ans:C,a:"visited-style-name"},{ens:S,en:"text-properties",ans:S,a:"text-line-through-text-style"},{ens:C,en:"alphabetical-index-source",ans:C,a:"main-entry-style-name"},{ens:C,en:"index-entry-bibliography",ans:C,a:"style-name"},{ens:C,en:"index-entry-chapter",ans:C,a:"style-name"},{ens:C,en:"index-entry-link-end",ans:C,a:"style-name"},{ens:C,en:"index-entry-link-start",ans:C,a:"style-name"},{ens:C,en:"index-entry-page-number",ans:C,a:"style-name"},{ens:C,en:"index-entry-span",ans:C,a:"style-name"},{ens:C,en:"index-entry-tab-stop",ans:C,a:"style-name"},{ens:C,en:"index-entry-text",ans:C,a:"style-name"},{ens:C,en:"index-title-template",ans:C,a:"style-name"},{ens:C,en:"list-level-style-bullet",ans:C,a:"style-name"},{ens:C,en:"outline-level-style",ans:C,a:"style-name"}],paragraph:[{ens:g,en:"caption",ans:g,a:"text-style-name"},{ens:g,en:"circle",ans:g,a:"text-style-name"},{ens:g,en:"connector",ans:g,a:"text-style-name"},{ens:g,en:"control",ans:g,a:"text-style-name"},{ens:g,en:"custom-shape",ans:g,a:"text-style-name"},{ens:g,en:"ellipse",ans:g,a:"text-style-name"},{ens:g,en:"frame",ans:g,a:"text-style-name"},{ens:g,en:"line",ans:g,a:"text-style-name"},{ens:g,en:"measure",ans:g,a:"text-style-name"},{ens:g,en:"path",ans:g,a:"text-style-name"},{ens:g,en:"polygon",ans:g,a:"text-style-name"},{ens:g,en:"polyline",ans:g,a:"text-style-name"},{ens:g,en:"rect",ans:g,a:"text-style-name"},{ens:g,en:"regular-polygon",ans:g,a:"text-style-name"},{ens:y,en:"annotation",ans:g,a:"text-style-name"},{ens:h,en:"column",ans:h,a:"text-style-name"},{ens:S,en:"style",ans:S,a:"next-style-name"},{ens:N,en:"body",ans:N,a:"paragraph-style-name"},{ens:N,en:"even-columns",ans:N,a:"paragraph-style-name"},{ens:N,en:"even-rows",ans:N,a:"paragraph-style-name"},{ens:N,en:"first-column",ans:N,a:"paragraph-style-name"},{ens:N,en:"first-row",ans:N,a:"paragraph-style-name"},{ens:N,en:"last-column",ans:N,a:"paragraph-style-name"},{ens:N,en:"last-row",ans:N,a:"paragraph-style-name"},{ens:N,en:"odd-columns",ans:N,a:"paragraph-style-name"},{ens:N,en:"odd-rows",ans:N,a:"paragraph-style-name"},{ens:C,en:"notes-configuration",ans:C,a:"default-style-name"},{ens:C,en:"alphabetical-index-entry-template",ans:C,a:"style-name"},{ens:C,en:"bibliography-entry-template",ans:C,a:"style-name"},{ens:C,en:"h",ans:C,a:"style-name"},{ens:C,en:"illustration-index-entry-template",ans:C,a:"style-name"},{ens:C,en:"index-source-style",ans:C,a:"style-name"},{ens:C,en:"object-index-entry-template",ans:C,a:"style-name"},{ens:C,en:"p",ans:C,a:"style-name"},{ens:C,en:"table-index-entry-template",ans:C,a:"style-name"},{ens:C,en:"table-of-content-entry-template",ans:C,a:"style-name"},{ens:C,en:"table-index-entry-template",ans:C,a:"style-name"},{ens:C,en:"user-index-entry-template",ans:C,a:"style-name"},{ens:S,en:"page-layout-properties",ans:S,a:"register-truth-ref-style-name"}],chart:[{ens:f,en:"axis",ans:f,a:"style-name"},{ens:f,en:"chart",ans:f,a:"style-name"},{ens:f,en:"data-label",ans:f,a:"style-name"},{ens:f,en:"data-point",ans:f,a:"style-name"},{ens:f,en:"equation",ans:f,a:"style-name"},{ens:f,en:"error-indicator",ans:f,a:"style-name"},{ens:f,en:"floor",ans:f,a:"style-name"},{ens:f,en:"footer",ans:f,a:"style-name"},{ens:f,en:"grid",ans:f,a:"style-name"},{ens:f,en:"legend",ans:f,a:"style-name"},{ens:f,en:"mean-value",ans:f,a:"style-name"},{ens:f,en:"plot-area",ans:f,a:"style-name"},{ens:f,en:"regression-curve",ans:f,a:"style-name"},{ens:f,en:"series",ans:f,a:"style-name"},{ens:f,en:"stock-gain-marker",ans:f,a:"style-name"},{ens:f,en:"stock-loss-marker",ans:f,a:"style-name"},{ens:f,en:"stock-range-line",ans:f,a:"style-name"},{ens:f,en:"subtitle",ans:f,a:"style-name"},{ens:f,en:"title",ans:f,a:"style-name"},{ens:f,en:"wall",ans:f,a:"style-name"}],section:[{ens:C,en:"alphabetical-index",ans:C,a:"style-name"},{ens:C,en:"bibliography",ans:C,a:"style-name"},{ens:C,en:"illustration-index",ans:C,a:"style-name"},{ens:C,en:"index-title",ans:C,a:"style-name"},{ens:C,en:"object-index",ans:C,a:"style-name"},{ens:C,en:"section",ans:C,a:"style-name"},{ens:C,en:"table-of-content",ans:C,a:"style-name"},{ens:C,en:"table-index",ans:C,a:"style-name"},{ens:C,en:"user-index",ans:C,a:"style-name"}],ruby:[{ens:C,en:"ruby",ans:C,a:"style-name"}],table:[{ens:p,en:"query",ans:p,a:"style-name"},{ens:p,en:"table-representation",ans:p,a:"style-name"},{ens:N,en:"background",ans:N,a:"style-name"},{ens:N,en:"table",ans:N,a:"style-name"}],"table-column":[{ens:p,en:"column",ans:p,a:"style-name"},{ens:N,en:"table-column",ans:N,a:"style-name"}],"table-row":[{ens:p,en:"query",ans:p,a:"default-row-style-name"},{ens:p,en:"table-representation",ans:p,a:"default-row-style-name"},{ens:N,en:"table-row",ans:N,a:"style-name"}],"table-cell":[{ens:p,en:"column",ans:p,a:"default-cell-style-name"},{ens:N,en:"table-column",ans:N,a:"default-cell-style-name"},{ens:N,en:"table-row",ans:N,a:"default-cell-style-name"},{ens:N,en:"body",ans:N,a:"style-name"},{ens:N,en:"covered-table-cell",ans:N,a:"style-name"},{ens:N,en:"even-columns",ans:N,a:"style-name"},{ens:N,en:"covered-table-cell",ans:N,a:"style-name"},{ens:N,en:"even-columns",ans:N,a:"style-name"},{ens:N,en:"even-rows",ans:N,a:"style-name"},{ens:N,en:"first-column",ans:N,a:"style-name"},{ens:N,en:"first-row",ans:N,a:"style-name"},{ens:N,en:"last-column",ans:N,a:"style-name"},{ens:N,en:"last-row",ans:N,a:"style-name"},{ens:N,en:"odd-columns",ans:N,a:"style-name"},{ens:N,en:"odd-rows",ans:N,a:"style-name"},{ens:N,en:"table-cell",ans:N,a:"style-name"}],graphic:[{ens:m,en:"cube",ans:g,a:"style-name"},{ens:m,en:"extrude",ans:g,a:"style-name"},{ens:m,en:"rotate",ans:g,a:"style-name"},{ens:m,en:"scene",ans:g,a:"style-name"},{ens:m,en:"sphere",ans:g,a:"style-name"},{ens:g,en:"caption",ans:g,a:"style-name"},{ens:g,en:"circle",ans:g,a:"style-name"},{ens:g,en:"connector",ans:g,a:"style-name"},{ens:g,en:"control",ans:g,a:"style-name"},{ens:g,en:"custom-shape",ans:g,a:"style-name"},{ens:g,en:"ellipse",ans:g,a:"style-name"},{ens:g,en:"frame",ans:g,a:"style-name"},{ens:g,en:"g",ans:g,a:"style-name"},{ens:g,en:"line",ans:g,a:"style-name"},{ens:g,en:"measure",ans:g,a:"style-name"},{ens:g,en:"page-thumbnail",ans:g,a:"style-name"},{ens:g,en:"path",ans:g,a:"style-name"},{ens:g,en:"polygon",ans:g,a:"style-name"},{ens:g,en:"polyline",ans:g,a:"style-name"},{ens:g,en:"rect",ans:g,a:"style-name"},{ens:g,en:"regular-polygon",ans:g,a:"style-name"},{ens:y,en:"annotation",ans:g,a:"style-name"}],presentation:[{ens:m,en:"cube",ans:v,a:"style-name"},{ens:m,en:"extrude",ans:v,a:"style-name"},{ens:m,en:"rotate",ans:v,a:"style-name"},{ens:m,en:"scene",ans:v,a:"style-name"},{ens:m,en:"sphere",ans:v,a:"style-name"},{ens:g,en:"caption",ans:v,a:"style-name"},{ens:g,en:"circle",ans:v,a:"style-name"},{ens:g,en:"connector",ans:v,a:"style-name"},{ens:g,en:"control",ans:v,a:"style-name"},{ens:g,en:"custom-shape",ans:v,a:"style-name"},{ens:g,en:"ellipse",ans:v,a:"style-name"},{ens:g,en:"frame",ans:v,a:"style-name"},{ens:g,en:"g",ans:v,a:"style-name"},{ens:g,en:"line",ans:v,a:"style-name"},{ens:g,en:"measure",ans:v,a:"style-name"},{ens:g,en:"page-thumbnail",ans:v,a:"style-name"},{ens:g,en:"path",ans:v,a:"style-name"},{ens:g,en:"polygon",ans:v,a:"style-name"},{ens:g,en:"polyline",ans:v,a:"style-name"},{ens:g,en:"rect",ans:v,a:"style-name"},{ens:g,en:"regular-polygon",ans:v,a:"style-name"},{ens:y,en:"annotation",ans:v,a:"style-name"}],"drawing-page":[{ens:g,en:"page",ans:g,a:"style-name"},{ens:v,en:"notes",ans:g,a:"style-name"},{ens:S,en:"handout-master",ans:g,a:"style-name"},{ens:S,en:"master-page",ans:g,a:"style-name"}],"list-style":[{ens:C,en:"list",ans:C,a:"style-name"},{ens:C,en:"numbered-paragraph",ans:C,a:"style-name"},{ens:C,en:"list-item",ans:C,a:"style-override"},{ens:S,en:"style",ans:S,a:"list-style-name"}],data:[{ens:S,en:"style",ans:S,a:"data-style-name"},{ens:S,en:"style",ans:S,a:"percentage-data-style-name"},{ens:v,en:"date-time-decl",ans:S,a:"data-style-name"},{ens:C,en:"creation-date",ans:S,a:"data-style-name"},{ens:C,en:"creation-time",ans:S,a:"data-style-name"},{ens:C,en:"database-display",ans:S,a:"data-style-name"},{ens:C,en:"date",ans:S,a:"data-style-name"},{ens:C,en:"editing-duration",ans:S,a:"data-style-name"},{ens:C,en:"expression",ans:S,a:"data-style-name"},{ens:C,en:"meta-field",ans:S,a:"data-style-name"},{ens:C,en:"modification-date",ans:S,a:"data-style-name"},{ens:C,en:"modification-time",ans:S,a:"data-style-name"},{ens:C,en:"print-date",ans:S,a:"data-style-name"},{ens:C,en:"print-time",ans:S,a:"data-style-name"},{ens:C,en:"table-formula",ans:S,a:"data-style-name"},{ens:C,en:"time",ans:S,a:"data-style-name"},{ens:C,en:"user-defined",ans:S,a:"data-style-name"},{ens:C,en:"user-field-get",ans:S,a:"data-style-name"},{ens:C,en:"user-field-input",ans:S,a:"data-style-name"},{ens:C,en:"variable-get",ans:S,a:"data-style-name"},{ens:C,en:"variable-input",ans:S,a:"data-style-name"},{ens:C,en:"variable-set",ans:S,a:"data-style-name"}],"page-layout":[{ens:v,en:"notes",ans:S,a:"page-layout-name"},{ens:S,en:"handout-master",ans:S,a:"page-layout-name"},{ens:S,en:"master-page",ans:S,a:"page-layout-name"}]},w=xmldom.XPath;this.collectUsedFontFaces=u,this.changeFontFaceNames=c,this.UsedStyleList=function(e,t){var n={};this.uses=function(e){var t=e.localName,o=e.getAttributeNS(g,"name")||e.getAttributeNS(S,"name");return e="style"===t?e.getAttributeNS(S,"family"):e.namespaceURI===b?"data":t,(e=n[e])?0<e[o]:!1},o(e,n),t&&l(t,n)},this.getStyleName=function(e,t){var n,o,r=d[t.localName];if(r&&(r=r[t.namespaceURI]))for(o=0;o<r.length;o+=1)if(r[o].keyname===e&&(r=r[o],t.hasAttributeNS(r.ns,r.localname))){n=t.getAttributeNS(r.ns,r.localname);break}return n},this.hasDerivedStyles=function(e,t,n){var o=n.getAttributeNS(S,"name");return n=n.getAttributeNS(S,"family"),w.getODFElementsWithXPath(e,"//style:*[@style:parent-style-name='"+o+"'][@style:family='"+n+"']",t).length?!0:!1},this.prefixStyleNames=function(t,n,o){var r;if(t){for(r=t.firstChild;r;){if(r.nodeType===Node.ELEMENT_NODE){var i=r,a=n,s=i.getAttributeNS(g,"name"),l=void 0;s?l=g:(s=i.getAttributeNS(S,"name"))&&(l=S),l&&i.setAttributeNS(l,x[l]+"name",a+s)}r=r.nextSibling}e(t,n),o&&e(o,n)}},this.removePrefixFromStyleNames=function(e,n,o){var r=RegExp("^"+n);if(e){for(n=e.firstChild;n;){if(n.nodeType===Node.ELEMENT_NODE){var i=n,a=r,s=i.getAttributeNS(g,"name"),l=void 0;s?l=g:(s=i.getAttributeNS(S,"name"))&&(l=S),l&&(s=s.replace(a,""),i.setAttributeNS(l,x[l]+"name",s))}n=n.nextSibling}t(e,r),o&&t(o,r)}},this.determineStylesForNode=n,d=function(){var e,t,n,o,r,i,a,s,l,u={};for(n in E)if(E.hasOwnProperty(n))for(o=E[n],t=o.length,e=0;t>e;e+=1)r=o[e],s=r.en,l=r.ens,u.hasOwnProperty(s)?i=u[s]:u[s]=i={},i.hasOwnProperty(l)?a=i[l]:i[l]=a=[],a.push({ns:r.ans,localname:r.a,keyname:n});return u}()},"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return t.prototype=e,new t}),xmldom.LSSerializer=function(){function e(e){var t=e||{},n=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[e[t]]=t);return n}(e),o=[t],r=[n],i=0;this.push=function(){i+=1,t=o[i]=Object.create(t),n=r[i]=Object.create(n)},this.pop=function(){o.pop(),r.pop(),i-=1,t=o[i],n=r[i]},this.getLocalNamespaceDefinitions=function(){return n},this.getQName=function(e){var o,r=e.namespaceURI,i=0;if(!r)return e.localName;if(o=n[r])return o+":"+e.localName;do{if(o||!e.prefix?(o="ns"+i,i+=1):o=e.prefix,t[o]===r)break;if(!t[o]){t[o]=r,n[r]=o;break}o=null}while(null===o);return o+":"+e.localName}}function t(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function n(e,r){var i,a="",s=o.filter?o.filter.acceptNode(r):NodeFilter.FILTER_ACCEPT;if(s===NodeFilter.FILTER_ACCEPT&&r.nodeType===Node.ELEMENT_NODE){e.push(),i=e.getQName(r);var l,u,c,d,f,p=r.attributes,m="";for(l="<"+i,u=p.length,c=0;u>c;c+=1)d=p.item(c),"http://www.w3.org/2000/xmlns/"!==d.namespaceURI&&(f=o.filter?o.filter.acceptNode(d):NodeFilter.FILTER_ACCEPT,f===NodeFilter.FILTER_ACCEPT&&(f=e.getQName(d),d="string"==typeof d.value?t(d.value):d.value,m+=" "+(f+'="'+d+'"')));u=e.getLocalNamespaceDefinitions();for(c in u)u.hasOwnProperty(c)&&((p=u[c])?"xmlns"!==p&&(l+=" xmlns:"+u[c]+'="'+c+'"'):l+=' xmlns="'+c+'"');a+=l+(m+">")}if(s===NodeFilter.FILTER_ACCEPT||s===NodeFilter.FILTER_SKIP){for(s=r.firstChild;s;)a+=n(e,s),s=s.nextSibling;r.nodeValue&&(a+=t(r.nodeValue))}return i&&(a+="</"+i+">",e.pop()),a}var o=this;this.filter=null,this.writeToString=function(t,o){if(!t)return"";var r=new e(o);return n(r,t)}},function(){function e(e){var t,n=s.length;for(t=0;n>t;t+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&e.localName===s[t])return t;return-1}function t(e,t){var n=new r.UsedStyleList(e,t),o=new odf.OdfNodeFilter;this.acceptNode=function(e){var r=o.acceptNode(e);return r===NodeFilter.FILTER_ACCEPT&&e.parentNode===t&&e.nodeType===Node.ELEMENT_NODE&&(r=n.uses(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),r}}function n(e,n){var o=new t(e,n);this.acceptNode=function(e){var t=o.acceptNode(e);return t!==NodeFilter.FILTER_ACCEPT||!e.parentNode||e.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==e.parentNode.localName&&"tab"!==e.parentNode.localName||(t=NodeFilter.FILTER_REJECT),t}}function o(t,n){if(n){var o,r=e(n),i=t.firstChild;if(-1!==r){for(;i&&(o=e(i),!(-1!==o&&o>r));)i=i.nextSibling;t.insertBefore(n,i)}}}var r=new odf.StyleInfo,i=core.DomUtils,a=odf.Namespaces.stylens,s="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),l=Date.now()+"_webodf_",u=new core.Base64;odf.ODFElement=function(){},odf.ODFDocumentElement=function(){},odf.ODFDocumentElement.prototype=new odf.ODFElement,odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement,odf.ODFDocumentElement.prototype.fontFaceDecls=null,odf.ODFDocumentElement.prototype.manifest=null,odf.ODFDocumentElement.prototype.settings=null,odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0",odf.ODFDocumentElement.localName="document",odf.AnnotationElement=function(){},odf.OdfPart=function(e,t,n,o){var r=this;this.size=0,this.type=null,this.name=e,this.container=n,this.url=null,this.mimetype=t,this.onstatereadychange=this.document=null,this.EMPTY=0,this.LOADING=1,this.DONE=2,this.state=this.EMPTY,this.data="",this.load=function(){null!==o&&(this.mimetype=t,o.loadAsDataURL(e,t,function(e,t){e&&runtime.log(e),r.url=t,r.onchange&&r.onchange(r),r.onstatereadychange&&r.onstatereadychange(r)}))}},odf.OdfPart.prototype.load=function(){},odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+u.toBase64(this.data):null},odf.OdfContainer=function c(e,s){function d(e){for(var t,n=e.firstChild;n;)t=n.nextSibling,n.nodeType===Node.ELEMENT_NODE?d(n):n.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&e.removeChild(n),n=t}function f(e){var t,n,o={},r=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,null,!1);for(e=r.nextNode();e;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&("annotation"===e.localName?(t=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(o.hasOwnProperty(t)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+t+"'"):o[t]=e):"annotation-end"===e.localName&&((t=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?o.hasOwnProperty(t)?(n=o[t],n.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+t+"'"):n.annotationEndElement=e):runtime.log("Warning: annotation end without an annotation start, name: '"+t+"'"):runtime.log("Warning: annotation end without a name found"))),e=r.nextNode()}function p(e,t){for(var n=e&&e.firstChild;n;)n.nodeType===Node.ELEMENT_NODE&&n.setAttributeNS("urn:webodf:names:scope","scope",t),n=n.nextSibling}function m(e,t){for(var n=j.rootElement.meta,n=n&&n.firstChild;n&&(n.namespaceURI!==e||n.localName!==t);)n=n.nextSibling;for(n=n&&n.firstChild;n&&n.nodeType!==Node.TEXT_NODE;)n=n.nextSibling;return n?n.data:null}function g(e){var t,n={};for(e=e.firstChild;e;)e.nodeType===Node.ELEMENT_NODE&&e.namespaceURI===a&&"font-face"===e.localName&&(t=e.getAttributeNS(a,"name"),n[t]=e),e=e.nextSibling;return n}function h(e,t){var n,o,r,i=null;if(e)for(i=e.cloneNode(!0),n=i.firstElementChild;n;)o=n.nextElementSibling,(r=n.getAttributeNS("urn:webodf:names:scope","scope"))&&r!==t&&i.removeChild(n),n=o;return i}function b(e,t){var n,o,i,s=null,l={};if(e)for(t.forEach(function(e){r.collectUsedFontFaces(l,e)}),s=e.cloneNode(!0),n=s.firstElementChild;n;)o=n.nextElementSibling,i=n.getAttributeNS(a,"name"),l[i]||s.removeChild(n),n=o;return s}function y(e){var t,n=j.rootElement.ownerDocument;if(e){d(e.documentElement);try{t=n.importNode(e.documentElement,!0)}catch(o){}}return t}function v(e){j.state=e,j.onchange&&j.onchange(j),j.onstatereadychange&&j.onstatereadychange(j)}function S(e){W=null,j.rootElement=e,e.fontFaceDecls=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),e.styles=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),e.automaticStyles=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),e.masterStyles=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),e.body=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body"),e.meta=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),e.settings=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),e.scripts=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts"),f(e)}function N(e){var t,n=y(e),a=j.rootElement;n&&"document-styles"===n.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===n.namespaceURI?(a.fontFaceDecls=i.getDirectChild(n,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),o(a,a.fontFaceDecls),t=i.getDirectChild(n,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),a.styles=t||e.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),o(a,a.styles),t=i.getDirectChild(n,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),a.automaticStyles=t||e.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),p(a.automaticStyles,"document-styles"),o(a,a.automaticStyles),n=i.getDirectChild(n,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),a.masterStyles=n||e.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),o(a,a.masterStyles),r.prefixStyleNames(a.automaticStyles,l,a.masterStyles)):v(c.INVALID)}function C(e){e=y(e);var t,n,s,l;if(e&&"document-content"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI){if(t=j.rootElement,s=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),t.fontFaceDecls&&s){l=t.fontFaceDecls;var u,d,f,m,h={};for(n=g(l),m=g(s),s=s.firstElementChild;s;){if(u=s.nextElementSibling,s.namespaceURI===a&&"font-face"===s.localName)if(d=s.getAttributeNS(a,"name"),n.hasOwnProperty(d)){if(!s.isEqualNode(n[d])){f=d;for(var b=n,S=m,N=0,C=void 0,C=f=f.replace(/\d+$/,"");b.hasOwnProperty(C)||S.hasOwnProperty(C);)N+=1,C=f+N;f=C,s.setAttributeNS(a,"style:name",f),l.appendChild(s),n[f]=s,delete m[d],h[d]=f}}else l.appendChild(s),n[d]=s,delete m[d];s=u}l=h}else s&&(t.fontFaceDecls=s,o(t,s));if(n=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),p(n,"document-content"),l&&r.changeFontFaceNames(n,l),t.automaticStyles&&n)for(l=n.firstChild;l;)t.automaticStyles.appendChild(l),l=n.firstChild;else n&&(t.automaticStyles=n,o(t,n));if(e=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body"),null===e)throw"<office:body/> tag is mising.";t.body=e,o(t,t.body)}else v(c.INVALID)}function x(e){e=y(e);var t;e&&"document-meta"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&(t=j.rootElement,t.meta=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),o(t,t.meta))}function E(e){e=y(e);var t;e&&"document-settings"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&(t=j.rootElement,t.settings=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),o(t,t.settings))}function w(e){e=y(e);var t;if(e&&"manifest"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===e.namespaceURI)for(t=j.rootElement,t.manifest=e,e=t.manifest.firstElementChild;e;)"file-entry"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===e.namespaceURI&&(X[e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),e=e.nextElementSibling}function T(e,t,n){e=i.getElementsByTagName(e,t);var o;for(o=0;o<e.length;o+=1)t=e[o],n.hasOwnProperty(t.namespaceURI)||t.parentNode.removeChild(t)}function O(e){T(e,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0}),T(e,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function A(e){var t,n,o,r=e.firstElementChild,i=[],a=e.attributes,s=a.length;for(t=0;s>t;t+=1)o=a.item(t),n=o.localName.substr(0,2).toLowerCase(),null===o.namespaceURI&&"on"===n&&i.push(o);for(s=i.length,t=0;s>t;t+=1)e.removeAttributeNode(i[t]);for(;r;)A(r),r=r.nextElementSibling}function R(e){var t=e.shift();t?z.loadAsDOM(t.path,function(n,o){o&&(O(o),A(o.documentElement)),t.handler(o),j.state===c.INVALID?runtime.log(n?"ERROR: Unable to load "+t.path+" - "+n:"ERROR: Unable to load "+t.path):(n&&runtime.log("DEBUG: Unable to load "+t.path+" - "+n),R(e))}):(f(j.rootElement),v(c.DONE))}function P(e){var t="";return odf.Namespaces.forEachPrefix(function(e,n){t+=" xmlns:"+e+'="'+n+'"'}),'<?xml version="1.0" encoding="UTF-8"?><office:'+e+" "+t+' office:version="1.2">'}function D(){var e=new xmldom.LSSerializer,t=P("document-meta");return e.filter=new odf.OdfNodeFilter,t+=e.writeToString(j.rootElement.meta,odf.Namespaces.namespaceMap),t+"</office:document-meta>"}function k(e,t){var n=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");return n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",e),n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",t),n}function I(){var e,t=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),n=t.documentElement,o=new xmldom.LSSerializer;for(e in X)X.hasOwnProperty(e)&&n.appendChild(k(e,X[e]));return o.filter=new odf.OdfNodeFilter,'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+o.writeToString(t,odf.Namespaces.namespaceMap)}function F(){var e,n,o,i=odf.Namespaces.namespaceMap,a=new xmldom.LSSerializer,s=P("document-styles");return n=h(j.rootElement.automaticStyles,"document-styles"),o=j.rootElement.masterStyles.cloneNode(!0),e=b(j.rootElement.fontFaceDecls,[o,j.rootElement.styles,n]),r.removePrefixFromStyleNames(n,l,o),a.filter=new t(o,n),s+=a.writeToString(e,i),s+=a.writeToString(j.rootElement.styles,i),s+=a.writeToString(n,i),s+=a.writeToString(o,i),s+"</office:document-styles>"}function M(){var e,t,o=odf.Namespaces.namespaceMap,r=new xmldom.LSSerializer,i=P("document-content");return t=h(j.rootElement.automaticStyles,"document-content"),e=b(j.rootElement.fontFaceDecls,[t]),r.filter=new n(j.rootElement.body,t),i+=r.writeToString(e,o),i+=r.writeToString(t,o),i+=r.writeToString(j.rootElement.body,o),i+"</office:document-content>"}function U(e,t){runtime.loadXML(e,function(e,n){if(e)t(e);else if(n){O(n),A(n.documentElement);var o=y(n);o&&"document"===o.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===o.namespaceURI?(S(o),v(c.DONE)):v(c.INVALID)}else t("No DOM was loaded.")})}function B(e,t){var n;n=j.rootElement;var r=n.meta;r||(n.meta=r=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),o(n,r)),n=r,e&&i.mapKeyValObjOntoNode(n,e,odf.Namespaces.lookupNamespaceURI),t&&i.removeKeyElementsFromNode(n,t,odf.Namespaces.lookupNamespaceURI)}function L(e,t){function n(e,t){var n;t||(t=e),n=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",t),a[e]=n,a.appendChild(n)}var o=new core.Zip("",null),r="application/vnd.oasis.opendocument."+e+(!0===t?"-template":""),i=runtime.byteArrayFromString(r,"utf8"),a=j.rootElement,s=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",e);return o.save("mimetype",i,!1,new Date),n("meta"),n("settings"),n("scripts"),n("fontFaceDecls","font-face-decls"),n("styles"),n("automaticStyles","automatic-styles"),n("masterStyles","master-styles"),n("body"),a.body.appendChild(s),X["/"]=r,X["settings.xml"]="text/xml",X["meta.xml"]="text/xml",X["styles.xml"]="text/xml",X["content.xml"]="text/xml",v(c.DONE),o}function _(){var e,t=new Date,n="";j.rootElement.settings&&j.rootElement.settings.firstElementChild&&(e=new xmldom.LSSerializer,n=P("document-settings"),e.filter=new odf.OdfNodeFilter,n+=e.writeToString(j.rootElement.settings,odf.Namespaces.namespaceMap),n+="</office:document-settings>"),(e=n)?(e=runtime.byteArrayFromString(e,"utf8"),z.save("settings.xml",e,!0,t)):z.remove("settings.xml"),n=runtime.getWindow(),e="WebODF/"+webodf.Version,n&&(e=e+" "+n.navigator.userAgent),B({"meta:generator":e},null),e=runtime.byteArrayFromString(D(),"utf8"),z.save("meta.xml",e,!0,t),e=runtime.byteArrayFromString(F(),"utf8"),z.save("styles.xml",e,!0,t),e=runtime.byteArrayFromString(M(),"utf8"),z.save("content.xml",e,!0,t),e=runtime.byteArrayFromString(I(),"utf8"),z.save("META-INF/manifest.xml",e,!0,t)}function H(e,t){_(),z.writeAs(e,function(e){t(e)})}var z,W,j=this,X={},V="";this.onstatereadychange=s,this.state=this.onchange=null,this.getMetadata=m,this.setRootElement=S,this.getContentElement=function(){var e;if(W||(e=j.rootElement.body,W=i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||i.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet")),!W)throw"Could not find content element in <office:body/>.";return W},this.getDocumentType=function(){var e=j.getContentElement();return e&&e.localName},this.isTemplate=function(){return"-template"===X["/"].substr(-9)},this.setIsTemplate=function(e){var t=X["/"],n="-template"===t.substr(-9);e!==n&&(t=e?t+"-template":t.substr(0,t.length-9),X["/"]=t,e=runtime.byteArrayFromString(t,"utf8"),z.save("mimetype",e,!1,new Date))},this.getPart=function(e){return new odf.OdfPart(e,X[e],j,z)},this.getPartData=function(e,t){z.load(e,t)},this.setMetadata=B,this.incrementEditingCycles=function(){var e=m(odf.Namespaces.metans,"editing-cycles"),e=e?parseInt(e,10):0;return isNaN(e)&&(e=0),B({"meta:editing-cycles":e+1},null),e+1},this.createByteArray=function(e,t){_(),z.createByteArray(e,t)},this.saveAs=H,this.save=function(e){H(V,e)},this.getUrl=function(){return V},this.setBlob=function(e,t,n){n=u.convertBase64ToByteArray(n),z.save(e,n,!1,new Date),X.hasOwnProperty(e)&&runtime.log(e+" has been overwritten."),X[e]=t},this.removeBlob=function(e){var t=z.remove(e);runtime.assert(t,"file is not found: "+e),delete X[e]},this.state=c.LOADING,this.rootElement=function(e){var t,n=document.createElementNS(e.namespaceURI,e.localName);e=new e.Type;for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName}),e===odf.OdfContainer.DocumentType.TEXT?z=L("text"):e===odf.OdfContainer.DocumentType.TEXT_TEMPLATE?z=L("text",!0):e===odf.OdfContainer.DocumentType.PRESENTATION?z=L("presentation"):e===odf.OdfContainer.DocumentType.PRESENTATION_TEMPLATE?z=L("presentation",!0):e===odf.OdfContainer.DocumentType.SPREADSHEET?z=L("spreadsheet"):e===odf.OdfContainer.DocumentType.SPREADSHEET_TEMPLATE?z=L("spreadsheet",!0):(V=e,z=new core.Zip(V,function(e,t){z=t,e?U(V,function(t){e&&(z.error=e+"\n"+t,v(c.INVALID))}):R([{path:"styles.xml",handler:N},{path:"content.xml",handler:C},{path:"meta.xml",handler:x},{path:"settings.xml",handler:E},{path:"META-INF/manifest.xml",handler:w}])}))},odf.OdfContainer.EMPTY=0,odf.OdfContainer.LOADING=1,odf.OdfContainer.DONE=2,odf.OdfContainer.INVALID=3,odf.OdfContainer.SAVING=4,odf.OdfContainer.MODIFIED=5,odf.OdfContainer.getContainer=function(e){return new odf.OdfContainer(e,null)}}(),odf.OdfContainer.DocumentType={TEXT:1,TEXT_TEMPLATE:2,PRESENTATION:3,PRESENTATION_TEMPLATE:4,SPREADSHEET:5,SPREADSHEET_TEMPLATE:6},gui.AnnotatableCanvas=function(){},gui.AnnotatableCanvas.prototype.refreshSize=function(){},gui.AnnotatableCanvas.prototype.getZoomLevel=function(){},gui.AnnotatableCanvas.prototype.getSizer=function(){},gui.AnnotationViewManager=function(e,t,n,o){function r(e){var t=e.annotationEndElement,n=u.createRange(),o=e.getAttributeNS(odf.Namespaces.officens,"name");t&&(n.setStart(e,e.childNodes.length),n.setEnd(t,0),e=c.getTextNodes(n,!1),e.forEach(function(e){var t;e:{for(t=e.parentNode;t.namespaceURI!==odf.Namespaces.officens||"body"!==t.localName;){if(t.namespaceURI===f&&"webodf-annotationHighlight"===t.className&&t.getAttribute("annotation")===o){t=!0;break e}t=t.parentNode}t=!1}t||(t=u.createElement("span"),t.className="webodf-annotationHighlight",t.setAttribute("annotation",o),e.parentNode.replaceChild(t,e),t.appendChild(e))})),n.detach()
}function i(t){var o=e.getSizer();t?(n.style.display="inline-block",o.style.paddingRight=d.getComputedStyle(n).width):(n.style.display="none",o.style.paddingRight=0),e.refreshSize()}function a(){l.sort(function(e,t){return 0!==(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function s(){var t;for(t=0;t<l.length;t+=1){var o=l[t],r=o.parentNode,i=r.nextElementSibling,a=i.nextElementSibling,s=r.parentNode,u=0,u=l[l.indexOf(o)-1],c=void 0,o=e.getZoomLevel();r.style.left=(n.getBoundingClientRect().left-s.getBoundingClientRect().left)/o+"px",r.style.width=n.getBoundingClientRect().width/o+"px",i.style.width=parseFloat(r.style.left)-30+"px",u&&(c=u.parentNode.getBoundingClientRect(),r.style.top=20>=(s.getBoundingClientRect().top-c.bottom)/o?Math.abs(s.getBoundingClientRect().top-c.bottom)/o+20+"px":"0px"),a.style.left=i.getBoundingClientRect().width/o+"px";var i=a.style,s=a.getBoundingClientRect().left/o,u=a.getBoundingClientRect().top/o,c=r.getBoundingClientRect().left/o,d=r.getBoundingClientRect().top/o,f=0,p=0,f=c-s,f=f*f,p=d-u,p=p*p,s=Math.sqrt(f+p);i.width=s+"px",u=Math.asin((r.getBoundingClientRect().top-a.getBoundingClientRect().top)/(o*parseFloat(a.style.width))),a.style.transform="rotate("+u+"rad)",a.style.MozTransform="rotate("+u+"rad)",a.style.WebkitTransform="rotate("+u+"rad)",a.style.msTransform="rotate("+u+"rad)"}}var l=[],u=t.ownerDocument,c=odf.OdfUtils,d=runtime.getWindow(),f="http://www.w3.org/1999/xhtml";runtime.assert(Boolean(d),"Expected to be run in an environment which has a global window, like a browser."),this.rerenderAnnotations=s,this.rehighlightAnnotations=function(){l.forEach(function(e){r(e)})},this.getMinimumHeightForAnnotationPane=function(){return"none"!==n.style.display&&0<l.length?(l[l.length-1].parentNode.getBoundingClientRect().bottom-n.getBoundingClientRect().top)/e.getZoomLevel()+"px":null},this.addAnnotation=function(e){i(!0),l.push(e),a();var t,n=u.createElement("div"),d=u.createElement("div"),f=u.createElement("div"),p=u.createElement("div");n.className="annotationWrapper",n.setAttribute("creator",c.getAnnotationCreator(e)),e.parentNode.insertBefore(n,e),d.className="annotationNote",d.appendChild(e),o&&(t=u.createElement("div"),t.className="annotationRemoveButton",d.appendChild(t)),f.className="annotationConnector horizontal",p.className="annotationConnector angular",n.appendChild(d),n.appendChild(f),n.appendChild(p),e.annotationEndElement&&r(e),s()},this.forgetAnnotations=function(){for(;l.length;){var e=l[0],t=l.indexOf(e),n=e.parentNode.parentNode;"div"===n.localName&&(n.parentNode.insertBefore(e,n),n.parentNode.removeChild(n));for(var e=e.getAttributeNS(odf.Namespaces.officens,"name"),e=u.querySelectorAll('span.webodf-annotationHighlight[annotation="'+e+'"]'),o=n=void 0,n=0;n<e.length;n+=1){for(o=e.item(n);o.firstChild;)o.parentNode.insertBefore(o.firstChild,o);o.parentNode.removeChild(o)}-1!==t&&l.splice(t,1),0===l.length&&i(!1)}}},gui.Viewport=function(){},gui.Viewport.prototype.scrollIntoView=function(){},gui.SingleScrollViewport=function(e){this.scrollIntoView=function(t,n){var o,r,i,a;a=e.offsetHeight-e.clientHeight,i=e.offsetWidth-e.clientWidth;var s=e.getBoundingClientRect();t&&s&&(o=s.left+5,r=s.top+5,i=s.right-(i+5),a=s.bottom-(a+5),n||t.top<r?e.scrollTop-=r-t.top:(t.top>a||t.bottom>a)&&(e.scrollTop=t.bottom-t.top<=a-r?e.scrollTop+(t.bottom-a):e.scrollTop+(t.top-r)),t.left<o?e.scrollLeft-=o-t.left:t.right>i&&(e.scrollLeft=t.right-t.left<=i-o?e.scrollLeft+(t.right-i):e.scrollLeft-(o-t.left)))}},function(){function e(t,n,r,i,a){var s,l,u=0;for(l in t)if(t.hasOwnProperty(l)){if(u===r){s=l;break}u+=1}s?n.getPartData(t[s].href,function(l,u){if(l)runtime.log(l);else if(u){var c="@font-face { font-family: "+(t[s].family||s)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+o.convertUTF8ArrayToBase64(u)+') format("truetype"); }';try{i.insertRule(c,i.cssRules.length)}catch(d){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(d)+"\nRule: "+c)}}else runtime.log("missing font data for "+t[s].href);e(t,n,r+1,i,a)}):a&&a()}var t=xmldom.XPath,n=odf.OdfUtils,o=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(o,r){for(var i=o.rootElement.fontFaceDecls;r.cssRules.length;)r.deleteRule(r.cssRules.length-1);if(i){var a,s,l,u,c={};if(i)for(i=t.getODFElementsWithXPath(i,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),a=0;a<i.length;a+=1)s=i[a],l=s.getAttributeNS(odf.Namespaces.stylens,"name"),u=n.getNormalizedFontFamilyName(s.getAttributeNS(odf.Namespaces.svgns,"font-family")),s=t.getODFElementsWithXPath(s,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<s.length&&(s=s[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),c[l]={href:s,family:u});e(c,o,0,r)}}}}(),odf.Formatting=function(){function e(e){return(e=C[e])?S.mergeObjects({},e):{}}function t(){for(var e,t,n=d.rootElement.fontFaceDecls,o={},n=n&&n.firstElementChild;n;)(e=n.getAttributeNS(m,"name"))&&((t=n.getAttributeNS(p,"font-family"))||0<n.getElementsByTagNameNS(p,"font-face-uri").length)&&(o[e]=t),n=n.nextElementSibling;return o}function n(e){for(var t=d.rootElement.styles.firstElementChild;t;){if(t.namespaceURI===m&&"default-style"===t.localName&&t.getAttributeNS(m,"family")===e)return t;t=t.nextElementSibling}return null}function o(e,t,n){var o,r,i;for(n=n||[d.rootElement.automaticStyles,d.rootElement.styles],i=0;i<n.length;i+=1)for(o=n[i],o=o.firstElementChild;o;){if(r=o.getAttributeNS(m,"name"),o.namespaceURI===m&&"style"===o.localName&&o.getAttributeNS(m,"family")===t&&r===e||"list-style"===t&&o.namespaceURI===g&&"list-style"===o.localName&&r===e||"data"===t&&o.namespaceURI===h&&r===e)return o;o=o.nextElementSibling}return null}function r(e){for(var t,n,o,r,i={},a=e.firstElementChild;a;){if(a.namespaceURI===m)for(o=i[a.nodeName]={},n=a.attributes,t=0;t<n.length;t+=1)r=n.item(t),o[r.name]=r.value;a=a.nextElementSibling}for(n=e.attributes,t=0;t<n.length;t+=1)r=n.item(t),i[r.name]=r.value;return i}function i(t,i){for(var a,s=d.rootElement.styles,l={},u=t.getAttributeNS(m,"family"),c=t;c;)a=r(c),l=S.mergeObjects(a,l),c=(a=c.getAttributeNS(m,"parent-style-name"))?o(a,u,[s]):null;return(c=n(u))&&(a=r(c),l=S.mergeObjects(a,l)),!1!==i&&(a=e(u),l=S.mergeObjects(a,l)),l}function a(e,t){function n(e){Object.keys(e).forEach(function(t){Object.keys(e[t]).forEach(function(e){a+="|"+t+":"+e+"|"})})}for(var o,r=e.nodeType===Node.TEXT_NODE?e.parentNode:e,i=[],a="",s=!1;r;)!s&&y.isGroupingElement(r)&&(s=!0),(o=f.determineStylesForNode(r))&&i.push(o),r=r.parentNode;return s&&(i.forEach(n),t&&(t[a]=i)),s?i:void 0}function s(e){var t={orderedStyles:[],styleProperties:{}};return e.forEach(function(e){Object.keys(e).forEach(function(n){var r,a=Object.keys(e[n])[0],s={name:a,family:n,displayName:void 0,isCommonStyle:!1};(r=o(a,n))?(n=i(r),t.styleProperties=S.mergeObjects(n,t.styleProperties),s.displayName=r.getAttributeNS(m,"display-name")||void 0,s.isCommonStyle=r.parentNode===d.rootElement.styles):runtime.log("No style element found for '"+a+"' of family '"+n+"'"),t.orderedStyles.push(s)})}),t}function l(e,t){var n={},o=[];return t||(t={}),e.forEach(function(e){a(e,n)}),Object.keys(n).forEach(function(e){t[e]||(t[e]=s(n[e])),o.push(t[e])}),o}function u(e){for(var t=d.rootElement.masterStyles.firstElementChild;t&&(t.namespaceURI!==m||"master-page"!==t.localName||t.getAttributeNS(m,"name")!==e);)t=t.nextElementSibling;return t}function c(e,t){var n;return e&&(n=N.convertMeasure(e,"px")),void 0===n&&t&&(n=N.convertMeasure(t,"px")),n}var d,f=new odf.StyleInfo,p=odf.Namespaces.svgns,m=odf.Namespaces.stylens,g=odf.Namespaces.textns,h=odf.Namespaces.numberns,b=odf.Namespaces.fons,y=odf.OdfUtils,v=core.DomUtils,S=new core.Utils,N=new core.CSSUnits,C={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=e,this.setOdfContainer=function(e){d=e},this.getFontMap=t,this.getAvailableParagraphStyles=function(){for(var e,t,n=d.rootElement.styles,o=[],n=n&&n.firstElementChild;n;)"style"===n.localName&&n.namespaceURI===m&&(e=n.getAttributeNS(m,"family"),"paragraph"===e&&(e=n.getAttributeNS(m,"name"),t=n.getAttributeNS(m,"display-name")||e,e&&t&&o.push({name:e,displayName:t}))),n=n.nextElementSibling;return o},this.isStyleUsed=function(e){var t,n=d.rootElement;return t=f.hasDerivedStyles(n,odf.Namespaces.lookupNamespaceURI,e),e=new f.UsedStyleList(n.styles).uses(e)||new f.UsedStyleList(n.automaticStyles).uses(e)||new f.UsedStyleList(n.body).uses(e),t||e},this.getDefaultStyleElement=n,this.getStyleElement=o,this.getStyleAttributes=r,this.getInheritedStyleAttributes=i,this.getFirstCommonParentStyleNameOrSelf=function(e){var t,n=d.rootElement.styles;return(t=o(e,"paragraph",[d.rootElement.automaticStyles]))&&(e=t.getAttributeNS(m,"parent-style-name"),!e)?null:(t=o(e,"paragraph",[n]))?e:null},this.hasParagraphStyle=function(e){return Boolean(o(e,"paragraph"))},this.getAppliedStyles=l,this.getAppliedStylesForElement=function(e,t){return l([e],t)[0]},this.updateStyle=function(e,n){var o,r;v.mapObjOntoNode(e,n,odf.Namespaces.lookupNamespaceURI),(o=(o=n["style:text-properties"])&&o["style:font-name"])&&!t().hasOwnProperty(o)&&(r=e.ownerDocument.createElementNS(m,"style:font-face"),r.setAttributeNS(m,"style:name",o),r.setAttributeNS(p,"svg:font-family",o),d.rootElement.fontFaceDecls.appendChild(r))},this.createDerivedStyleObject=function(e,t,n){var i=o(e,t);return runtime.assert(Boolean(i),"No style element found for '"+e+"' of family '"+t+"'"),e=i.parentNode===d.rootElement.styles?{"style:parent-style-name":e}:r(i),e["style:family"]=t,S.mergeObjects(e,n),e},this.getDefaultTabStopDistance=function(){for(var e,t=n("paragraph"),t=t&&t.firstElementChild;t;)t.namespaceURI===m&&"paragraph-properties"===t.localName&&(e=t.getAttributeNS(m,"tab-stop-distance")),t=t.nextElementSibling;return e||(e="1.25cm"),y.parseNonNegativeLength(e)},this.getMasterPageElement=u,this.getContentSize=function(e,t){var n,r,i,a,s,l,f,p,g,h;e:{if(r=o(e,t),runtime.assert("paragraph"===t||"table"===t,"styleFamily must be either paragraph or table"),r&&((r=r.getAttributeNS(m,"master-page-name"))&&((n=u(r))||runtime.log("WARN: No master page definition found for "+r)),n||(n=u("Standard")),n||(n=d.rootElement.masterStyles.getElementsByTagNameNS(m,"master-page")[0])||runtime.log("WARN: Document has no master pages defined"),n))for(r=n.getAttributeNS(m,"page-layout-name"),i=d.rootElement.automaticStyles.getElementsByTagNameNS(m,"page-layout"),a=0;a<i.length;a+=1)if(n=i.item(a),n.getAttributeNS(m,"name")===r)break e;n=null}return n||(n=v.getDirectChild(d.rootElement.styles,m,"default-page-layout")),(n=v.getDirectChild(n,m,"page-layout-properties"))?("landscape"===n.getAttributeNS(m,"print-orientation")?(r="29.7cm",i="21.001cm"):(r="21.001cm",i="29.7cm"),r=c(n.getAttributeNS(b,"page-width"),r),i=c(n.getAttributeNS(b,"page-height"),i),a=c(n.getAttributeNS(b,"margin")),void 0===a?(a=c(n.getAttributeNS(b,"margin-left"),"2cm"),s=c(n.getAttributeNS(b,"margin-right"),"2cm"),l=c(n.getAttributeNS(b,"margin-top"),"2cm"),f=c(n.getAttributeNS(b,"margin-bottom"),"2cm")):a=s=l=f=a,p=c(n.getAttributeNS(b,"padding")),void 0===p?(p=c(n.getAttributeNS(b,"padding-left"),"0cm"),g=c(n.getAttributeNS(b,"padding-right"),"0cm"),h=c(n.getAttributeNS(b,"padding-top"),"0cm"),n=c(n.getAttributeNS(b,"padding-bottom"),"0cm")):p=g=h=n=p):(r=c("21.001cm"),i=c("29.7cm"),a=s=l=f=a=c("2cm"),p=g=h=n=p=c("0cm")),{width:r-a-s-p-g,height:i-l-f-h-n}}},function(){var e=odf.Namespaces.stylens,t=odf.Namespaces.textns,n={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(e){this.derivedStyles={},this.element=e},odf.StyleTree=function(o,r){function i(n){var o,r,i,a={};if(!n)return a;for(n=n.firstElementChild;n;)(r=n.namespaceURI!==e||"style"!==n.localName&&"default-style"!==n.localName?n.namespaceURI===t&&"list-style"===n.localName?"list":n.namespaceURI!==e||"page-layout"!==n.localName&&"default-page-layout"!==n.localName?void 0:"page":n.getAttributeNS(e,"family"))&&((o=n.getAttributeNS(e,"name"))||(o=""),a.hasOwnProperty(r)?i=a[r]:a[r]=i={},i[o]=n),n=n.nextElementSibling;return a}function a(e,t){if(e.hasOwnProperty(t))return e[t];var n,o=null,r=Object.keys(e);for(n=0;n<r.length&&!(o=a(e[r[n]].derivedStyles,t));n+=1);return o}function s(t,n,o){var r,i,l;return n.hasOwnProperty(t)?(r=new odf.StyleTreeNode(n[t]),i=r.element.getAttributeNS(e,"parent-style-name"),l=null,i&&(l=a(o,i)||s(i,n,o)),l?l.derivedStyles[t]=r:o[t]=r,delete n[t],r):null}function l(e,t){e&&Object.keys(e).forEach(function(n){s(n,e,t)})}var u={};this.getStyleTree=function(){return u},function(){var e,t,a;t=i(o),a=i(r),Object.keys(n).forEach(function(n){e=u[n]={},l(t[n],e),l(a[n],e)})}()}}(),function(){function e(e,t){try{e.insertRule(t,e.cssRules.length)}catch(n){runtime.log("cannot load rule: "+t+" - "+n)}}function t(e,t){this.listCounterCount=0,this.contentRules=e,this.counterIdStack=[],this.continuedCounterIdStack=t}function n(n){function o(t,r,a,l){var u=r.namespaceURI===i&&"list"===r.localName,c=r.namespaceURI===i&&"list-item"===r.localName;if(u||c){if(u){var d,f,p,u=a+=1;for(l.listCounterCount+=1,c=t+"-level"+u+"-"+l.listCounterCount,r.setAttributeNS("urn:webodf:names:helper","counter-id",c),d=l.continuedCounterIdStack.shift(),d||(d=c,s+=c+" 1 ",f='text|list[webodfhelper|counter-id="'+c+'"] > text|list-item:first-child > :not(text|list):first-child:before',f+="{",f+="counter-increment: "+d+" 0;",f+="}",e(n,f));l.counterIdStack.length>=u;)l.counterIdStack.pop();for(l.counterIdStack.push(d),p=l.contentRules[u.toString()]||"",f=1;u>=f;f+=1)p=p.replace(f+"webodf-listLevel",l.counterIdStack[f-1]);f='text|list[webodfhelper|counter-id="'+c+'"] > text|list-item > :not(text|list):first-child:before',f+="{",f+=p,f+="counter-increment: "+d+";",f+="}",e(n,f)}for(r=r.firstElementChild;r;)o(t,r,a,l),r=r.nextElementSibling}else l.continuedCounterIdStack=[]}var r=0,s="",l={};this.createCounterRules=function(e,n,i){var s=n.getAttributeNS(a,"id"),u=[];i&&(i=i.getAttributeNS("urn:webodf:names:helper","counter-id"),u=l[i].slice(0)),e=new t(e,u),s?s="Y"+s:(r+=1,s="X"+r),o(s,n,0,e),l[s+"-level1-1"]=e.counterIdStack},this.initialiseCreatedCounters=function(){var t;t="office|document{"+("counter-reset: "+s+";"),t+="}",e(n,t)}}var o=odf.Namespaces.fons,r=odf.Namespaces.stylens,i=odf.Namespaces.textns,a=odf.Namespaces.xmlns,s={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function t(e){var t=f.parseLength(e);return t?d.convert(t.value,t.unit,"px"):(runtime.log("Could not parse value '"+e+"'."),0)}function l(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function u(e,t){var n;return e&&(n=e.getAttributeNS(i,"style-name")),n===t}function c(e,t,o){t=t.getElementsByTagNameNS(i,"list"),e=new n(e);var c,d,f,p,m,g,h,b={};for(h=0;h<t.length;h+=1)if(c=t.item(h),g=c.getAttributeNS(i,"style-name")){f=c.getAttributeNS(i,"continue-numbering"),p=c.getAttributeNS(i,"continue-list"),(m=c.getAttributeNS(a,"id"))&&(b[m]=c),m=o[g].element.firstElementChild;for(var y=void 0,v={};m;){var y=(y=m.getAttributeNS(i,"level"))&&parseInt(y,10),S=v,N=m,C="",x=void 0,E=void 0,w=x=void 0;if("list-level-style-number"===N.localName){var T=N,C=T.getAttributeNS(r,"num-format"),x=T.getAttributeNS(r,"num-suffix")||"",E=T.getAttributeNS(r,"num-prefix")||"",O="",A=T.getAttributeNS(i,"level"),T=T.getAttributeNS(i,"display-levels");if(E&&(O+='"'+l(E)+'"\n'),s.hasOwnProperty(C))for(A=A?parseInt(A,10):1,T=T?parseInt(T,10):1;T>0;)O+=" counter("+(A-T+1)+"webodf-listLevel,"+s[C]+")",T>1&&(O+='"."'),T-=1;else O=C?O+(' "'+C+'"'):O+' ""';C="content:"+O+' "'+l(x)+'"'}else"list-level-style-image"===N.localName?C="content: none":"list-level-style-bullet"===N.localName&&(C=N.getAttributeNS(i,"bullet-char"),C='content: "'+l(C)+'"');(x=N.getElementsByTagNameNS(r,"list-level-properties")[0])&&(E=x.getAttributeNS(i,"list-level-position-and-space-mode"),"label-alignment"===E&&((x=x.getElementsByTagNameNS(r,"list-level-label-alignment")[0])&&(w=x.getAttributeNS(i,"label-followed-by")),"space"===w&&(C+=' "\\a0"'))),S[y]="\n"+C+";\n",m=m.nextElementSibling}m=v,f&&!p&&u(d,g)?e.createCounterRules(m,c,d):p&&u(b[p],g)?e.createCounterRules(m,c,b[p]):e.createCounterRules(m,c),d=c}e.initialiseCreatedCounters()}var d=new core.CSSUnits,f=odf.OdfUtils;this.applyListStyles=function(n,a,s){var l,u;(l=a.list)&&Object.keys(l).forEach(function(a){u=l[a];for(var s=u.element.firstElementChild;s;){if(s.namespaceURI===i){for(var c=n,d=s,f='text|list[text|style-name="'+a+'"]',p=d.getAttributeNS(i,"level"),m=void 0,g=void 0,h=g=void 0,b=void 0,y=void 0,v=m=void 0,S=void 0,N=void 0,C=void 0,b=void 0,h=(g=d.getElementsByTagNameNS(r,"list-level-properties")[0])&&g.getAttributeNS(i,"list-level-position-and-space-mode"),b=g&&g.getElementsByTagNameNS(r,"list-level-label-alignment")[0],m=p=p&&parseInt(p,10);m>1;)f+=" > text|list-item > text|list",m-=1;switch(m=g&&g.getAttributeNS(o,"text-align")||"left"){case"end":m="right";break;case"start":m="left"}"label-alignment"===h?(y=b&&b.getAttributeNS(o,"margin-left")||"0px",N=b&&b.getAttributeNS(o,"text-indent")||"0px",C=b&&b.getAttributeNS(i,"label-followed-by"),b=t(y)):(y=g&&g.getAttributeNS(i,"space-before")||"0px",v=g&&g.getAttributeNS(i,"min-label-width")||"0px",S=g&&g.getAttributeNS(i,"min-label-distance")||"0px",b=t(y)+t(v)),g=f+" > text|list-item",g+="{",g+="margin-left: "+b+"px;",g+="}",e(c,g),g=f+" > text|list-item > text|list",g+="{",g+="margin-left: "+-b+"px;",g+="}",e(c,g),g=f+" > text|list-item > :not(text|list):first-child:before",g+="{",g+="text-align: "+m+";",g+="display: inline-block;","label-alignment"===h?(g+="margin-left: "+N+";","listtab"===C&&(g+="padding-right: 0.2cm;")):(g+="min-width: "+v+";",g+="margin-left: "+(0===parseFloat(v)?"":"-")+v+";",g+="padding-right: "+S+";"),g+="}",e(c,g)}s=s.nextElementSibling}}),c(n,s,l)}}}(),odf.LazyStyleProperties=function(e,t){var n={};this.value=function(o){var r;return n.hasOwnProperty(o)?r=n[o]:(r=t[o](),void 0===r&&e&&(r=e.value(o)),n[o]=r),r},this.reset=function(t){e=t,n={}}},odf.StyleParseUtils=function(){function e(e){var t,n;return e=(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null,n=e&&e.unit,"px"===n?t=e.value:"cm"===n?t=96*(e.value/2.54):"mm"===n?t=96*(e.value/25.4):"in"===n?t=96*e.value:"pt"===n?t=e.value/.75:"pc"===n&&(t=16*e.value),t}var t=odf.Namespaces.stylens;this.parseLength=e,this.parsePositiveLengthOrPercent=function(t,n,o){var r;t&&(r=parseFloat(t.substr(0,t.indexOf("%"))),isNaN(r)&&(r=void 0));var i;return void 0!==r?(o&&(i=o.value(n)),r=void 0===i?void 0:r*(i/100)):r=e(t),r},this.getPropertiesElement=function(e,n,o){for(n=o?o.nextElementSibling:n.firstElementChild;null!==n&&(n.localName!==e||n.namespaceURI!==t);)n=n.nextElementSibling;return n},this.parseAttributeList=function(e){return e&&(e=e.replace(/^\s*(.*?)\s*$/g,"$1")),e&&0<e.length?e.split(/\s+/):[]}},odf.Style2CSS=function(){function e(t,n,o){var r=[];o=o.derivedStyles;var i,a,s=S[t];void 0===s?n=null:(a=n?"["+s+'|style-name="'+n+'"]':"","presentation"===s&&(s="draw",a=n?'[presentation|style-name="'+n+'"]':""),n=s+"|"+N[t].join(a+","+s+"|")+a),null!==n&&r.push(n);for(i in o)o.hasOwnProperty(i)&&(n=e(t,i,o[i]),r=r.concat(n));return r}function t(e){var t="",n="",t=null;return"default-style"===e.localName?null:(t=e.getAttributeNS(p,"parent-style-name"),n=e.getAttributeNS(p,"family"),t=U.getODFElementsWithXPath(l,t?"//style:*[@style:name='"+t+"'][@style:family='"+n+"']":"//style:default-style[@style:family='"+n+"']",odf.Namespaces.lookupNamespaceURI)[0])}function n(e,n){var o,r,i,a="";for(o=0;o<n.length;o+=1)if(r=n[o],i=e.getAttributeNS(r[0],r[1])){if(i=i.trim(),k.hasOwnProperty(r[1])){var s=i,l=s.indexOf(" "),u=void 0;i=void 0,-1!==l?(u=s.substring(0,l),i=s.substring(l)):(u=s,i=""),(u=M.parseLength(u))&&"pt"===u.unit&&.75>u.value&&(s="0.75pt"+i),i=s}else if(I.hasOwnProperty(r[1])){var s=e,l=r[0],u=r[1],c=M.parseLength(i),d=void 0,f=void 0,m=void 0,g=void 0,m=void 0;if(c&&"%"===c.unit){for(d=c.value/100,f=t(s.parentNode),g="0";f;){if((m=y.getDirectChild(f,p,"paragraph-properties"))&&(m=M.parseLength(m.getAttributeNS(l,u)))){if("%"!==m.unit){g=m.value*d+m.unit;break}d*=m.value/100}f=t(f)}i=g}}r[2]&&(a+=r[2]+":"+i+";")}return a}function o(e,t,n,o){return t+t+n+n+o+o}function r(e,t){var n=[e],o=t.derivedStyles;return Object.keys(o).forEach(function(e){e=r(e,o[e]),n=n.concat(e)}),n}function i(e,t,n,o){function i(t,n){var o,r=[];t.forEach(function(e){a.forEach(function(t){r.push("draw|page[webodfhelper|page-style-name='"+t+"'] draw|frame[presentation|class='"+e+"']")})}),0<r.length&&(o=r.join(",")+"{visibility:"+n+";}",e.insertRule(o,e.cssRules.length))}var a=r(t,o),s=[],l=[];["page-number","date-time","header","footer"].forEach(function(e){var t;t=n.getAttributeNS(b,"display-"+e),"true"===t?s.push(e):"false"===t&&l.push(e)}),i(s,"visible"),i(l,"hidden")}function a(r,l,m,S){var N,k;if("page"===l){var I,U,L=S.element,_="";U=I="",m=y.getDirectChild(L,p,"page-layout-properties");var H;if(m)if(H=L.getAttributeNS(p,"name"),_+=n(m,P),(I=y.getDirectChild(m,p,"background-image"))&&(U=I.getAttributeNS(h,"href"))&&(_=_+("background-image: url('odfkit:"+U+"');")+n(I,x)),"presentation"===s)for(L=(L=y.getDirectChild(L.parentNode.parentNode,f,"master-styles"))&&L.firstElementChild;L;)L.namespaceURI===p&&"master-page"===L.localName&&L.getAttributeNS(p,"page-layout-name")===H&&(U=L.getAttributeNS(p,"name"),I="draw|page[draw|master-page-name="+U+"] {"+_+"}",U="office|body, draw|page[draw|master-page-name="+U+"] {"+n(m,D)+" }",r.insertRule(I,r.cssRules.length),r.insertRule(U,r.cssRules.length)),L=L.nextElementSibling;else"text"===s&&(I="office|text {"+_+"}",U="office|body {width: "+m.getAttributeNS(d,"page-width")+";}",r.insertRule(I,r.cssRules.length),r.insertRule(U,r.cssRules.length))}else{if(_=e(l,m,S).join(","),H="",L=y.getDirectChild(S.element,p,"text-properties")){var z=L,W=k="";switch(I="",U=1,L=""+n(z,C),N=z.getAttributeNS(p,"text-underline-style"),"solid"===N&&(k+=" underline"),N=z.getAttributeNS(p,"text-line-through-style"),"solid"===N&&(k+=" line-through"),k.length&&(L=L+("text-decoration:"+k+";\n")+("text-decoration-line:"+k+";\n"),L+="-moz-text-decoration-line:"+k+";\n"),N=z.getAttributeNS(p,"text-line-through-type")){case"double":W+=" double";break;case"single":W+=" single"}if(W&&(L+="text-decoration-style:"+W+";\n",L+="-moz-text-decoration-style:"+W+";\n"),(k=z.getAttributeNS(p,"font-name")||z.getAttributeNS(d,"font-family"))&&(N=F[k],L+="font-family: "+(N||k)+";"),(N=z.getAttributeNS(p,"text-position"))&&(k=v.parseAttributeList(N),N=k[0],k=k[1],L+="vertical-align: "+N+"\n; ",k&&(U=parseFloat(k)/100)),z.hasAttributeNS(d,"font-size")||1!==U){for(z=z.parentNode;z;){if(N=(N=y.getDirectChild(z,p,"text-properties"))?M.parseFoFontSize(N.getAttributeNS(d,"font-size")):null){if("%"!==N.unit){I="font-size: "+N.value*U+N.unit+";";break}U*=N.value/100}z=t(z)}I||(I="font-size: "+parseFloat(u)*U+B.getUnits(u)+";")}L+=I,H+=L}(L=y.getDirectChild(S.element,p,"paragraph-properties"))&&(I=L,L=""+n(I,E),(U=y.getDirectChild(I,p,"background-image"))&&(z=U.getAttributeNS(h,"href"))&&(L=L+("background-image: url('odfkit:"+z+"');")+n(U,x)),(I=I.getAttributeNS(d,"line-height"))&&"normal"!==I&&(I=M.parseFoLineHeight(I),L="%"!==I.unit?L+("line-height: "+I.value+I.unit+";"):L+("line-height: "+I.value/100+";")),H+=L),(L=y.getDirectChild(S.element,p,"graphic-properties"))&&(z=L,L=""+n(z,w),I=z.getAttributeNS(c,"opacity"),U=z.getAttributeNS(c,"fill"),z=z.getAttributeNS(c,"fill-color"),"solid"===U||"hatch"===U?z&&"none"!==z?(I=isNaN(parseFloat(I))?1:parseFloat(I)/100,U=z.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,o),(z=(U=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(U))?{r:parseInt(U[1],16),g:parseInt(U[2],16),b:parseInt(U[3],16)}:null)&&(L+="background-color: rgba("+z.r+","+z.g+","+z.b+","+I+");")):L+="background: none;":"none"===U&&(L+="background: none;"),H+=L),(L=y.getDirectChild(S.element,p,"drawing-page-properties"))&&(I=L,U=""+n(I,w),"true"===I.getAttributeNS(b,"background-visible")&&(U+="background: none;"),H+=U,i(r,m,L,S)),(L=y.getDirectChild(S.element,p,"table-cell-properties"))&&(m=H,H=""+n(L,T),H=m+H),(L=y.getDirectChild(S.element,p,"table-row-properties"))&&(m=H,H=""+n(L,A),H=m+H),(L=y.getDirectChild(S.element,p,"table-column-properties"))&&(m=H,H=""+n(L,O),H=m+H),(L=y.getDirectChild(S.element,p,"table-properties"))&&(m=H,H=""+n(L,R),L=L.getAttributeNS(g,"border-model"),"collapsing"===L?H+="border-collapse:collapse;":"separating"===L&&(H+="border-collapse:separate;"),H=m+H),0!==H.length&&r.insertRule(_+"{"+H+"}",r.cssRules.length)}for(var j in S.derivedStyles)S.derivedStyles.hasOwnProperty(j)&&a(r,l,j,S.derivedStyles[j])}var s,l,u,c=odf.Namespaces.drawns,d=odf.Namespaces.fons,f=odf.Namespaces.officens,p=odf.Namespaces.stylens,m=odf.Namespaces.svgns,g=odf.Namespaces.tablens,h=odf.Namespaces.xlinkns,b=odf.Namespaces.presentationns,y=core.DomUtils,v=new odf.StyleParseUtils,S={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},N={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),list:["list-item"]},C=[[d,"color","color"],[d,"background-color","background-color"],[d,"font-weight","font-weight"],[d,"font-style","font-style"]],x=[[p,"repeat","background-repeat"]],E=[[d,"background-color","background-color"],[d,"text-align","text-align"],[d,"text-indent","text-indent"],[d,"padding","padding"],[d,"padding-left","padding-left"],[d,"padding-right","padding-right"],[d,"padding-top","padding-top"],[d,"padding-bottom","padding-bottom"],[d,"border-left","border-left"],[d,"border-right","border-right"],[d,"border-top","border-top"],[d,"border-bottom","border-bottom"],[d,"margin","margin"],[d,"margin-left","margin-left"],[d,"margin-right","margin-right"],[d,"margin-top","margin-top"],[d,"margin-bottom","margin-bottom"],[d,"border","border"]],w=[[d,"background-color","background-color"],[d,"min-height","min-height"],[c,"stroke","border"],[m,"stroke-color","border-color"],[m,"stroke-width","border-width"],[d,"border","border"],[d,"border-left","border-left"],[d,"border-right","border-right"],[d,"border-top","border-top"],[d,"border-bottom","border-bottom"]],T=[[d,"background-color","background-color"],[d,"border-left","border-left"],[d,"border-right","border-right"],[d,"border-top","border-top"],[d,"border-bottom","border-bottom"],[d,"border","border"]],O=[[p,"column-width","width"]],A=[[p,"row-height","height"],[d,"keep-together",null]],R=[[p,"width","width"],[d,"margin-left","margin-left"],[d,"margin-right","margin-right"],[d,"margin-top","margin-top"],[d,"margin-bottom","margin-bottom"]],P=[[d,"background-color","background-color"],[d,"padding","padding"],[d,"padding-left","padding-left"],[d,"padding-right","padding-right"],[d,"padding-top","padding-top"],[d,"padding-bottom","padding-bottom"],[d,"border","border"],[d,"border-left","border-left"],[d,"border-right","border-right"],[d,"border-top","border-top"],[d,"border-bottom","border-bottom"],[d,"margin","margin"],[d,"margin-left","margin-left"],[d,"margin-right","margin-right"],[d,"margin-top","margin-top"],[d,"margin-bottom","margin-bottom"]],D=[[d,"page-width","width"],[d,"page-height","height"]],k={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},I={margin:!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"margin-bottom":!0},F={},M=odf.OdfUtils,U=xmldom.XPath,B=new core.CSSUnits;this.style2css=function(e,t,n,o,r){function i(e,t){c="@namespace "+e+" url("+t+");";try{n.insertRule(c,n.cssRules.length)}catch(o){}}var c,d,f;for(l=t;n.cssRules.length;)n.deleteRule(n.cssRules.length-1);odf.Namespaces.forEachPrefix(i),i("webodfhelper","urn:webodf:names:helper"),F=o,s=e,u=runtime.getWindow().getComputedStyle(document.body,null).getPropertyValue("font-size")||"12pt";for(f in S)if(S.hasOwnProperty(f))for(d in e=r[f])e.hasOwnProperty(d)&&a(n,f,d,e[d])}},function(){function e(t,n){var o=this;this.getDistance=function(e){var t=o.x-e.x;return e=o.y-e.y,Math.sqrt(t*t+e*e)},this.getCenter=function(t){return new e((o.x+t.x)/2,(o.y+t.y)/2)},o.x=t,o.y=n}gui.ZoomHelper=function(){function t(e,t,n,o){e=o?"translate3d("+e+"px, "+t+"px, 0) scale3d("+n+", "+n+", 1)":"translate("+e+"px, "+t+"px) scale("+n+")",f.style.WebkitTransform=e,f.style.MozTransform=e,f.style.msTransform=e,f.style.OTransform=e,f.style.transform=e}function n(e){e?t(-p.x,-p.y,h,!0):(t(0,0,h,!0),t(0,0,h,!1))}function o(e){if(y&&E){var t=y.style.overflow,n=y.classList.contains("webodf-customScrollbars");e&&n||!e&&!n||(e?(y.classList.add("webodf-customScrollbars"),y.style.overflow="hidden",runtime.requestAnimationFrame(function(){y.style.overflow=t})):y.classList.remove("webodf-customScrollbars"))}}function r(){t(-p.x,-p.y,h,!0),y.scrollLeft=0,y.scrollTop=0,w=v.style.overflow,v.style.overflow="visible",o(!1)}function i(){t(0,0,h,!0),y.scrollLeft=p.x,y.scrollTop=p.y,v.style.overflow=w||"",o(!0)}function a(t){return new e(t.pageX-f.offsetLeft,t.pageY-f.offsetTop)}function s(t){m&&(p.x-=t.x-m.x,p.y-=t.y-m.y,p=new e(Math.min(Math.max(p.x,f.offsetLeft),(f.offsetLeft+f.offsetWidth)*h-y.clientWidth),Math.min(Math.max(p.y,f.offsetTop),(f.offsetTop+f.offsetHeight)*h-y.clientHeight))),m=t}function l(e){var t=e.touches.length,n=t>0?a(e.touches[0]):null;e=t>1?a(e.touches[1]):null,n&&e?(g=n.getDistance(e),b=h,m=n.getCenter(e),r(),x=C.PINCH):n&&(m=n,x=C.SCROLL)}function u(e){var t=e.touches.length,o=t>0?a(e.touches[0]):null,t=t>1?a(e.touches[1]):null;if(o&&t)if(e.preventDefault(),x===C.SCROLL)x=C.PINCH,r(),g=o.getDistance(t);else{e=o.getCenter(t),o=o.getDistance(t)/g,s(e);var t=h,l=Math.min(S,f.offsetParent.clientWidth/f.offsetWidth);h=b*o,h=Math.min(Math.max(h,l),S),o=h/t,p.x+=(o-1)*(e.x+p.x),p.y+=(o-1)*(e.y+p.y),n(!0)}else o&&(x===C.PINCH?(x=C.SCROLL,i()):s(o))}function c(){x===C.PINCH&&(N.emit(gui.ZoomHelper.signalZoomChanged,h),i(),n(!1)),x=C.NONE}function d(){y&&(y.removeEventListener("touchstart",l,!1),y.removeEventListener("touchmove",u,!1),y.removeEventListener("touchend",c,!1))}var f,p,m,g,h,b,y,v,S=4,N=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),C={NONE:0,SCROLL:1,PINCH:2},x=C.NONE,E=runtime.getWindow().hasOwnProperty("ontouchstart"),w="";
this.subscribe=function(e,t){N.subscribe(e,t)},this.unsubscribe=function(e,t){N.unsubscribe(e,t)},this.getZoomLevel=function(){return h},this.setZoomLevel=function(e){f&&(h=e,n(!1),N.emit(gui.ZoomHelper.signalZoomChanged,h))},this.destroy=function(e){d(),o(!1),e()},this.setZoomableElement=function(e){d(),f=e,y=f.offsetParent,v=f.parentNode,n(!1),y&&(y.addEventListener("touchstart",l,!1),y.addEventListener("touchmove",u,!1),y.addEventListener("touchend",c,!1)),o(!0)},b=h=1,p=new e(0,0)},gui.ZoomHelper.signalZoomChanged="zoomChanged"}(),ops.Canvas=function(){},ops.Canvas.prototype.getZoomLevel=function(){},ops.Canvas.prototype.getElement=function(){},ops.Canvas.prototype.getSizer=function(){},ops.Canvas.prototype.getZoomHelper=function(){},function(){function e(){function e(o){n=!0,runtime.setTimeout(function(){try{o()}catch(r){runtime.log(String(r)+"\n"+r.stack)}n=!1,0<t.length&&e(t.pop())},10)}var t=[],n=!1;this.clearQueue=function(){t.length=0},this.addToQueue=function(o){return 0!==t.length||n?void t.push(o):e(o)}}function t(e){function t(){for(;0<n.cssRules.length;)n.deleteRule(0);n.insertRule("#shadowContent draw|page {display:none;}",0),n.insertRule("office|presentation draw|page {display:none;}",1),n.insertRule("#shadowContent draw|page:nth-of-type("+o+") {display:block;}",2),n.insertRule("office|presentation draw|page:nth-of-type("+o+") {display:block;}",3)}var n=e.sheet,o=1;this.showFirstPage=function(){o=1,t()},this.showNextPage=function(){o+=1,t()},this.showPreviousPage=function(){o>1&&(o-=1,t())},this.showPage=function(e){e>0&&(o=e,t())},this.css=e,this.destroy=function(t){e.parentNode.removeChild(e),t()}}function n(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function o(e){e=e.sheet;for(var t=e.cssRules;t.length;)e.deleteRule(t.length-1)}function r(e,t,n){var o=new odf.Style2CSS,r=new odf.ListStyleToCss;n=n.sheet;var i=new odf.StyleTree(e.rootElement.styles,e.rootElement.automaticStyles).getStyleTree();o.style2css(e.getDocumentType(),e.rootElement,n,t.getFontMap(),i),r.applyListStyles(n,i,e.rootElement.body)}function i(e,t){(new odf.FontLoader).loadFonts(e,t.sheet)}function a(e,t,n){var o=null;e=e.rootElement.body.getElementsByTagNameNS(T,n+"-decl"),n=t.getAttributeNS(T,"use-"+n+"-name");var r;if(n&&0<e.length)for(t=0;t<e.length;t+=1)if(r=e[t],r.getAttributeNS(T,"name")===n){o=r.textContent;break}return o}function s(e,t,o,r){var i=e.ownerDocument;for(t=A.getElementsByTagNameNS(e,t,o),e=0;e<t.length;e+=1)n(t[e]),r&&(o=t[e],o.appendChild(i.createTextNode(r)))}function l(e,t,n){t.setAttributeNS("urn:webodf:names:helper","styleid",e);var o,r=t.getAttributeNS(E,"anchor-type"),i=t.getAttributeNS(C,"x"),a=t.getAttributeNS(C,"y"),s=t.getAttributeNS(C,"width"),l=t.getAttributeNS(C,"height"),u=t.getAttributeNS(v,"min-height"),c=t.getAttributeNS(v,"min-width");"as-char"===r?o="display: inline-block;":r||i||a?o="position: absolute;":(s||l||u||c)&&(o="display: block;"),i&&(o+="left: "+i+";"),a&&(o+="top: "+a+";"),s&&(o+="width: "+s+";"),l&&(o+="height: "+l+";"),u&&(o+="min-height: "+u+";"),c&&(o+="min-width: "+c+";"),o&&(o="draw|"+t.localName+'[webodfhelper|styleid="'+e+'"] {'+o+"}",n.insertRule(o,n.cssRules.length))}function u(e){for(e=e.firstChild;e;){if(e.namespaceURI===S&&"binary-data"===e.localName)return"data:image/png;base64,"+e.textContent.replace(/[\r\n\s]/g,"");e=e.nextSibling}return""}function c(e,t,n,o){function r(t){t&&(t='draw|image[webodfhelper|styleid="'+e+'"] {'+("background-image: url("+t+");")+"}",o.insertRule(t,o.cssRules.length))}function i(e){r(e.url)}n.setAttributeNS("urn:webodf:names:helper","styleid",e);var a,s=n.getAttributeNS(w,"href");if(s)try{a=t.getPart(s),a.onchange=i,a.load()}catch(l){runtime.log("slight problem: "+String(l))}else s=u(n),r(s)}function d(e){var t=e.ownerDocument;A.getElementsByTagNameNS(e,E,"line-break").forEach(function(e){e.hasChildNodes()||e.appendChild(t.createElement("br"))})}function f(e){var t=e.ownerDocument;A.getElementsByTagNameNS(e,E,"s").forEach(function(e){for(var n,o;e.firstChild;)e.removeChild(e.firstChild);if(e.appendChild(t.createTextNode(" ")),o=parseInt(e.getAttributeNS(E,"c"),10),o>1)for(e.removeAttributeNS(E,"c"),n=1;o>n;n+=1)e.parentNode.insertBefore(e.cloneNode(!0),e)})}function p(e){A.getElementsByTagNameNS(e,E,"tab").forEach(function(e){e.textContent="	"})}function m(e,t){function n(e,n){var o=l.documentElement.namespaceURI;"video/"===n.substr(0,6)?(r=l.createElementNS(o,"video"),r.setAttribute("controls","controls"),i=l.createElementNS(o,"source"),e&&i.setAttribute("src",e),i.setAttribute("type",n),r.appendChild(i),t.parentNode.appendChild(r)):t.innerHtml="Unrecognised Plugin"}function o(e){n(e.url,e.mimetype)}var r,i,a,s,l=t.ownerDocument;if(a=t.getAttributeNS(w,"href"))try{s=e.getPart(a),s.onchange=o,s.load()}catch(c){runtime.log("slight problem: "+String(c))}else runtime.log("using MP4 data fallback"),a=u(t),n(a,"video/mp4")}function g(e){var t,n,o=e.getElementsByTagName("head")[0];for(t=e.styleSheets.length,n=o.firstElementChild;n&&("style"!==n.localName||!n.hasAttribute("webodfcss"));)n=n.nextElementSibling;return n?(t=parseInt(n.getAttribute("webodfcss"),10),n.setAttribute("webodfcss",t+1),n):("string"===String(typeof webodf_css)?t=webodf_css:(n="webodf.css",runtime.currentDirectory&&(n=runtime.currentDirectory(),0<n.length&&"/"!==n.substr(-1)&&(n+="/"),n+="../webodf.css"),t=runtime.readFileSync(n,"utf-8")),n=e.createElementNS(o.namespaceURI,"style"),n.setAttribute("media","screen, print, handheld, projection"),n.setAttribute("type","text/css"),n.setAttribute("webodfcss","1"),n.appendChild(e.createTextNode(t)),o.appendChild(n),n)}function h(e){var t=parseInt(e.getAttribute("webodfcss"),10);1===t?e.parentNode.removeChild(e):e.setAttribute("count",t-1)}function b(e){var t=e.getElementsByTagName("head")[0],n=e.createElementNS(t.namespaceURI,"style"),o="";return n.setAttribute("type","text/css"),n.setAttribute("media","screen, print, handheld, projection"),odf.Namespaces.forEachPrefix(function(e,t){o+="@namespace "+e+" url("+t+");\n"}),o+="@namespace webodfhelper url(urn:webodf:names:helper);\n",n.appendChild(e.createTextNode(o)),t.appendChild(n),n}var y=odf.Namespaces.drawns,v=odf.Namespaces.fons,S=odf.Namespaces.officens,N=odf.Namespaces.stylens,C=odf.Namespaces.svgns,x=odf.Namespaces.tablens,E=odf.Namespaces.textns,w=odf.Namespaces.xlinkns,T=odf.Namespaces.presentationns,O=xmldom.XPath,A=core.DomUtils;odf.OdfCanvas=function(u,v){function C(e,t,n){function o(e,t,n,o){et.addToQueue(function(){c(e,t,n,o)})}var r,i;for(r=t.getElementsByTagNameNS(y,"image"),t=0;t<r.length;t+=1)i=r.item(t),o("image"+String(t),e,i,n)}function w(e,t){function n(e,t){et.addToQueue(function(){m(e,t)})}var o,r,i;for(r=t.getElementsByTagNameNS(y,"plugin"),o=0;o<r.length;o+=1)i=r.item(o),n(e,i)}function R(){var e;e=Z.firstChild;var t=tt.getZoomLevel();e&&(Z.style.WebkitTransformOrigin="0% 0%",Z.style.MozTransformOrigin="0% 0%",Z.style.msTransformOrigin="0% 0%",Z.style.OTransformOrigin="0% 0%",Z.style.transformOrigin="0% 0%",G&&((e=G.getMinimumHeightForAnnotationPane())?Z.style.minHeight=e:Z.style.removeProperty("min-height")),u.style.width=Math.round(t*Z.offsetWidth)+"px",u.style.height=Math.round(t*Z.offsetHeight)+"px",u.style.display="inline-block")}function P(e,t){var o=_.sheet;n(u),Z=X.createElementNS(u.namespaceURI,"div"),Z.style.display="inline-block",Z.style.background="white",Z.style.setProperty("float","left","important"),Z.appendChild(t),u.appendChild(Z),q=X.createElementNS(u.namespaceURI,"div"),q.id="annotationsPane",H=X.createElementNS(u.namespaceURI,"div"),H.id="shadowContent",H.style.position="absolute",H.style.top=0,H.style.left=0,e.getContentElement().appendChild(H);var r,i,c=t.body,m=[];for(r=c.firstElementChild;r&&r!==c;)if(r.namespaceURI===y&&(m[m.length]=r),r.firstElementChild)r=r.firstElementChild;else{for(;r&&r!==c&&!r.nextElementSibling;)r=r.parentNode;r&&r.nextElementSibling&&(r=r.nextElementSibling)}for(i=0;i<m.length;i+=1)r=m[i],l("frame"+String(i),r,o);for(m=O.getODFElementsWithXPath(c,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI),r=0;r<m.length;r+=1)c=m[r],c.setAttributeNS&&c.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0);c=V,r=H;var g,h,b,v,R,P=0;if(i=e.rootElement.ownerDocument,(m=t.body.firstElementChild)&&m.namespaceURI===S&&("presentation"===m.localName||"drawing"===m.localName))for(m=m.firstElementChild;m;){if(g=(g=m.getAttributeNS(y,"master-page-name"))?c.getMasterPageElement(g):null){for(h=m.getAttributeNS("urn:webodf:names:helper","styleid"),b=i.createElementNS(y,"draw:page"),R=g.firstElementChild,P=0;R;)"true"!==R.getAttributeNS(T,"placeholder")&&(v=R.cloneNode(!0),b.appendChild(v)),R=R.nextElementSibling,P+=1;R=v=P=void 0;for(var D=A.getElementsByTagNameNS(b,y,"frame"),P=0;P<D.length;P+=1)v=D[P],(R=v.getAttributeNS(T,"class"))&&!/^(date-time|footer|header|page-number)$/.test(R)&&v.parentNode.removeChild(v);for(v=A.getElementsByTagNameNS(b,y,"*"),P=0;P<v.length;P+=1)l(h+"_"+P,v[P],o);r.appendChild(b),P=String(r.getElementsByTagNameNS(y,"page").length),s(b,E,"page-number",P),s(b,T,"header",a(e,m,"header")),s(b,T,"footer",a(e,m,"footer")),l(h,b,o),b.setAttributeNS("urn:webodf:names:helper","page-style-name",m.getAttributeNS(y,"style-name")),b.setAttributeNS(y,"draw:master-page-name",g.getAttributeNS(N,"name"))}m=m.nextElementSibling}for(c=u.namespaceURI,m=A.getElementsByTagNameNS(t.body,x,"table-cell"),r=0;r<m.length;r+=1)i=m[r],i.hasAttributeNS(x,"number-columns-spanned")&&i.setAttributeNS(c,"colspan",i.getAttributeNS(x,"number-columns-spanned")),i.hasAttributeNS(x,"number-rows-spanned")&&i.setAttributeNS(c,"rowspan",i.getAttributeNS(x,"number-rows-spanned"));d(t.body),f(t.body),p(t.body),C(e,t.body,o),w(e,t.body),Z.insertBefore(H,Z.firstChild),tt.setZoomableElement(Z)}function D(e){K?(q.parentNode||Z.appendChild(q),G&&G.forgetAnnotations(),G=new gui.AnnotationViewManager(j,e.body,q,J),A.getElementsByTagNameNS(e.body,S,"annotation").forEach(G.addAnnotation),G.rerenderAnnotations(),R()):q.parentNode&&(Z.removeChild(q),G.forgetAnnotations(),R())}function k(e){function t(){o(B),o(L),o(_),n(u),u.style.display="inline-block";var t=F.rootElement;u.ownerDocument.importNode(t,!0),V.setOdfContainer(F),i(F,B),r(F,V,L),P(F,t),D(t),e||et.addToQueue(function(){var e=[F];if(Y.hasOwnProperty("statereadychange")){var t,n=Y.statereadychange;for(t=0;t<n.length;t+=1)n[t].apply(null,e)}})}F.state===odf.OdfContainer.DONE?t():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),z=runtime.setTimeout(function a(){F.state===odf.OdfContainer.DONE?t():(runtime.log("will be back later..."),z=runtime.setTimeout(a,500))},100))}function I(e){et.clearQueue(),u.innerHTML=runtime.tr("Loading")+" "+e+"...",u.removeAttribute("style"),F=new odf.OdfContainer(e,function(e){F=e,k(!1)})}runtime.assert(null!==u&&void 0!==u,"odf.OdfCanvas constructor needs DOM element"),runtime.assert(null!==u.ownerDocument&&void 0!==u.ownerDocument,"odf.OdfCanvas constructor needs DOM");var F,M,U,B,L,_,H,z,W,j=this,X=u.ownerDocument,V=new odf.Formatting,Z=null,q=null,K=!1,J=!1,G=null,Y={},Q=!1,$=!1,et=new e,tt=new gui.ZoomHelper,nt=v||new gui.SingleScrollViewport(u.parentNode);this.refreshCSS=function(){Q=!0,W.trigger()},this.refreshSize=function(){W.trigger()},this.odfContainer=function(){return F},this.setOdfContainer=function(e,t){F=e,k(!0===t)},this.load=this.load=I,this.save=function(e){F.save(e)},this.addListener=function(e,t){switch(e){case"click":var n=u,o=e;n.addEventListener?n.addEventListener(o,t,!1):n.attachEvent?n.attachEvent("on"+o,t):n["on"+o]=t;break;default:n=Y.hasOwnProperty(e)?Y[e]:Y[e]=[],t&&-1===n.indexOf(t)&&n.push(t)}},this.getFormatting=function(){return V},this.getAnnotationViewManager=function(){return G},this.refreshAnnotations=function(){D(F.rootElement)},this.rerenderAnnotations=function(){G&&($=!0,W.trigger())},this.getSizer=function(){return Z},this.enableAnnotations=function(e,t){e!==K&&(K=e,J=t,F&&D(F.rootElement))},this.addAnnotation=function(e){G&&(G.addAnnotation(e),R())},this.forgetAnnotations=function(){G&&(G.forgetAnnotations(),R())},this.getZoomHelper=function(){return tt},this.setZoomLevel=function(e){tt.setZoomLevel(e)},this.getZoomLevel=function(){return tt.getZoomLevel()},this.fitToContainingElement=function(e,t){var n=tt.getZoomLevel(),o=u.offsetHeight/n,n=e/(u.offsetWidth/n);n>t/o&&(n=t/o),tt.setZoomLevel(n)},this.fitToWidth=function(e){var t=u.offsetWidth/tt.getZoomLevel();tt.setZoomLevel(e/t)},this.fitSmart=function(e,t){var n,o;o=tt.getZoomLevel(),n=u.offsetWidth/o,o=u.offsetHeight/o,n=e/n,void 0!==t&&n>t/o&&(n=t/o),tt.setZoomLevel(Math.min(1,n))},this.fitToHeight=function(e){var t=u.offsetHeight/tt.getZoomLevel();tt.setZoomLevel(e/t)},this.showFirstPage=function(){M.showFirstPage()},this.showNextPage=function(){M.showNextPage()},this.showPreviousPage=function(){M.showPreviousPage()},this.showPage=function(e){M.showPage(e),R()},this.getElement=function(){return u},this.getViewport=function(){return nt},this.addCssForFrameWithImage=function(e){var t=e.getAttributeNS(y,"name"),n=e.firstElementChild;l(t,e,_.sheet),n&&c(t+"img",F,n,_.sheet)},this.destroy=function(e){var t=X.getElementsByTagName("head")[0],n=[M.destroy,W.destroy];runtime.clearTimeout(z),q&&q.parentNode&&q.parentNode.removeChild(q),tt.destroy(function(){Z&&(u.removeChild(Z),Z=null)}),h(U),t.removeChild(B),t.removeChild(L),t.removeChild(_),core.Async.destroyAll(n,e)},U=g(X),M=new t(b(X)),B=b(X),L=b(X),_=b(X),W=core.Task.createRedrawTask(function(){Q&&(r(F,V,L),Q=!1),$&&(G&&G.rerenderAnnotations(),$=!1),R()}),tt.subscribe(gui.ZoomHelper.signalZoomChanged,R)}}(),odf.StepUtils=function(){this.getContentBounds=function(e){var t,n,o=e.container();return runtime.assert(e.isStep(),"Step iterator must be on a step"),o.nodeType===Node.TEXT_NODE&&0<e.offset()?t=e.offset():(o=e.leftNode())&&o.nodeType===Node.TEXT_NODE&&(t=o.length),o&&(o.nodeType===Node.TEXT_NODE?(runtime.assert(t>0,"Empty text node found"),n={container:o,startOffset:t-1,endOffset:t}):n={container:o,startOffset:0,endOffset:o.childNodes.length}),n}},ops.MemberProperties=function(){},ops.Member=function(e,t){var n=new ops.MemberProperties;this.getMemberId=function(){return e},this.getProperties=function(){return n},this.setProperties=function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})},this.removeProperties=function(e){Object.keys(e).forEach(function(e){"fullName"!==e&&"color"!==e&&"imageUrl"!==e&&n.hasOwnProperty(e)&&delete n[e]})},runtime.assert(Boolean(e),"No memberId was supplied!"),t.fullName||(t.fullName=runtime.tr("Unknown Author")),t.color||(t.color="black"),t.imageUrl||(t.imageUrl="avatar-joe.png"),n=t},ops.Document=function(){},ops.Document.prototype.getMemberIds=function(){},ops.Document.prototype.removeCursor=function(){},ops.Document.prototype.getDocumentElement=function(){},ops.Document.prototype.getRootNode=function(){},ops.Document.prototype.getDOMDocument=function(){},ops.Document.prototype.cloneDocumentElement=function(){},ops.Document.prototype.setDocumentElement=function(){},ops.Document.prototype.subscribe=function(){},ops.Document.prototype.unsubscribe=function(){},ops.Document.prototype.getCanvas=function(){},ops.Document.prototype.createRootFilter=function(){},ops.Document.prototype.createPositionIterator=function(){},ops.Document.signalCursorAdded="cursor/added",ops.Document.signalCursorRemoved="cursor/removed",ops.Document.signalCursorMoved="cursor/moved",ops.Document.signalMemberAdded="member/added",ops.Document.signalMemberUpdated="member/updated",ops.Document.signalMemberRemoved="member/removed",ops.OdtCursor=function(e,t){var n,o,r=this,i={},a=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){o.remove()},this.subscribe=function(e,t){a.subscribe(e,t)},this.unsubscribe=function(e,t){a.unsubscribe(e,t)},this.getMemberId=function(){return e},this.getNode=function(){return o.getNode()},this.getAnchorNode=function(){return o.getAnchorNode()},this.getSelectedRange=function(){return o.getSelectedRange()},this.setSelectedRange=function(e,t){o.setSelectedRange(e,t),a.emit(ops.OdtCursor.signalCursorUpdated,r)},this.hasForwardSelection=function(){return o.hasForwardSelection()},this.getDocument=function(){return t},this.getSelectionType=function(){return n},this.setSelectionType=function(e){i.hasOwnProperty(e)?n=e:runtime.log("Invalid selection type: "+e)},this.resetSelectionType=function(){r.setSelectionType(ops.OdtCursor.RangeSelection)},o=new core.Cursor(t.getDOMDocument(),e),i[ops.OdtCursor.RangeSelection]=!0,i[ops.OdtCursor.RegionSelection]=!0,r.resetSelectionType()},ops.OdtCursor.RangeSelection="Range",ops.OdtCursor.RegionSelection="Region",ops.OdtCursor.signalCursorUpdated="cursorUpdated",function(){var e=0;ops.StepsCache=function(t,n,o){function r(e,t){var n=this;this.nodeId=e,this.steps=-1,this.node=t,this.previousBookmark=this.nextBookmark=null,this.setIteratorPosition=function(e){e.setPositionBeforeElement(t),o(n.steps,e)}}function i(e,t,n){var r=this;this.nodeId=e,this.steps=t,this.node=n,this.previousBookmark=this.nextBookmark=null,this.setIteratorPosition=function(e){e.setUnfilteredPosition(n,0),o(r.steps,e)}}function a(e,t){var n="["+e.nodeId;return t&&(n+=" => "+t.nodeId),n+"]"}function s(){for(var e,n,o,r=p,i=new core.LoopWatchDog(0,1e5),s={};r;)i.check(),(e=r.previousBookmark)?runtime.assert(e.nextBookmark===r,"Broken bookmark link to previous @"+a(e,r)):(runtime.assert(r===p,"Broken bookmark link @"+a(r)),runtime.assert(void 0===m||p===p||p.steps<=m,"Base point is damaged @"+a(r))),(n=r.nextBookmark)&&runtime.assert(n.previousBookmark===r,"Broken bookmark link to next @"+a(r,n)),(void 0===m||r===p||r.steps<=m)&&(runtime.assert(v.containsNode(t,r.node),"Disconnected node is being reported as undamaged @"+a(r)),e&&(o=r.node.compareDocumentPosition(e.node),runtime.assert(0===o||0!==(o&N),"Bookmark order with previous does not reflect DOM order @"+a(e,r))),n&&v.containsNode(t,n.node)&&(o=r.node.compareDocumentPosition(n.node),runtime.assert(0===o||0!==(o&S),"Bookmark order with next does not reflect DOM order @"+a(r,n)))),r=r.nextBookmark;Object.keys(b).forEach(function(e){var t=b[e];(void 0===m||m>=e)&&runtime.assert(t.steps<=e,"Bookmark step of "+t.steps+" exceeds cached step lookup for "+e+" @"+a(t)),runtime.assert(!1===s.hasOwnProperty(t.nodeId),"Bookmark "+a(t)+" appears twice in cached step lookup at steps "+s[t.nodeId]+" and "+e),s[t.nodeId]=e})}function l(e){var t="";return e.nodeType===Node.ELEMENT_NODE&&(t=e.getAttributeNS(h,"nodeId")||""),t}function u(t){var n=e.toString();return t.setAttributeNS(h,"nodeId",n),e+=1,n}function c(e){var t,o,r=new core.LoopWatchDog(0,1e4);for(void 0!==m&&e>m&&(e=m),t=Math.floor(e/n)*n;!o&&t>=0;)o=b[t],t-=n;for(o=o||p;o.nextBookmark&&o.nextBookmark.steps<=e;)r.check(),o=o.nextBookmark;return runtime.assert(-1===e||o.steps<=e,"Bookmark @"+a(o)+" at step "+o.steps+" exceeds requested step of "+e),o}function d(e){e.previousBookmark&&(e.previousBookmark.nextBookmark=e.nextBookmark),e.nextBookmark&&(e.nextBookmark.previousBookmark=e.previousBookmark)}function f(e){for(var n,o=null;!o&&e&&e!==t;)(n=l(e))&&(o=y[n])&&o.node!==e&&(runtime.log("Cloned node detected. Creating new bookmark"),o=null,e.removeAttributeNS(h,"nodeId")),e=e.parentNode;return o}var p,m,g,h="urn:webodf:names:steps",b={},y={},v=core.DomUtils,S=Node.DOCUMENT_POSITION_FOLLOWING,N=Node.DOCUMENT_POSITION_PRECEDING;this.updateBookmark=function(e,o){var i,a,s,f,h=Math.ceil(e/n)*n;if(void 0!==m&&e>m){for(a=c(m),s=a.nextBookmark;s&&s.steps<=e;)i=s.nextBookmark,f=Math.ceil(s.steps/n)*n,b[f]===s&&delete b[f],v.containsNode(t,s.node)?s.steps=e+1:(d(s),delete y[s.nodeId]),s=i;m=e}else a=c(e);if(s=l(o)||u(o),i=y[s],i?i.node!==o&&(runtime.log("Cloned node detected. Creating new bookmark"),s=u(o),i=y[s]=new r(s,o)):i=y[s]=new r(s,o),s=i,s.steps!==e&&(i=Math.ceil(s.steps/n)*n,i!==h&&b[i]===s&&delete b[i],s.steps=e),a!==s&&a.nextBookmark!==s){if(a.steps===s.steps)for(;0!==(s.node.compareDocumentPosition(a.node)&S)&&a!==p;)a=a.previousBookmark;a!==s&&a.nextBookmark!==s&&(d(s),i=a.nextBookmark,s.nextBookmark=a.nextBookmark,s.previousBookmark=a,a.nextBookmark=s,i&&(i.previousBookmark=s))}a=b[h],(!a||s.steps>a.steps)&&(b[h]=s),g()},this.setToClosestStep=function(e,t){var n;return g(),n=c(e),n.setIteratorPosition(t),n.steps},this.setToClosestDomPoint=function(e,n,o){var r,i;if(g(),e===t&&0===n)r=p;else if(e===t&&n===t.childNodes.length)for(i in r=p,b)b.hasOwnProperty(i)&&(e=b[i],e.steps>r.steps&&(r=e));else if(r=f(e.childNodes.item(n)||e),!r)for(o.setUnfilteredPosition(e,n);!r&&o.previousNode();)r=f(o.getCurrentNode());return r=r||p,void 0!==m&&r.steps>m&&(r=c(m)),r.setIteratorPosition(o),r.steps},this.damageCacheAfterStep=function(e){0>e&&(e=-1),void 0===m?m=e:m>e&&(m=e),g()},function(){var e=l(t)||u(t);p=new i(e,0,t),g=ops.StepsCache.ENABLE_CACHE_VERIFICATION?s:function(){}}()},ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1,ops.StepsCache.Bookmark=function(){},ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(){}}(),function(){ops.OdtStepsTranslator=function(e,t,n,o){function r(e,t,n){var o=t.getCurrentNode();t.isBeforeNode()&&d.isParagraph(o)&&(n||(e+=1),u.updateBookmark(e,o))}function i(e,t){do{if(n.acceptPosition(t)===p){r(e,t,!0);break}r(e-1,t,!1)}while(t.nextPosition())}function a(){var n=e();n!==l&&(l&&runtime.log("Undo detected. Resetting steps cache"),l=n,u=new ops.StepsCache(l,o,i),c=t(l))}function s(e,t){if(!t||n.acceptPosition(e)===p)return!0;for(;e.previousPosition();)if(n.acceptPosition(e)===p){if(t(m,e.container(),e.unfilteredDomOffset()))return!0;break}for(;e.nextPosition();)if(n.acceptPosition(e)===p){if(t(g,e.container(),e.unfilteredDomOffset()))return!0;break}return!1}var l,u,c,d=odf.OdfUtils,f=core.DomUtils,p=core.PositionFilter.FilterResult.FILTER_ACCEPT,m=core.StepDirection.PREVIOUS,g=core.StepDirection.NEXT;this.convertStepsToDomPoint=function(e){var t,o;if(isNaN(e))throw new TypeError("Requested steps is not numeric ("+e+")");if(0>e)throw new RangeError("Requested steps is negative ("+e+")");for(a(),t=u.setToClosestStep(e,c);e>t&&c.nextPosition();)(o=n.acceptPosition(c)===p)&&(t+=1),r(t,c,o);if(t!==e)throw new RangeError("Requested steps ("+e+") exceeds available steps ("+t+")");return{node:c.container(),offset:c.unfilteredDomOffset()}},this.convertDomPointToSteps=function(e,t,o){var i;if(a(),f.containsNode(l,e)||(t=0>f.comparePoints(l,0,e,t),e=l,t=t?0:l.childNodes.length),c.setUnfilteredPosition(e,t),s(c,o)||c.setUnfilteredPosition(e,t),o=c.container(),t=c.unfilteredDomOffset(),e=u.setToClosestDomPoint(o,t,c),0>f.comparePoints(c.container(),c.unfilteredDomOffset(),o,t))return e>0?e-1:e;for(;(c.container()!==o||c.unfilteredDomOffset()!==t)&&c.nextPosition();)(i=n.acceptPosition(c)===p)&&(e+=1),r(e,c,i);return e+0},this.prime=function(){var e,t;for(a(),e=u.setToClosestStep(0,c);c.nextPosition();)(t=n.acceptPosition(c)===p)&&(e+=1),r(e,c,t)},this.handleStepsInserted=function(e){a(),u.damageCacheAfterStep(e.position)},this.handleStepsRemoved=function(e){a(),u.damageCacheAfterStep(e.position-1)},a()}}(),ops.Operation=function(){},ops.Operation.prototype.init=function(){},ops.Operation.prototype.execute=function(){},ops.Operation.prototype.spec=function(){},ops.TextPositionFilter=function(){function e(e,n,o){var a,s;if(n){if(t.isInlineRoot(n)&&t.isGroupingElement(o))return i;if(a=t.lookLeftForCharacter(n),1===a||2===a&&(t.scanRightForAnyCharacter(o)||t.scanRightForAnyCharacter(t.nextNode(e))))return r}else if(t.isInlineRoot(e.previousSibling)&&t.isGroupingElement(e))return r;return a=null===n&&t.isParagraph(e),s=t.lookRightForCharacter(o),a?s?r:t.scanRightForAnyCharacter(o)?i:r:s?(n=n||t.previousNode(e),t.scanLeftForAnyCharacter(n)?i:r):i}var t=odf.OdfUtils,n=Node.ELEMENT_NODE,o=Node.TEXT_NODE,r=core.PositionFilter.FilterResult.FILTER_ACCEPT,i=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(a){var s,l,u,c=a.container(),d=c.nodeType;if(d!==n&&d!==o)return i;if(d===o){if(d=a.unfilteredDomOffset(),s=c.data,runtime.assert(d!==s.length,"Unexpected offset."),d>0){if(a=s[d-1],!t.isODFWhitespace(a))return r;if(d>1)if(a=s[d-2],t.isODFWhitespace(a)){if(!t.isODFWhitespace(s.substr(0,d)))return i}else l=r;else u=t.previousNode(c),t.scanLeftForNonSpace(u)&&(l=r);return l===r?t.isTrailingWhitespace(c,d)?i:r:(l=s[d],t.isODFWhitespace(l)?i:t.scanLeftForAnyCharacter(t.previousNode(c))?i:r)}u=a.leftNode(),l=c,c=c.parentNode,l=e(c,u,l)}else t.isGroupingElement(c)?(u=a.leftNode(),l=a.rightNode(),l=e(c,u,l)):l=i;return l}},ops.OdtDocument=function(e){function t(e){return new core.PositionIterator(e,E,O,!1)}function n(){var t=e.odfContainer().getContentElement(),n=t&&t.localName;return runtime.assert("text"===n,"Unsupported content element type '"+n+"' for OdtDocument"),t}function o(){return g.getDocumentElement().ownerDocument}function r(e){for(;e&&!(e.namespaceURI===odf.Namespaces.officens&&"text"===e.localName||e.namespaceURI===odf.Namespaces.officens&&"annotation"===e.localName);)e=e.parentNode;return e}function i(e){this.acceptPosition=function(t){t=t.container();var n;return n="string"==typeof e?y[e].getNode():e,r(t)===r(n)?N:C}}function a(e,n,o,r){r=t(r);var i;return 1===o.length?i=o[0]:(i=new core.PositionFilterChain,o.forEach(i.addFilter)),o=new core.StepIterator(i,r),o.setPosition(e,n),o}function s(e){var o=t(n());return e=p.convertStepsToDomPoint(e),o.setUnfilteredPosition(e.node,e.offset),o}function l(e){return e===x}function u(e){var t,n,o=[],r=2;runtime.assert(e.isStep(),"positionIterator is not at a step");do{if((t=d.getContentBounds(e))&&(t=t.container,h.isDowngradableSpaceElement(t))){for(n=t.lastChild;t.firstChild;)o.push(t.firstChild),t.parentNode.insertBefore(t.firstChild,t);t.parentNode.removeChild(t),e.setPosition(n,n.nodeType===Node.TEXT_NODE?n.length:n.childNodes.length),e.roundToPreviousStep()}r-=1}while(r>0&&e.nextStep());o.forEach(b.normalizeTextNodes)}function c(e,t,n){return e=e.childNodes.item(t)||e,(e=h.getParagraphElement(e))&&b.containsNode(n,e)?e:n}var d,f,p,m,g=this,h=odf.OdfUtils,b=core.DomUtils,y={},v={},S=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated,ops.OdtDocument.signalAnnotationAdded]),N=core.PositionFilter.FilterResult.FILTER_ACCEPT,C=core.PositionFilter.FilterResult.FILTER_REJECT,x=core.StepDirection.NEXT,E=NodeFilter.SHOW_ALL,w=new gui.BlacklistNamespaceNodeFilter(["urn:webodf:names:cursor","urn:webodf:names:editinfo"]),T=new gui.OdfTextBodyNodeFilter,O=new core.NodeFilterChain([w,T]);this.createPositionIterator=t,this.getDocumentElement=function(){return e.odfContainer().rootElement},this.getDOMDocument=function(){return this.getDocumentElement().ownerDocument},this.cloneDocumentElement=function(){var t=g.getDocumentElement(),n=e.getAnnotationViewManager();return n&&n.forgetAnnotations(),t=t.cloneNode(!0),e.refreshAnnotations(),t},this.setDocumentElement=function(t){var n=e.odfContainer();n.setRootElement(t),e.setOdfContainer(n,!0),e.refreshCSS()},this.getDOMDocument=o,this.getRootElement=r,this.createStepIterator=a,this.getIteratorAtPosition=s,this.convertCursorStepToDomPoint=function(e){return p.convertStepsToDomPoint(e)},this.convertDomPointToCursorStep=function(e,t,n){var o;return n===x&&(o=l),p.convertDomPointToSteps(e,t,o)},this.convertDomToCursorRange=function(e){var t;return t=p.convertDomPointToSteps(e.anchorNode,e.anchorOffset),e=e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset?t:p.convertDomPointToSteps(e.focusNode,e.focusOffset),{position:t,length:e-t}},this.convertCursorToDomRange=function(e,t){var n,r,i=o().createRange();return n=p.convertStepsToDomPoint(e),t?(r=p.convertStepsToDomPoint(e+t),t>0?(i.setStart(n.node,n.offset),i.setEnd(r.node,r.offset)):(i.setStart(r.node,r.offset),i.setEnd(n.node,n.offset))):i.setStart(n.node,n.offset),i},this.upgradeWhitespacesAtPosition=function(e){var t,n=s(e),n=new core.StepIterator(f,n),o=2;runtime.assert(n.isStep(),"positionIterator is not at a step (requested step: "+e+")");do{if((t=d.getContentBounds(n))&&(e=t.container,t=t.startOffset,e.nodeType===Node.TEXT_NODE&&h.isSignificantWhitespace(e,t))){runtime.assert(" "===e.data[t],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var r=e.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),i=e.parentNode,a=e;r.appendChild(e.ownerDocument.createTextNode(" ")),1===e.length?i.replaceChild(r,e):(e.deleteData(t,1),t>0&&(t<e.length&&e.splitText(t),a=e.nextSibling),i.insertBefore(r,a)),e=r,n.setPosition(e,e.childNodes.length),n.roundToPreviousStep()}o-=1}while(o>0&&n.nextStep())},this.downgradeWhitespaces=u,this.downgradeWhitespacesAtPosition=function(e){e=s(e),e=new core.StepIterator(f,e),u(e)},this.getTextNodeAtStep=function(e,t){var n,r=s(e),i=r.container(),a=0,l=null;if(i.nodeType===Node.TEXT_NODE?(n=i,a=r.unfilteredDomOffset(),0<n.length&&(a>0&&(n=n.splitText(a)),n.parentNode.insertBefore(o().createTextNode(""),n),n=n.previousSibling,a=0)):(n=o().createTextNode(""),a=0,i.insertBefore(n,r.rightNode())),t){if(y[t]&&g.getCursorPosition(t)===e){for(l=y[t].getNode();l.nextSibling&&"cursor"===l.nextSibling.localName;)l.parentNode.insertBefore(l.nextSibling,l);0<n.length&&n.nextSibling!==l&&(n=o().createTextNode(""),a=0),l.parentNode.insertBefore(n,l)}}else for(;n.nextSibling&&"cursor"===n.nextSibling.localName;)n.parentNode.insertBefore(n.nextSibling,n);for(;n.previousSibling&&n.previousSibling.nodeType===Node.TEXT_NODE;)r=n.previousSibling,r.appendData(n.data),a=r.length,n=r,n.parentNode.removeChild(n.nextSibling);for(;n.nextSibling&&n.nextSibling.nodeType===Node.TEXT_NODE;)r=n.nextSibling,n.appendData(r.data),n.parentNode.removeChild(r);return{textNode:n,offset:a}},this.fixCursorPositions=function(){Object.keys(y).forEach(function(e){var t,n,o,i=y[e],s=r(i.getNode()),l=g.createRootFilter(s),u=!1;o=i.getSelectedRange(),t=c(o.startContainer,o.startOffset,s),n=a(o.startContainer,o.startOffset,[f,l],t),o.collapsed?s=n:(t=c(o.endContainer,o.endOffset,s),s=a(o.endContainer,o.endOffset,[f,l],t)),n.isStep()&&s.isStep()?n.container()!==s.container()||n.offset()!==s.offset()||o.collapsed&&i.getAnchorNode()===i.getNode()||(u=!0,o.setStart(n.container(),n.offset()),o.collapse(!0)):(u=!0,runtime.assert(n.roundToClosestStep(),"No walkable step found for cursor owned by "+e),o.setStart(n.container(),n.offset()),runtime.assert(s.roundToClosestStep(),"No walkable step found for cursor owned by "+e),o.setEnd(s.container(),s.offset())),u&&(i.setSelectedRange(o,i.hasForwardSelection()),g.emit(ops.Document.signalCursorMoved,i))})},this.getCursorPosition=function(e){return(e=y[e])?p.convertDomPointToSteps(e.getNode(),0):0},this.getCursorSelection=function(e){e=y[e];var t=0,n=0;return e&&(t=p.convertDomPointToSteps(e.getNode(),0),n=p.convertDomPointToSteps(e.getAnchorNode(),0)),{position:n,length:t-n}},this.getPositionFilter=function(){return f},this.getOdfCanvas=function(){return e},this.getCanvas=function(){return e},this.getRootNode=n,this.addMember=function(e){runtime.assert(void 0===v[e.getMemberId()],"This member already exists"),v[e.getMemberId()]=e},this.getMember=function(e){return v.hasOwnProperty(e)?v[e]:null},this.removeMember=function(e){delete v[e]},this.getCursor=function(e){return y[e]},this.getMemberIds=function(){var e,t=[];for(e in y)y.hasOwnProperty(e)&&t.push(y[e].getMemberId());
return t},this.addCursor=function(e){runtime.assert(Boolean(e),"OdtDocument::addCursor without cursor");var t=e.getMemberId(),n=g.convertCursorToDomRange(0,0);runtime.assert("string"==typeof t,"OdtDocument::addCursor has cursor without memberid"),runtime.assert(!y[t],"OdtDocument::addCursor is adding a duplicate cursor with memberid "+t),e.setSelectedRange(n,!0),y[t]=e},this.removeCursor=function(e){var t=y[e];return t?(t.removeFromDocument(),delete y[e],g.emit(ops.Document.signalCursorRemoved,e),!0):!1},this.moveCursor=function(e,t,n,o){e=y[e],t=g.convertCursorToDomRange(t,n),e&&(e.setSelectedRange(t,n>=0),e.setSelectionType(o||ops.OdtCursor.RangeSelection))},this.getFormatting=function(){return e.getFormatting()},this.emit=function(e,t){S.emit(e,t)},this.subscribe=function(e,t){S.subscribe(e,t)},this.unsubscribe=function(e,t){S.unsubscribe(e,t)},this.createRootFilter=function(e){return new i(e)},this.close=function(e){e()},this.destroy=function(e){e()},f=new ops.TextPositionFilter,d=new odf.StepUtils,p=new ops.OdtStepsTranslator(n,t,f,500),S.subscribe(ops.OdtDocument.signalStepsInserted,p.handleStepsInserted),S.subscribe(ops.OdtDocument.signalStepsRemoved,p.handleStepsRemoved),S.subscribe(ops.OdtDocument.signalOperationEnd,function(t){var n=t.spec(),o=n.memberid,r=new Date(n.timestamp).toISOString(),i=e.odfContainer(),a={setProperties:{},removedProperties:[]};t.isEdit&&("UpdateMetadata"===n.optype&&(a.setProperties=JSON.parse(JSON.stringify(n.setProperties)),n.removedProperties&&(a.removedProperties=n.removedProperties.attributes.split(","))),n=g.getMember(o).getProperties().fullName,i.setMetadata({"dc:creator":n,"dc:date":r},null),a.setProperties["dc:creator"]=n,a.setProperties["dc:date"]=r,m||(a.setProperties["meta:editing-cycles"]=i.incrementEditingCycles(),i.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),m=t,g.emit(ops.OdtDocument.signalMetadataUpdated,a))}),S.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)},ops.OdtDocument.signalParagraphChanged="paragraph/changed",ops.OdtDocument.signalTableAdded="table/added",ops.OdtDocument.signalCommonStyleCreated="style/created",ops.OdtDocument.signalCommonStyleDeleted="style/deleted",ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified",ops.OdtDocument.signalOperationStart="operation/start",ops.OdtDocument.signalOperationEnd="operation/end",ops.OdtDocument.signalProcessingBatchStart="router/batchstart",ops.OdtDocument.signalProcessingBatchEnd="router/batchend",ops.OdtDocument.signalUndoStackChanged="undo/changed",ops.OdtDocument.signalStepsInserted="steps/inserted",ops.OdtDocument.signalStepsRemoved="steps/removed",ops.OdtDocument.signalMetadataUpdated="metadata/updated",ops.OdtDocument.signalAnnotationAdded="annotation/added",ops.OpAddAnnotation=function(){function e(e,n,o){var r=e.getTextNodeAtStep(o,t);r&&(e=r.textNode,o=e.parentNode,r.offset!==e.length&&e.splitText(r.offset),o.insertBefore(n,e.nextSibling),0===e.length&&o.removeChild(e))}var t,n,o,r,i,a;this.init=function(e){t=e.memberid,n=parseInt(e.timestamp,10),o=parseInt(e.position,10),r=parseInt(e.length,10)||0,i=e.name},this.isEdit=!0,this.group=void 0,this.execute=function(s){var l,u,c=s.getCursor(t);a=s.getDOMDocument();var d,f,p,m=new Date(n);return d=a.createElementNS(odf.Namespaces.officens,"office:annotation"),d.setAttributeNS(odf.Namespaces.officens,"office:name",i),l=a.createElementNS(odf.Namespaces.dcns,"dc:creator"),l.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",t),l.textContent=s.getMember(t).getProperties().fullName,u=a.createElementNS(odf.Namespaces.dcns,"dc:date"),u.appendChild(a.createTextNode(m.toISOString())),m=a.createElementNS(odf.Namespaces.textns,"text:list"),f=a.createElementNS(odf.Namespaces.textns,"text:list-item"),p=a.createElementNS(odf.Namespaces.textns,"text:p"),f.appendChild(p),m.appendChild(f),d.appendChild(l),d.appendChild(u),d.appendChild(m),r&&(l=a.createElementNS(odf.Namespaces.officens,"office:annotation-end"),l.setAttributeNS(odf.Namespaces.officens,"office:name",i),d.annotationEndElement=l,e(s,l,o+r)),e(s,d,o),s.emit(ops.OdtDocument.signalStepsInserted,{position:o}),c&&(l=a.createRange(),u=d.getElementsByTagNameNS(odf.Namespaces.textns,"p")[0],l.selectNodeContents(u),c.setSelectedRange(l,!1),c.setSelectionType(ops.OdtCursor.RangeSelection),s.emit(ops.Document.signalCursorMoved,c)),s.getOdfCanvas().addAnnotation(d),s.fixCursorPositions(),s.emit(ops.OdtDocument.signalAnnotationAdded,{memberId:t,annotation:d}),!0},this.spec=function(){return{optype:"AddAnnotation",memberid:t,timestamp:n,position:o,length:r,name:i}}},ops.OpAddCursor=function(){var e,t;this.init=function(n){e=n.memberid,t=n.timestamp},this.isEdit=!1,this.group=void 0,this.execute=function(t){var n=t.getCursor(e);return n?!1:(n=new ops.OdtCursor(e,t),t.addCursor(n),t.emit(ops.Document.signalCursorAdded,n),!0)},this.spec=function(){return{optype:"AddCursor",memberid:e,timestamp:t}}},ops.OpAddMember=function(){var e,t,n;this.init=function(o){e=o.memberid,t=parseInt(o.timestamp,10),n=o.setProperties},this.isEdit=!1,this.group=void 0,this.execute=function(t){var o;return t.getMember(e)?!1:(o=new ops.Member(e,n),t.addMember(o),t.emit(ops.Document.signalMemberAdded,o),!0)},this.spec=function(){return{optype:"AddMember",memberid:e,timestamp:t,setProperties:n}}},ops.OpAddStyle=function(){var e,t,n,o,r,i,a=odf.Namespaces.stylens;this.init=function(a){e=a.memberid,t=a.timestamp,n=a.styleName,o=a.styleFamily,r="true"===a.isAutomaticStyle||!0===a.isAutomaticStyle,i=a.setProperties},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getOdfCanvas().odfContainer(),s=e.getFormatting(),l=e.getDOMDocument().createElementNS(a,"style:style");return l?(i&&s.updateStyle(l,i),l.setAttributeNS(a,"style:family",o),l.setAttributeNS(a,"style:name",n),r?t.rootElement.automaticStyles.appendChild(l):t.rootElement.styles.appendChild(l),e.getOdfCanvas().refreshCSS(),r||e.emit(ops.OdtDocument.signalCommonStyleCreated,{name:n,family:o}),!0):!1},this.spec=function(){return{optype:"AddStyle",memberid:e,timestamp:t,styleName:n,styleFamily:o,isAutomaticStyle:r,setProperties:i}}},odf.ObjectNameGenerator=function(e,t){function n(e,t){var n={};this.generateName=function(){var o,r=t(),i=0;do o=e+i,i+=1;while(n[o]||r[o]);return n[o]=!0,o}}function o(){var t={};return[e.rootElement.automaticStyles,e.rootElement.styles].forEach(function(e){for(e=e.firstElementChild;e;)e.namespaceURI===r&&"style"===e.localName&&(t[e.getAttributeNS(r,"name")]=!0),e=e.nextElementSibling}),t}var r=odf.Namespaces.stylens,i=odf.Namespaces.drawns,a=odf.Namespaces.xlinkns,s=(new core.Utils).hashString(t),l=null,u=null,c=null,d={},f={};this.generateStyleName=function(){return null===l&&(l=new n("auto"+s+"_",function(){return o()})),l.generateName()},this.generateFrameName=function(){var t,o,r;if(null===u){for(o=e.rootElement.body.getElementsByTagNameNS(i,"frame"),t=0;t<o.length;t+=1)r=o.item(t),d[r.getAttributeNS(i,"name")]=!0;u=new n("fr"+s+"_",function(){return d})}return u.generateName()},this.generateImageName=function(){var t,o,r;if(null===c){for(r=e.rootElement.body.getElementsByTagNameNS(i,"image"),t=0;t<r.length;t+=1)o=r.item(t),o=o.getAttributeNS(a,"href"),o=o.substring(9,o.lastIndexOf(".")),f[o]=!0;c=new n("img"+s+"_",function(){return f})}return c.generateName()}},odf.TextStyleApplicator=function(e,t,n){function o(e){function n(e,t){return"object"==typeof e&&"object"==typeof t?Object.keys(e).every(function(o){return n(e[o],t[o])}):e===t}var o={};this.isStyleApplied=function(r){return r=t.getAppliedStylesForElement(r,o).styleProperties,n(e,r)}}function r(o){var r={};this.applyStyleToContainer=function(i){var a;a=i.getAttributeNS(s,"style-name");var u=i.ownerDocument;if(a=a||"",!r.hasOwnProperty(a)){var c,d=a;c=a?t.createDerivedStyleObject(a,"text",o):o,u=u.createElementNS(l,"style:style"),t.updateStyle(u,c),u.setAttributeNS(l,"style:name",e.generateStyleName()),u.setAttributeNS(l,"style:family","text"),u.setAttributeNS("urn:webodf:names:scope","scope","document-content"),n.appendChild(u),r[d]=u}a=r[a].getAttributeNS(l,"name"),i.setAttributeNS(s,"text:style-name",a)}}function i(e,t){var n,o,r,i=e.ownerDocument,l=e.parentNode,u=new core.LoopWatchDog(1e4);for(o=[],o.push(e),r=e.nextSibling;r&&a.rangeContainsNode(t,r);)u.check(),o.push(r),r=r.nextSibling;if("span"!==l.localName||l.namespaceURI!==s?(n=i.createElementNS(s,"text:span"),l.insertBefore(n,e),i=!1):(e.previousSibling&&!a.rangeContainsNode(t,l.firstChild)?(n=l.cloneNode(!1),l.parentNode.insertBefore(n,l.nextSibling)):n=l,i=!0),o.forEach(function(e){e.parentNode!==n&&n.appendChild(e)}),r&&i)for(o=n.cloneNode(!1),n.parentNode.insertBefore(o,n.nextSibling);r;)u.check(),i=r.nextSibling,o.appendChild(r),r=i;return n}var a=core.DomUtils,s=odf.Namespaces.textns,l=odf.Namespaces.stylens;this.applyStyle=function(e,t,n){var a,s,l,u,c={};runtime.assert(n&&n.hasOwnProperty("style:text-properties"),"applyStyle without any text properties"),c["style:text-properties"]=n["style:text-properties"],l=new r(c),u=new o(c),e.forEach(function(e){a=u.isStyleApplied(e),!1===a&&(s=i(e,t),l.applyStyleToContainer(s))})}},ops.OpApplyDirectStyling=function(){function e(e,n,o){var r=e.getOdfCanvas().odfContainer(),i=s.splitBoundaries(n),l=a.getTextNodes(n,!1);new odf.TextStyleApplicator(new odf.ObjectNameGenerator(r,t),e.getFormatting(),r.rootElement.automaticStyles).applyStyle(l,n,o),i.forEach(s.normalizeTextNodes)}var t,n,o,r,i,a=odf.OdfUtils,s=core.DomUtils;this.init=function(e){t=e.memberid,n=e.timestamp,o=parseInt(e.position,10),r=parseInt(e.length,10),i=e.setProperties},this.isEdit=!0,this.group=void 0,this.execute=function(s){var l=s.convertCursorToDomRange(o,r),u=a.getParagraphElements(l);return e(s,l,i),l.detach(),s.getOdfCanvas().refreshCSS(),s.fixCursorPositions(),u.forEach(function(e){s.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:e,memberId:t,timeStamp:n})}),s.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"ApplyDirectStyling",memberid:t,timestamp:n,position:o,length:r,setProperties:i}}},ops.OpApplyHyperlink=function(){function e(e){for(;e;){if(s.isHyperlink(e))return!0;e=e.parentNode}return!1}var t,n,o,r,i,a=core.DomUtils,s=odf.OdfUtils;this.init=function(e){t=e.memberid,n=e.timestamp,o=e.position,r=e.length,i=e.hyperlink},this.isEdit=!0,this.group=void 0,this.execute=function(l){var u=l.getDOMDocument(),c=l.convertCursorToDomRange(o,r),d=a.splitBoundaries(c),f=[],p=s.getTextNodes(c,!1);return 0===p.length?!1:(p.forEach(function(t){var n=s.getParagraphElement(t);runtime.assert(!1===e(t),"The given range should not contain any link.");var o=i,r=u.createElementNS(odf.Namespaces.textns,"text:a");r.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple"),r.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",o),t.parentNode.insertBefore(r,t),r.appendChild(t),-1===f.indexOf(n)&&f.push(n)}),d.forEach(a.normalizeTextNodes),c.detach(),l.fixCursorPositions(),l.getOdfCanvas().refreshSize(),l.getOdfCanvas().rerenderAnnotations(),f.forEach(function(e){l.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:e,memberId:t,timeStamp:n})}),!0)},this.spec=function(){return{optype:"ApplyHyperlink",memberid:t,timestamp:n,position:o,length:r,hyperlink:i}}},ops.OpInsertImage=function(){var e,t,n,o,r,i,a,s,l=odf.Namespaces.drawns,u=odf.Namespaces.svgns,c=odf.Namespaces.textns,d=odf.Namespaces.xlinkns,f=odf.OdfUtils;this.init=function(l){e=l.memberid,t=l.timestamp,n=l.position,o=l.filename,r=l.frameWidth,i=l.frameHeight,a=l.frameStyleName,s=l.frameName},this.isEdit=!0,this.group=void 0,this.execute=function(p){var m,g,h=p.getOdfCanvas(),b=p.getTextNodeAtStep(n,e);if(!b)return!1;m=b.textNode,g=f.getParagraphElement(m);var b=b.offset!==m.length?m.splitText(b.offset):m.nextSibling,y=p.getDOMDocument(),v=y.createElementNS(l,"draw:image"),y=y.createElementNS(l,"draw:frame");return v.setAttributeNS(d,"xlink:href",o),v.setAttributeNS(d,"xlink:type","simple"),v.setAttributeNS(d,"xlink:show","embed"),v.setAttributeNS(d,"xlink:actuate","onLoad"),y.setAttributeNS(l,"draw:style-name",a),y.setAttributeNS(l,"draw:name",s),y.setAttributeNS(c,"text:anchor-type","as-char"),y.setAttributeNS(u,"svg:width",r),y.setAttributeNS(u,"svg:height",i),y.appendChild(v),m.parentNode.insertBefore(y,b),p.emit(ops.OdtDocument.signalStepsInserted,{position:n}),0===m.length&&m.parentNode.removeChild(m),h.addCssForFrameWithImage(y),h.refreshCSS(),p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:g,memberId:e,timeStamp:t}),h.rerenderAnnotations(),!0},this.spec=function(){return{optype:"InsertImage",memberid:e,timestamp:t,filename:o,position:n,frameWidth:r,frameHeight:i,frameStyleName:a,frameName:s}}},ops.OpInsertTable=function(){function e(e,t){var n;if(1===u.length)n=u[0];else if(3===u.length)switch(e){case 0:n=u[0];break;case o-1:n=u[2];break;default:n=u[1]}else n=u[e];if(1===n.length)return n[0];if(3===n.length)switch(t){case 0:return n[0];case r-1:return n[2];default:return n[1]}return n[t]}var t,n,o,r,i,a,s,l,u,c=odf.OdfUtils;this.init=function(e){t=e.memberid,n=e.timestamp,i=e.position,o=e.initialRows,r=e.initialColumns,a=e.tableName,s=e.tableStyleName,l=e.tableColumnStyleName,u=e.tableCellStyleMatrix},this.isEdit=!0,this.group=void 0,this.execute=function(u){var d=u.getTextNodeAtStep(i),f=u.getRootNode();if(d){var p,m,g,h,b=u.getDOMDocument(),y=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),v=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column");for(s&&y.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",s),a&&y.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",a),v.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:number-columns-repeated",r),l&&v.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",l),y.appendChild(v),g=0;o>g;g+=1){for(v=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row"),h=0;r>h;h+=1)p=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(m=e(g,h))&&p.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",m),m=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:p"),p.appendChild(m),v.appendChild(p);y.appendChild(v)}return d=c.getParagraphElement(d.textNode),f.insertBefore(y,d.nextSibling),u.emit(ops.OdtDocument.signalStepsInserted,{position:i}),u.getOdfCanvas().refreshSize(),u.emit(ops.OdtDocument.signalTableAdded,{tableElement:y,memberId:t,timeStamp:n}),u.getOdfCanvas().rerenderAnnotations(),!0}return!1},this.spec=function(){return{optype:"InsertTable",memberid:t,timestamp:n,position:i,initialRows:o,initialColumns:r,tableName:a,tableStyleName:s,tableColumnStyleName:l,tableCellStyleMatrix:u}}},ops.OpInsertText=function(){var e,t,n,o,r,i=odf.OdfUtils;this.init=function(i){e=i.memberid,t=i.timestamp,n=i.position,r=i.text,o="true"===i.moveCursor||!0===i.moveCursor},this.isEdit=!0,this.group=void 0,this.execute=function(a){var s,l,u,c,d,f,p=null,m=a.getDOMDocument(),g=0,h=a.getCursor(e);if(a.upgradeWhitespacesAtPosition(n),s=a.getTextNodeAtStep(n)){for(l=s.textNode,p=l.nextSibling,u=l.parentNode,c=i.getParagraphElement(l),f=0;f<r.length;f+=1)("	"===r[f]||"	"!==r[f]&&i.isODFWhitespace(r[f])&&(0===f||f===r.length-1||"	"!==r[f-1]&&i.isODFWhitespace(r[f-1])))&&(0===g?(s.offset!==l.length&&(p=l.splitText(s.offset)),f>0&&l.appendData(r.substring(0,f))):f>g&&(g=r.substring(g,f),u.insertBefore(m.createTextNode(g),p)),g=f+1,"	"===r[f]?(d=m.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),d.appendChild(m.createTextNode("	"))):(" "!==r[f]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+r.charCodeAt(f)+")"),d=m.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),d.appendChild(m.createTextNode(" "))),u.insertBefore(d,p));return 0===g?l.insertData(s.offset,r):g<r.length&&(s=r.substring(g),u.insertBefore(m.createTextNode(s),p)),u=l.parentNode,p=l.nextSibling,u.removeChild(l),u.insertBefore(l,p),0===l.length&&l.parentNode.removeChild(l),a.emit(ops.OdtDocument.signalStepsInserted,{position:n}),h&&o&&(a.moveCursor(e,n+r.length,0),a.emit(ops.Document.signalCursorMoved,h)),a.downgradeWhitespacesAtPosition(n),a.downgradeWhitespacesAtPosition(n+r.length),a.getOdfCanvas().refreshSize(),a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:c,memberId:e,timeStamp:t}),a.getOdfCanvas().rerenderAnnotations(),!0}return!1},this.spec=function(){return{optype:"InsertText",memberid:e,timestamp:t,position:n,text:r,moveCursor:o}}},odf.CollapsingRules=function(e){function t(e){return o.isODFNode(e)||"br"===e.localName&&o.isLineBreak(e.parentNode)||e.nodeType===Node.TEXT_NODE&&o.isODFNode(e.parentNode)}function n(i){var a;return i.nodeType===Node.TEXT_NODE?(a=i.parentNode,a.removeChild(i)):a=r.removeUnwantedNodes(i,t),a&&!o.isParagraph(a)&&a!==e&&o.hasNoODFContent(a)?n(a):a}var o=odf.OdfUtils,r=core.DomUtils;this.mergeChildrenIntoParent=n},ops.OpMergeParagraph=function(){function e(e){return c.isGroupingElement(e)&&c.hasNoODFContent(e)}function t(e){if(e.nodeType===Node.TEXT_NODE){if(0===e.length)return runtime.log("WARN: Empty text node found during merge operation"),!0;if(c.isODFWhitespace(e.data)&&!1===c.isSignificantWhitespace(e,0))return!0;e="#text"}else e=(e.prefix?e.prefix+":":"")+e.localName;return runtime.log("WARN: Unexpected text element found near paragraph boundary ["+e+"]"),!1}function n(e){e.collapsed||(d.splitBoundaries(e),e=c.getTextElements(e,!1,!0).filter(t),e.forEach(function(e){e.parentNode.removeChild(e)}))}function o(e,t,n){e=e.convertCursorStepToDomPoint(t);var o=c.getParagraphElement(e.node,e.offset);return runtime.assert(Boolean(o),"Paragraph not found at step "+t),n&&n.setPosition(e.node,e.offset),o}var r,i,a,s,l,u,c=odf.OdfUtils,d=core.DomUtils,f=odf.Namespaces.textns;this.init=function(e){r=e.memberid,i=e.timestamp,a=e.moveCursor,s=e.paragraphStyleName,l=parseInt(e.sourceStartPosition,10),u=parseInt(e.destinationStartPosition,10)},this.isEdit=!0,this.group=void 0,this.execute=function(t){var c,p,m=t.getCursor(r);c=t.getRootNode();var g,h=new odf.CollapsingRules(c),b=t.createStepIterator(c,0,[t.getPositionFilter()],c);runtime.assert(l>u,"Destination paragraph ("+u+") must be before source paragraph ("+l+")"),p=o(t,u),c=o(t,l,b),b.previousStep(),runtime.assert(d.containsNode(p,b.container()),"Destination paragraph must be adjacent to the source paragraph"),g=p.ownerDocument.createRange(),b.setPosition(p,p.childNodes.length),b.roundToPreviousStep(),g.setStart(b.container(),b.offset()),g.setEnd(p,p.childNodes.length),n(g),g=p.childNodes.length;var y=c.ownerDocument.createRange();for(b.setPosition(c,0),b.roundToNextStep(),y.setStart(c,0),y.setEnd(b.container(),b.offset()),n(y),y=c.firstChild;y;)"editinfo"===y.localName?c.removeChild(y):(p.appendChild(y),d.removeUnwantedNodes(y,e)),y=c.firstChild;return runtime.assert(0===c.childNodes.length,"Source paragraph should be empty before it is removed"),h.mergeChildrenIntoParent(c),t.emit(ops.OdtDocument.signalStepsRemoved,{position:l-1}),b.setPosition(p,g),b.roundToClosestStep(),b.previousStep()||b.roundToNextStep(),t.downgradeWhitespaces(b),s?p.setAttributeNS(f,"text:style-name",s):p.removeAttributeNS(f,"style-name"),m&&a&&(t.moveCursor(r,l-1,0),t.emit(ops.Document.signalCursorMoved,m)),t.fixCursorPositions(),t.getOdfCanvas().refreshSize(),t.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,memberId:r,timeStamp:i}),t.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"MergeParagraph",memberid:r,timestamp:i,moveCursor:a,paragraphStyleName:s,sourceStartPosition:l,destinationStartPosition:u}}},ops.OpMoveCursor=function(){var e,t,n,o,r;this.init=function(i){e=i.memberid,t=i.timestamp,n=i.position,o=i.length||0,r=i.selectionType||ops.OdtCursor.RangeSelection},this.isEdit=!1,this.group=void 0,this.execute=function(t){var i,a=t.getCursor(e);return a?(i=t.convertCursorToDomRange(n,o),a.setSelectedRange(i,o>=0),a.setSelectionType(r),t.emit(ops.Document.signalCursorMoved,a),!0):!1},this.spec=function(){return{optype:"MoveCursor",memberid:e,timestamp:t,position:n,length:o,selectionType:r}}},ops.OpRemoveAnnotation=function(){var e,t,n,o,r=core.DomUtils;this.init=function(r){e=r.memberid,t=r.timestamp,n=parseInt(r.position,10),o=parseInt(r.length,10)},this.isEdit=!0,this.group=void 0,this.execute=function(e){function t(e){o.parentNode.insertBefore(e,o)}for(var o,i=e.getIteratorAtPosition(n).container();i.namespaceURI!==odf.Namespaces.officens||"annotation"!==i.localName;)i=i.parentNode;return null===i?!1:(o=i,i=o.annotationEndElement,e.getOdfCanvas().forgetAnnotations(),r.getElementsByTagNameNS(o,"urn:webodf:names:cursor","cursor").forEach(t),r.getElementsByTagNameNS(o,"urn:webodf:names:cursor","anchor").forEach(t),o.parentNode.removeChild(o),i&&i.parentNode.removeChild(i),e.emit(ops.OdtDocument.signalStepsRemoved,{position:n>0?n-1:n}),e.fixCursorPositions(),e.getOdfCanvas().refreshAnnotations(),!0)},this.spec=function(){return{optype:"RemoveAnnotation",memberid:e,timestamp:t,position:n,length:o}}},ops.OpRemoveBlob=function(){var e,t,n;this.init=function(o){e=o.memberid,t=o.timestamp,n=o.filename},this.isEdit=!0,this.group=void 0,this.execute=function(e){return e.getOdfCanvas().odfContainer().removeBlob(n),!0},this.spec=function(){return{optype:"RemoveBlob",memberid:e,timestamp:t,filename:n}}},ops.OpRemoveCursor=function(){var e,t;this.init=function(n){e=n.memberid,t=n.timestamp},this.isEdit=!1,this.group=void 0,this.execute=function(t){return t.removeCursor(e)?!0:!1},this.spec=function(){return{optype:"RemoveCursor",memberid:e,timestamp:t}}},ops.OpRemoveHyperlink=function(){var e,t,n,o,r=core.DomUtils,i=odf.OdfUtils;this.init=function(r){e=r.memberid,t=r.timestamp,n=r.position,o=r.length},this.isEdit=!0,this.group=void 0,this.execute=function(a){var s=a.convertCursorToDomRange(n,o),l=i.getHyperlinkElements(s);return runtime.assert(1===l.length,"The given range should only contain a single link."),l=r.mergeIntoParent(l[0]),s.detach(),a.fixCursorPositions(),a.getOdfCanvas().refreshSize(),a.getOdfCanvas().rerenderAnnotations(),a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:i.getParagraphElement(l),memberId:e,timeStamp:t}),!0},this.spec=function(){return{optype:"RemoveHyperlink",memberid:e,timestamp:t,position:n,length:o}}},ops.OpRemoveMember=function(){var e,t;this.init=function(n){e=n.memberid,t=parseInt(n.timestamp,10)},this.isEdit=!1,this.group=void 0,this.execute=function(t){return t.getMember(e)?(t.removeMember(e),t.emit(ops.Document.signalMemberRemoved,e),!0):!1},this.spec=function(){return{optype:"RemoveMember",memberid:e,timestamp:t}}},ops.OpRemoveStyle=function(){var e,t,n,o;this.init=function(r){e=r.memberid,t=r.timestamp,n=r.styleName,o=r.styleFamily},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getFormatting().getStyleElement(n,o);return t?(t.parentNode.removeChild(t),e.getOdfCanvas().refreshCSS(),e.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:n,family:o}),!0):!1},this.spec=function(){return{optype:"RemoveStyle",memberid:e,timestamp:t,styleName:n,styleFamily:o}}},ops.OpRemoveText=function(){var e,t,n,o,r=odf.OdfUtils,i=core.DomUtils;this.init=function(r){runtime.assert(0<=r.length,"OpRemoveText only supports positive lengths"),e=r.memberid,t=r.timestamp,n=parseInt(r.position,10),o=parseInt(r.length,10)},this.isEdit=!0,this.group=void 0,this.execute=function(a){var s,l,u,c=a.getCursor(e),d=new odf.CollapsingRules(a.getRootNode());return a.upgradeWhitespacesAtPosition(n),a.upgradeWhitespacesAtPosition(n+o),s=a.convertCursorToDomRange(n,o),i.splitBoundaries(s),l=r.getTextElements(s,!1,!0),u=r.getParagraphElement(s.startContainer,s.startOffset),runtime.assert(void 0!==u,"Attempting to remove text outside a paragraph element"),s.detach(),l.forEach(function(e){e.parentNode?(runtime.assert(i.containsNode(u,e),"RemoveText only supports removing elements within the same paragraph"),d.mergeChildrenIntoParent(e)):runtime.log("WARN: text element has already been removed from it's container")}),a.emit(ops.OdtDocument.signalStepsRemoved,{position:n}),a.downgradeWhitespacesAtPosition(n),a.fixCursorPositions(),a.getOdfCanvas().refreshSize(),a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:u,memberId:e,timeStamp:t}),c&&(c.resetSelectionType(),a.emit(ops.Document.signalCursorMoved,c)),a.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"RemoveText",memberid:e,timestamp:t,position:n,length:o}}},ops.OpSetBlob=function(){var e,t,n,o,r;this.init=function(i){e=i.memberid,t=i.timestamp,n=i.filename,o=i.mimetype,r=i.content},this.isEdit=!0,this.group=void 0,this.execute=function(e){return e.getOdfCanvas().odfContainer().setBlob(n,o,r),!0},this.spec=function(){return{optype:"SetBlob",memberid:e,timestamp:t,filename:n,mimetype:o,content:r}}},ops.OpSetParagraphStyle=function(){function e(e,t,n){var o=[e.getPositionFilter()],r=n.container();return n=n.unfilteredDomOffset(),!1===e.createStepIterator(r,n,o,t).previousStep()}var t,n,o,r,i=odf.OdfUtils;this.init=function(e){t=e.memberid,n=e.timestamp,o=e.position,r=e.styleName},this.isEdit=!0,this.group=void 0,this.execute=function(a){var s,l;return s=a.getIteratorAtPosition(o),(l=i.getParagraphElement(s.container()))?(runtime.assert(e(a,l,s),"SetParagraphStyle position should be the first position in the paragraph"),r?l.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",r):l.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),a.getOdfCanvas().refreshSize(),a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:l,timeStamp:n,memberId:t}),a.getOdfCanvas().rerenderAnnotations(),!0):!1},this.spec=function(){return{optype:"SetParagraphStyle",memberid:t,timestamp:n,position:o,styleName:r}}},ops.OpSplitParagraph=function(){var e,t,n,o,r,i,a=odf.OdfUtils,s=odf.Namespaces.textns;this.init=function(a){e=a.memberid,t=a.timestamp,o=a.position,n=a.sourceParagraphPosition,i=a.paragraphStyleName,r="true"===a.moveCursor||!0===a.moveCursor},this.isEdit=!0,this.group=void 0,this.execute=function(n){var l,u,c,d,f,p,m,g=n.getCursor(e);if(n.upgradeWhitespacesAtPosition(o),l=n.getTextNodeAtStep(o),!l)return!1;if(u=a.getParagraphElement(l.textNode),!u)return!1;for(c=a.isListItem(u.parentNode)?u.parentNode:u,0===l.offset?(m=l.textNode.previousSibling,p=null):(m=l.textNode,p=l.offset>=l.textNode.length?null:l.textNode.splitText(l.offset)),d=l.textNode;d!==c;){if(d=d.parentNode,f=d.cloneNode(!1),p&&f.appendChild(p),m)for(;m&&m.nextSibling;)f.appendChild(m.nextSibling);else for(;d.firstChild;)f.appendChild(d.firstChild);d.parentNode.insertBefore(f,d.nextSibling),m=d,p=f}return a.isListItem(p)&&(p=p.childNodes.item(0)),i?p.setAttributeNS(s,"text:style-name",i):p.removeAttributeNS(s,"style-name"),0===l.textNode.length&&l.textNode.parentNode.removeChild(l.textNode),n.emit(ops.OdtDocument.signalStepsInserted,{position:o}),g&&r&&(n.moveCursor(e,o+1,0),n.emit(ops.Document.signalCursorMoved,g)),n.fixCursorPositions(),n.getOdfCanvas().refreshSize(),n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:u,memberId:e,timeStamp:t}),n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,memberId:e,timeStamp:t}),n.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"SplitParagraph",memberid:e,timestamp:t,position:o,sourceParagraphPosition:n,paragraphStyleName:i,moveCursor:r}}},ops.OpUpdateMember=function(){function e(e){var n="//dc:creator[@editinfo:memberid='"+t+"']";for(e=xmldom.XPath.getODFElementsWithXPath(e.getRootNode(),n,function(e){return"editinfo"===e?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(e)}),n=0;n<e.length;n+=1)e[n].textContent=o.fullName}var t,n,o,r;this.init=function(e){t=e.memberid,n=parseInt(e.timestamp,10),o=e.setProperties,r=e.removedProperties},this.isEdit=!1,this.group=void 0,this.execute=function(n){var i=n.getMember(t);return i?(r&&i.removeProperties(r),o&&(i.setProperties(o),o.fullName&&e(n)),n.emit(ops.Document.signalMemberUpdated,i),!0):!1},this.spec=function(){return{optype:"UpdateMember",memberid:t,timestamp:n,setProperties:o,removedProperties:r}}},ops.OpUpdateMetadata=function(){var e,t,n,o;this.init=function(r){e=r.memberid,t=parseInt(r.timestamp,10),n=r.setProperties,o=r.removedProperties},this.isEdit=!0,this.group=void 0,this.execute=function(e){e=e.getOdfCanvas().odfContainer();var t=null;return o&&(t=o.attributes.split(",")),e.setMetadata(n,t),!0},this.spec=function(){return{optype:"UpdateMetadata",memberid:e,timestamp:t,setProperties:n,removedProperties:o}}},ops.OpUpdateParagraphStyle=function(){function e(e,t){var n,o,r=t?t.split(","):[];for(n=0;n<r.length;n+=1)o=r[n].split(":"),e.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(o[0]),o[1])}var t,n,o,r,i,a=odf.Namespaces.stylens;this.init=function(e){t=e.memberid,n=e.timestamp,o=e.styleName,r=e.setProperties,i=e.removedProperties},this.isEdit=!0,this.group=void 0,this.execute=function(t){var n,s,l,u=t.getFormatting();return(n=""!==o?u.getStyleElement(o,"paragraph"):u.getDefaultStyleElement("paragraph"))?(s=n.getElementsByTagNameNS(a,"paragraph-properties").item(0),l=n.getElementsByTagNameNS(a,"text-properties").item(0),r&&u.updateStyle(n,r),i&&(u=i["style:paragraph-properties"],s&&u&&(e(s,u.attributes),0===s.attributes.length&&n.removeChild(s)),u=i["style:text-properties"],l&&u&&(e(l,u.attributes),0===l.attributes.length&&n.removeChild(l)),e(n,i.attributes)),t.getOdfCanvas().refreshCSS(),t.emit(ops.OdtDocument.signalParagraphStyleModified,o),t.getOdfCanvas().rerenderAnnotations(),!0):!1},this.spec=function(){return{optype:"UpdateParagraphStyle",memberid:t,timestamp:n,styleName:o,setProperties:r,removedProperties:i}}},ops.OperationFactory=function(){function e(e){return function(){return new e}}var t;this.register=function(e,n){t[e]=n},this.create=function(e){var n=null,o=t[e.optype];return o&&(n=o(e),n.init(e)),n},t={AddMember:e(ops.OpAddMember),UpdateMember:e(ops.OpUpdateMember),RemoveMember:e(ops.OpRemoveMember),AddCursor:e(ops.OpAddCursor),ApplyDirectStyling:e(ops.OpApplyDirectStyling),SetBlob:e(ops.OpSetBlob),RemoveBlob:e(ops.OpRemoveBlob),InsertImage:e(ops.OpInsertImage),InsertTable:e(ops.OpInsertTable),InsertText:e(ops.OpInsertText),RemoveText:e(ops.OpRemoveText),MergeParagraph:e(ops.OpMergeParagraph),SplitParagraph:e(ops.OpSplitParagraph),SetParagraphStyle:e(ops.OpSetParagraphStyle),UpdateParagraphStyle:e(ops.OpUpdateParagraphStyle),AddStyle:e(ops.OpAddStyle),RemoveStyle:e(ops.OpRemoveStyle),MoveCursor:e(ops.OpMoveCursor),RemoveCursor:e(ops.OpRemoveCursor),AddAnnotation:e(ops.OpAddAnnotation),RemoveAnnotation:e(ops.OpRemoveAnnotation),UpdateMetadata:e(ops.OpUpdateMetadata),ApplyHyperlink:e(ops.OpApplyHyperlink),RemoveHyperlink:e(ops.OpRemoveHyperlink)}},ops.OperationRouter=function(){},ops.OperationRouter.prototype.setOperationFactory=function(){},ops.OperationRouter.prototype.setPlaybackFunction=function(){},ops.OperationRouter.prototype.push=function(){},ops.OperationRouter.prototype.close=function(){},ops.OperationRouter.prototype.subscribe=function(){},ops.OperationRouter.prototype.unsubscribe=function(){},ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){},ops.OperationRouter.prototype.hasSessionHostConnection=function(){},ops.OperationRouter.signalProcessingBatchStart="router/batchstart",ops.OperationRouter.signalProcessingBatchEnd="router/batchend",ops.TrivialOperationRouter=function(){var e,t,n=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),o=0;this.setOperationFactory=function(t){e=t},this.setPlaybackFunction=function(e){t=e},this.push=function(r){o+=1,n.emit(ops.OperationRouter.signalProcessingBatchStart,{}),r.forEach(function(n){n=n.spec(),n.timestamp=Date.now(),n=e.create(n),n.group="g"+o,t(n)
}),n.emit(ops.OperationRouter.signalProcessingBatchEnd,{})},this.close=function(e){e()},this.subscribe=function(e,t){n.subscribe(e,t)},this.unsubscribe=function(e,t){n.unsubscribe(e,t)},this.hasLocalUnsyncedOps=function(){return!1},this.hasSessionHostConnection=function(){return!0}},ops.Session=function(e){function t(e){r.emit(ops.OdtDocument.signalProcessingBatchStart,e)}function n(e){r.emit(ops.OdtDocument.signalProcessingBatchEnd,e)}var o=new ops.OperationFactory,r=new ops.OdtDocument(e),i=null;this.setOperationFactory=function(e){o=e,i&&i.setOperationFactory(o)},this.setOperationRouter=function(e){i&&(i.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,t),i.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,n)),i=e,i.subscribe(ops.OperationRouter.signalProcessingBatchStart,t),i.subscribe(ops.OperationRouter.signalProcessingBatchEnd,n),e.setPlaybackFunction(function(e){return r.emit(ops.OdtDocument.signalOperationStart,e),e.execute(r)?(r.emit(ops.OdtDocument.signalOperationEnd,e),!0):!1}),e.setOperationFactory(o)},this.getOperationFactory=function(){return o},this.getOdtDocument=function(){return r},this.enqueue=function(e){i.push(e)},this.close=function(e){i.close(function(t){t?e(t):r.close(e)})},this.destroy=function(e){r.destroy(e)},this.setOperationRouter(new ops.TrivialOperationRouter)},gui.AnnotationController=function(e,t,n){function o(){var e=s.getCursor(n),e=e&&e.getNode(),t=!1;e&&(t=!c.isWithinAnnotation(e,s.getRootNode())),t!==l&&(l=t,u.emit(gui.AnnotationController.annotatableChanged,l))}function r(e){e.getMemberId()===n&&o()}function i(e){e===n&&o()}function a(e){e.getMemberId()===n&&o()}var s=e.getOdtDocument(),l=!1,u=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),c=odf.OdfUtils,d=core.StepDirection.NEXT;this.isAnnotatable=function(){return l},this.addAnnotation=function(){var t=new ops.OpAddAnnotation,o=s.getCursorSelection(n),r=o.length,o=o.position;l&&(o=r>=0?o:o+r,r=Math.abs(r),t.init({memberid:n,position:o,length:r,name:n+Date.now()}),e.enqueue([t]))},this.removeAnnotation=function(o){var r,i;r=s.getMember(n).getProperties().fullName,(!0!==t.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||r===c.getAnnotationCreator(o))&&(r=s.convertDomPointToCursorStep(o,0,d),i=s.convertDomPointToCursorStep(o,o.childNodes.length),o=new ops.OpRemoveAnnotation,o.init({memberid:n,position:r,length:i-r}),i=new ops.OpMoveCursor,i.init({memberid:n,position:r>0?r-1:r,length:0}),e.enqueue([o,i]))},this.subscribe=function(e,t){u.subscribe(e,t)},this.unsubscribe=function(e,t){u.unsubscribe(e,t)},this.destroy=function(e){s.unsubscribe(ops.Document.signalCursorAdded,r),s.unsubscribe(ops.Document.signalCursorRemoved,i),s.unsubscribe(ops.Document.signalCursorMoved,a),e()},t.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN),s.subscribe(ops.Document.signalCursorAdded,r),s.subscribe(ops.Document.signalCursorRemoved,i),s.subscribe(ops.Document.signalCursorMoved,a),o()},gui.AnnotationController.annotatableChanged="annotatable/changed",gui.Avatar=function(e,t){var n,o,r,i=this;this.setColor=function(e){o.style.borderColor=e},this.setImageUrl=function(e){i.isVisible()?o.src=e:r=e},this.isVisible=function(){return"block"===n.style.display},this.show=function(){r&&(o.src=r,r=void 0),n.style.display="block"},this.hide=function(){n.style.display="none"},this.markAsFocussed=function(e){e?n.classList.add("active"):n.classList.remove("active")},this.destroy=function(t){e.removeChild(n),t()},function(){var r=e.ownerDocument;n=r.createElement("div"),o=r.createElement("img"),n.appendChild(o),n.style.display=t?"block":"none",n.className="handle",e.appendChild(n)}()},gui.StepInfo=function(){},gui.StepInfo.VisualDirection={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1},gui.StepInfo.prototype.container=function(){},gui.StepInfo.prototype.offset=function(){},gui.VisualStepScanner=function(){},gui.VisualStepScanner.prototype.process=function(){},gui.GuiStepUtils=function(){function e(e){e=n.getContentBounds(e);var r,i=null;return e&&(e.container.nodeType===Node.TEXT_NODE?(r=e.container.ownerDocument.createRange(),r.setStart(e.container,e.startOffset),r.setEnd(e.container,e.endOffset),(i=0<r.getClientRects().length?r.getBoundingClientRect():null)&&" "===e.container.data.substring(e.startOffset,e.endOffset)&&1>=i.width&&(i=null),r.detach()):(t.isCharacterElement(e.container)||t.isCharacterFrame(e.container))&&(i=o.getBoundingClientRect(e.container))),i}var t=odf.OdfUtils,n=new odf.StepUtils,o=core.DomUtils,r=core.StepDirection.NEXT,i=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT,a=gui.StepInfo.VisualDirection.RIGHT_TO_LEFT;this.getContentRect=e,this.moveToFilteredStep=function(t,n,o){function s(e,t){return t.process(g,c,d)&&(e=!0,!f&&t.token&&(f=t.token)),e}var l,u,c,d,f,p=n===r,m=t.snapshot();l=!1;var g;do l=e(t),g={token:t.snapshot(),container:t.container,offset:t.offset,direction:n,visualDirection:n===r?i:a},u=t.nextStep()?e(t):null,t.restore(g.token),p?(c=l,d=u):(c=u,d=l),l=o.reduce(s,!1);while(!l&&t.advanceStep(n));return l||o.forEach(function(e){!f&&e.token&&(f=e.token)}),t.restore(f||m),Boolean(f)}},gui.Caret=function(e,t,n,o){function r(){c.style.opacity="0"===c.style.opacity?"1":"0",b.trigger()}function i(){return m.selectNodeContents(p),m.getBoundingClientRect()}function a(){Object.keys(E).forEach(function(e){w[e]=E[e]})}function s(){if(!1===E.isShown||e.getSelectionType()!==ops.OdtCursor.RangeSelection||!o&&!e.getSelectedRange().collapsed?(E.visibility="hidden",c.style.visibility="hidden",b.cancel()):(E.visibility="visible",c.style.visibility="visible",!1===E.isFocused?(c.style.opacity="1",b.cancel()):((N||w.visibility!==E.visibility)&&(c.style.opacity="1",b.cancel()),b.trigger())),x||C){var n;n=e.getNode();var r,s,l=v.getBoundingClientRect(y.getSizer()),p=!1,m=0;if(n.removeAttributeNS("urn:webodf:names:cursor","caret-sizer-active"),0<n.getClientRects().length)s=i(),m=s.left-v.getBoundingClientRect(n).left,p=!0;else if(g.setPosition(n,0),s=S.getContentRect(g),!s&&g.nextStep()&&(r=S.getContentRect(g))&&(s=r,p=!0),s||(n.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active","true"),s=i(),p=!0),!s)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+e.getMemberId());n;){if(0<n.getClientRects().length){s=v.getBoundingClientRect(n),p=!0;break}n=n.parentNode}s=v.translateRect(s,l,y.getZoomLevel()),n={top:s.top,height:s.height,right:p?s.left:s.right,width:v.adaptRangeDifferenceToZoomLevel(m,y.getZoomLevel())},8>n.height&&(n={top:n.top-(8-n.height)/2,height:8,right:n.right}),u.style.height=n.height+"px",u.style.top=n.top+"px",u.style.left=n.right-n.width+"px",u.style.width=n.width?n.width+"px":"",f&&(n=runtime.getWindow().getComputedStyle(e.getNode(),null),n.font?f.style.font=n.font:(f.style.fontStyle=n.fontStyle,f.style.fontVariant=n.fontVariant,f.style.fontWeight=n.fontWeight,f.style.fontSize=n.fontSize,f.style.lineHeight=n.lineHeight,f.style.fontFamily=n.fontFamily))}E.isShown&&C&&t.scrollIntoView(c.getBoundingClientRect()),w.isFocused!==E.isFocused&&d.markAsFocussed(E.isFocused),a(),x=C=N=!1}function l(e){u.parentNode.removeChild(u),p.parentNode.removeChild(p),e()}var u,c,d,f,p,m,g,h,b,y=e.getDocument().getCanvas(),v=core.DomUtils,S=new gui.GuiStepUtils,N=!1,C=!1,x=!1,E={isFocused:!1,isShown:!0,visibility:"hidden"},w={isFocused:!E.isFocused,isShown:!E.isShown,visibility:"hidden"};this.handleUpdate=function(){x=!0,h.trigger()},this.refreshCursorBlinking=function(){N=!0,h.trigger()},this.setFocus=function(){E.isFocused=!0,h.trigger()},this.removeFocus=function(){E.isFocused=!1,h.trigger()},this.show=function(){E.isShown=!0,h.trigger()},this.hide=function(){E.isShown=!1,h.trigger()},this.setAvatarImageUrl=function(e){d.setImageUrl(e)},this.setColor=function(e){c.style.borderColor=e,d.setColor(e)},this.getCursor=function(){return e},this.getFocusElement=function(){return c},this.toggleHandleVisibility=function(){d.isVisible()?d.hide():d.show()},this.showHandle=function(){d.show()},this.hideHandle=function(){d.hide()},this.setOverlayElement=function(e){f=e,u.appendChild(e),x=!0,h.trigger()},this.ensureVisible=function(){C=!0,h.trigger()},this.getBoundingClientRect=function(){return v.getBoundingClientRect(u)},this.destroy=function(e){core.Async.destroyAll([h.destroy,b.destroy,d.destroy,l],e)},function(){var t=e.getDocument(),o=[t.createRootFilter(e.getMemberId()),t.getPositionFilter()],i=t.getDOMDocument();m=i.createRange(),p=i.createElement("span"),p.className="webodf-caretSizer",p.textContent="|",e.getNode().appendChild(p),u=i.createElement("div"),u.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",e.getMemberId()),u.className="webodf-caretOverlay",c=i.createElement("div"),c.className="caret",u.appendChild(c),d=new gui.Avatar(u,n),y.getSizer().appendChild(u),g=t.createStepIterator(e.getNode(),0,o,t.getRootNode()),h=core.Task.createRedrawTask(s),b=core.Task.createTimeoutTask(r,500),h.triggerImmediate()}()},odf.TextSerializer=function(){function e(o){var r,i="",a=t.filter?t.filter.acceptNode(o):NodeFilter.FILTER_ACCEPT,s=o.nodeType;if((a===NodeFilter.FILTER_ACCEPT||a===NodeFilter.FILTER_SKIP)&&n.isTextContentContainingNode(o))for(r=o.firstChild;r;)i+=e(r),r=r.nextSibling;return a===NodeFilter.FILTER_ACCEPT&&(s===Node.ELEMENT_NODE&&n.isParagraph(o)?i+="\n":s===Node.TEXT_NODE&&o.textContent&&(i+=o.textContent)),i}var t=this,n=odf.OdfUtils;this.filter=null,this.writeToString=function(t){return t?(t=e(t),"\n"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t):""}},gui.MimeDataExporter=function(){var e;this.exportRangeToDataTransfer=function(t,n){var o;o=n.startContainer.ownerDocument.createElement("span"),o.appendChild(n.cloneContents()),o=e.writeToString(o);try{t.setData("text/plain",o)}catch(r){t.setData("Text",o)}},e=new odf.TextSerializer,e.filter=new odf.OdfNodeFilter},gui.Clipboard=function(e){this.setDataFromRange=function(t,n){var o,r=t.clipboardData;return o=runtime.getWindow(),!r&&o&&(r=o.clipboardData),r?(o=!0,e.exportRangeToDataTransfer(r,n),t.preventDefault()):o=!1,o}},gui.SessionContext=function(e,t){var n=e.getOdtDocument(),o=odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var e,r=n.getCursor(t);return r?(e=r&&r.getNode(),r=n.getMember(t).getProperties().fullName,(e=o.getParentAnnotation(e,n.getRootNode()))&&o.getAnnotationCreator(e)===r?!0:!1):!1}},gui.StyleSummary=function(e){function t(t,n){var o,i=t+"|"+n;return r.hasOwnProperty(i)||(o=[],e.forEach(function(e){e=(e=e.styleProperties[t])&&e[n],-1===o.indexOf(e)&&o.push(e)}),r[i]=o),r[i]}function n(e,n,o){return function(){var r=t(e,n);return o.length>=r.length&&r.every(function(e){return-1!==o.indexOf(e)})}}function o(e,n){var o=t(e,n);return 1===o.length?o[0]:void 0}var r={};this.getPropertyValues=t,this.getCommonValue=o,this.isBold=n("style:text-properties","fo:font-weight",["bold"]),this.isItalic=n("style:text-properties","fo:font-style",["italic"]),this.hasUnderline=n("style:text-properties","style:text-underline-style",["solid"]),this.hasStrikeThrough=n("style:text-properties","style:text-line-through-style",["solid"]),this.fontSize=function(){var e=o("style:text-properties","fo:font-size");return e&&parseFloat(e)},this.fontName=function(){return o("style:text-properties","style:font-name")},this.isAlignedLeft=n("style:paragraph-properties","fo:text-align",["left","start"]),this.isAlignedCenter=n("style:paragraph-properties","fo:text-align",["center"]),this.isAlignedRight=n("style:paragraph-properties","fo:text-align",["right","end"]),this.isAlignedJustified=n("style:paragraph-properties","fo:text-align",["justify"]),this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName},this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,isAlignedJustified:this.isAlignedJustified}},gui.DirectFormattingController=function(e,t,n,o,r,i,a){function s(){return I.value().styleSummary}function l(){return I.value().enabledFeatures}function u(e){var t;return e.collapsed?(t=e.startContainer,t.hasChildNodes()&&e.startOffset<t.childNodes.length&&(t=t.childNodes.item(e.startOffset)),e=[t]):e=B.getTextElements(e,!0,!1),e}function c(){var e=M.getCursor(o),r=e&&e.getSelectedRange(),i=[],i=[],a=!0,s={directTextStyling:!0,directParagraphStyling:!0};return r&&(i=u(r),0===i.length&&(i=[r.startContainer,r.endContainer],a=!1),i=M.getFormatting().getAppliedStyles(i)),void 0!==i[0]&&z&&(i[0].styleProperties=U.mergeObjects(i[0].styleProperties,z)),!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(s.directTextStyling=s.directParagraphStyling=n.isLocalCursorWithinOwnAnnotation()),s.directTextStyling&&(s.directTextStyling=a&&void 0!==e&&e.getSelectionType()===ops.OdtCursor.RangeSelection),{enabledFeatures:s,appliedStyles:i,styleSummary:new gui.StyleSummary(i)}}function d(e,t){var n={};return Object.keys(e).forEach(function(o){var r=e[o](),i=t[o]();r!==i&&(n[o]=i)}),n}function f(){var e,t;t=k.styleSummary;var n=I.value(),o=n.styleSummary,r=k.enabledFeatures,i=n.enabledFeatures;e=d(t.text,o.text),t=d(t.paragraph,o.paragraph),r=!(i.directTextStyling===r.directTextStyling&&i.directParagraphStyling===r.directParagraphStyling),k=n,r&&L.emit(gui.DirectFormattingController.enabledChanged,i),0<Object.keys(e).length&&L.emit(gui.DirectFormattingController.textStylingChanged,e),0<Object.keys(t).length&&L.emit(gui.DirectFormattingController.paragraphStylingChanged,t)}function p(){I.reset(),f()}function m(e){("string"==typeof e?e:e.getMemberId())===o&&I.reset()}function g(){I.reset()}function h(e){var t=M.getCursor(o);e=e.paragraphElement,t&&B.getParagraphElement(t.getNode())===e&&I.reset()}function b(e,t){return t(!e()),!0}function y(t){if(l().directTextStyling){var n=M.getCursorSelection(o),r={"style:text-properties":t};0!==n.length?(t=new ops.OpApplyDirectStyling,t.init({memberid:o,position:n.position,length:n.length,setProperties:r}),e.enqueue([t])):(z=U.mergeObjects(z||{},r),I.reset())}}function v(e,t){var n={};n[e]=t,y(n)}function S(e){e=e.spec(),z&&e.memberid===o&&"SplitParagraph"!==e.optype&&(z=null,I.reset())}function N(e){v("fo:font-weight",e?"bold":"normal")}function C(e){v("fo:font-style",e?"italic":"normal")}function x(e){v("style:text-underline-style",e?"solid":"none")}function E(e){v("style:text-line-through-style",e?"solid":"none")}function w(t){if(l().directParagraphStyling){var n,i=M.getCursor(o).getSelectedRange(),i=B.getParagraphElements(i),a=M.getFormatting(),s=[],u={};i.forEach(function(e){var i,l=M.convertDomPointToCursorStep(e,0,H),c=e.getAttributeNS(odf.Namespaces.textns,"style-name");e=c?u.hasOwnProperty(c)?u[c]:void 0:n,e||(e=r.generateStyleName(),c?(u[c]=e,i=a.createDerivedStyleObject(c,"paragraph",{})):(n=e,i={}),i=t(i),c=new ops.OpAddStyle,c.init({memberid:o,styleName:e.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:i}),s.push(c)),c=new ops.OpSetParagraphStyle,c.init({memberid:o,styleName:e.toString(),position:l}),s.push(c)}),e.enqueue(s)}}function T(e){w(function(t){return U.mergeObjects(t,e)})}function O(e){T({"style:paragraph-properties":{"fo:text-align":e}})}function A(e,t){var n,o=M.getFormatting().getDefaultTabStopDistance(),r=t["style:paragraph-properties"];return r&&(r=r["fo:margin-left"],n=B.parseLength(r)),U.mergeObjects(t,{"style:paragraph-properties":{"fo:margin-left":n&&n.unit===o.unit?n.value+e*o.value+n.unit:e*o.value+o.unit}})}function R(e,t){var n=u(e),n=0===n.length?[e.startContainer]:n,n=M.getFormatting().getAppliedStyles(n),o=0<n.length?n[0].styleProperties:void 0,r=M.getFormatting().getAppliedStylesForElement(t).styleProperties;return o&&"text"===o["style:family"]&&o["style:text-properties"]?r&&r["style:text-properties"]?(o=o["style:text-properties"],r=r["style:text-properties"],!Object.keys(o).every(function(e){return o[e]===r[e]})):!0:!1}function P(){}function D(){return!1}var k,I,F=this,M=e.getOdtDocument(),U=new core.Utils,B=odf.OdfUtils,L=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),_=odf.Namespaces.textns,H=core.StepDirection.NEXT,z=null;this.enabledFeatures=l,this.formatTextSelection=y,this.createCursorStyleOp=function(e,t,n){var r=null,i=z;return n&&(i=(n=I.value().appliedStyles[0])&&n.styleProperties),i&&i["style:text-properties"]&&(r=new ops.OpApplyDirectStyling,r.init({memberid:o,position:e,length:t,setProperties:{"style:text-properties":i["style:text-properties"]}}),z=null,I.reset()),r},this.setBold=N,this.setItalic=C,this.setHasUnderline=x,this.setHasStrikethrough=E,this.setFontSize=function(e){v("fo:font-size",e+"pt")},this.setFontName=function(e){v("style:font-name",e)},this.getAppliedStyles=function(){return I.value().appliedStyles},this.toggleBold=b.bind(F,function(){return s().isBold()},N),this.toggleItalic=b.bind(F,function(){return s().isItalic()},C),this.toggleUnderline=b.bind(F,function(){return s().hasUnderline()},x),this.toggleStrikethrough=b.bind(F,function(){return s().hasStrikeThrough()},E),this.isBold=function(){return s().isBold()},this.isItalic=function(){return s().isItalic()},this.hasUnderline=function(){return s().hasUnderline()},this.hasStrikeThrough=function(){return s().hasStrikeThrough()},this.fontSize=function(){return s().fontSize()},this.fontName=function(){return s().fontName()},this.isAlignedLeft=function(){return s().isAlignedLeft()},this.isAlignedCenter=function(){return s().isAlignedCenter()},this.isAlignedRight=function(){return s().isAlignedRight()},this.isAlignedJustified=function(){return s().isAlignedJustified()},this.alignParagraphLeft=function(){return O("left"),!0},this.alignParagraphCenter=function(){return O("center"),!0},this.alignParagraphRight=function(){return O("right"),!0},this.alignParagraphJustified=function(){return O("justify"),!0},this.indent=function(){return w(A.bind(null,1)),!0},this.outdent=function(){return w(A.bind(null,-1)),!0},this.createParagraphStyleOps=function(e){if(!l().directParagraphStyling)return[];var t,n,i=M.getCursor(o),a=i.getSelectedRange(),s=[];i.hasForwardSelection()?(t=i.getAnchorNode(),n=i.getNode()):(t=i.getNode(),n=i.getAnchorNode()),i=B.getParagraphElement(n),runtime.assert(Boolean(i),"DirectFormattingController: Cursor outside paragraph");var u=i,c=[M.getPositionFilter(),M.createRootFilter(o)];return!1!==M.createStepIterator(a.endContainer,a.endOffset,c,u).nextStep()?s:(n!==t&&(i=B.getParagraphElement(t)),(z||R(a,i))&&(a=(a=I.value().appliedStyles[0])&&a.styleProperties)?((i=i.getAttributeNS(_,"style-name"))&&(a={"style:text-properties":a["style:text-properties"]},a=M.getFormatting().createDerivedStyleObject(i,"paragraph",a)),t=r.generateStyleName(),i=new ops.OpAddStyle,i.init({memberid:o,styleName:t,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:a}),s.push(i),i=new ops.OpSetParagraphStyle,i.init({memberid:o,styleName:t,position:e}),s.push(i),s):s)},this.subscribe=function(e,t){L.subscribe(e,t)},this.unsubscribe=function(e,t){L.unsubscribe(e,t)},this.destroy=function(e){M.unsubscribe(ops.Document.signalCursorAdded,m),M.unsubscribe(ops.Document.signalCursorRemoved,m),M.unsubscribe(ops.Document.signalCursorMoved,m),M.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,g),M.unsubscribe(ops.OdtDocument.signalParagraphChanged,h),M.unsubscribe(ops.OdtDocument.signalOperationEnd,S),M.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,f),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,p),e()},function(){M.subscribe(ops.Document.signalCursorAdded,m),M.subscribe(ops.Document.signalCursorRemoved,m),M.subscribe(ops.Document.signalCursorMoved,m),M.subscribe(ops.OdtDocument.signalParagraphStyleModified,g),M.subscribe(ops.OdtDocument.signalParagraphChanged,h),M.subscribe(ops.OdtDocument.signalOperationEnd,S),M.subscribe(ops.OdtDocument.signalProcessingBatchEnd,f),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,p),I=new core.LazyProperty(c),k=I.value(),i||(F.formatTextSelection=P,F.setBold=P,F.setItalic=P,F.setHasUnderline=P,F.setHasStrikethrough=P,F.setFontSize=P,F.setFontName=P,F.toggleBold=D,F.toggleItalic=D,F.toggleUnderline=D,F.toggleStrikethrough=D),a||(F.alignParagraphCenter=P,F.alignParagraphJustified=P,F.alignParagraphLeft=P,F.alignParagraphRight=P,F.createParagraphStyleOps=function(){return[]},F.indent=P,F.outdent=P)}()},gui.DirectFormattingController.enabledChanged="enabled/changed",gui.DirectFormattingController.textStylingChanged="textStyling/changed",gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed",gui.DirectFormattingController.SelectionInfo=function(){},gui.KeyboardHandler=function(){function e(e,n){switch(n||(n=t.None),e){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:n|=t.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:n|=t.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:n|=t.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:n|=t.Shift}return e+":"+n}var t=gui.KeyboardHandler.Modifier,n=null,o={};this.setDefault=function(e){n=e},this.bind=function(t,n,r,i){t=e(t,n),runtime.assert(i||!1===o.hasOwnProperty(t),"tried to overwrite the callback handler of key combo: "+t),o[t]=r},this.unbind=function(t,n){var r=e(t,n);delete o[r]},this.reset=function(){n=null,o={}},this.handleEvent=function(r){var i=r.keyCode,a=t.None;r.metaKey&&(a|=t.Meta),r.ctrlKey&&(a|=t.Ctrl),r.altKey&&(a|=t.Alt),r.shiftKey&&(a|=t.Shift),i=e(i,a),i=o[i],a=!1,i?a=i():null!==n&&(a=n(r)),a&&(r.preventDefault?r.preventDefault():r.returnValue=!1)}},gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12},gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224},gui.HyperlinkClickHandler=function(e,t,n){function o(){var t=e();runtime.assert(Boolean(t.classList),"Document container has no classList element"),t.classList.remove("webodf-inactiveLinks")}function r(){var t=e();runtime.assert(Boolean(t.classList),"Document container has no classList element"),t.classList.add("webodf-inactiveLinks")}function i(){d.removeEventListener("focus",r,!1),p.forEach(function(e){t.unbind(e.keyCode,e.modifier),n.unbind(e.keyCode,e.modifier)}),p.length=0}function a(e){if(i(),e!==s.None){switch(d.addEventListener("focus",r,!1),e){case s.Ctrl:p.push({keyCode:l.Ctrl,modifier:s.None});break;case s.Meta:p.push({keyCode:l.LeftMeta,modifier:s.None}),p.push({keyCode:l.RightMeta,modifier:s.None}),p.push({keyCode:l.MetaInMozilla,modifier:s.None})}p.forEach(function(e){t.bind(e.keyCode,e.modifier,o),n.bind(e.keyCode,e.modifier,r)})}}var s=gui.KeyboardHandler.Modifier,l=gui.KeyboardHandler.KeyCode,u=xmldom.XPath,c=odf.OdfUtils,d=runtime.getWindow(),f=s.None,p=[];runtime.assert(null!==d,"Expected to be run in an environment which has a global window, like a browser."),this.handleClick=function(t){var n,o,r=t.target||t.srcElement;if(t.ctrlKey?n=s.Ctrl:t.metaKey&&(n=s.Meta),f===s.None||f===n){e:{for(;null!==r;){if(c.isHyperlink(r))break e;if(c.isParagraph(r))break;r=r.parentNode}r=null}r&&(r=c.getHyperlinkTarget(r),""!==r&&("#"===r[0]?(r=r.substring(1),n=e(),o=u.getODFElementsWithXPath(n,"//text:bookmark-start[@text:name='"+r+"']",odf.Namespaces.lookupNamespaceURI),0===o.length&&(o=u.getODFElementsWithXPath(n,"//text:bookmark[@text:name='"+r+"']",odf.Namespaces.lookupNamespaceURI)),0<o.length&&o[0].scrollIntoView(!0)):d.open(r),t.preventDefault?t.preventDefault():t.returnValue=!1))}},this.setModifier=function(e){f!==e&&(runtime.assert(e===s.None||e===s.Ctrl||e===s.Meta,"Unsupported KeyboardHandler.Modifier value: "+e),f=e,f!==s.None?r():o(),a(f))},this.getModifier=function(){return f},this.destroy=function(e){r(),i(),e()}},gui.EventManager=function(e){function t(e){function t(e,t,n){var o,r=!1;o="on"+t,e.attachEvent&&(e.attachEvent(o,n),r=!0),!r&&e.addEventListener&&(e.addEventListener(t,n,!1),r=!0),r&&!N[t]||!e.hasOwnProperty(o)||(e[o]=n)}function n(e,t,n){var o="on"+t;e.detachEvent&&e.detachEvent(o,n),e.removeEventListener&&e.removeEventListener(t,n,!1),e[o]===n&&(e[o]=null)}function o(t){if(-1===i.indexOf(t)){if(i.push(t),r.filters.every(function(e){return e(t)}))try{a.emit(e,t)}catch(n){runtime.log("Error occurred while processing "+e+":\n"+n.message+"\n"+n.stack)}runtime.setTimeout(function(){i.splice(i.indexOf(t),1)},0)}}var r=this,i=[],a=new core.EventNotifier([e]);this.filters=[],this.subscribe=function(t){a.subscribe(e,t)},this.unsubscribe=function(t){a.unsubscribe(e,t)},this.destroy=function(){n(S,e,o),n(v,e,o),n(w,e,o)},C[e]&&t(S,e,o),t(v,e,o),t(w,e,o)}function n(e,t,n){function o(t){n(t,r,function(t){t.type=e,i.emit(e,t)})}var r={},i=new core.EventNotifier([e]);this.subscribe=function(t){i.subscribe(e,t)},this.unsubscribe=function(t){i.unsubscribe(e,t)},this.destroy=function(){t.forEach(function(e){T.unsubscribe(e,o)})},function(){t.forEach(function(e){T.subscribe(e,o)})}()}function o(e){runtime.clearTimeout(e),delete O[e]}function r(e,t){var n=runtime.setTimeout(function(){e(),o(n)},t);return O[n]=!0,n}function i(e,t,n){var i=e.touches.length,a=e.touches[0],s=t.timer;"touchmove"===e.type||"touchend"===e.type?s&&o(s):"touchstart"===e.type&&(1!==i?runtime.clearTimeout(s):s=r(function(){n({clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY,target:e.target||e.srcElement||null,detail:1})},400)),t.timer=s}function a(e,t,n){var o=e.touches[0],r=e.target||e.srcElement||null,i=t.target;1!==e.touches.length||"touchend"===e.type?i=null:"touchstart"===e.type&&"webodf-draggable"===r.getAttribute("class")?i=r:"touchmove"===e.type&&i&&(e.preventDefault(),e.stopPropagation(),n({clientX:o.clientX,clientY:o.clientY,pageX:o.pageX,pageY:o.pageY,target:i,detail:1})),t.target=i}function s(e,t,n){var o=e.target||e.srcElement||null,r=t.dragging;"drag"===e.type?r=!0:"touchend"===e.type&&r&&(r=!1,e=e.changedTouches[0],n({clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,target:o,detail:1})),t.dragging=r}function l(){w.classList.add("webodf-touchEnabled"),T.unsubscribe("touchstart",l)}function u(e){var t=e.scrollX,n=e.scrollY;this.restore=function(){e.scrollX===t&&e.scrollY===n||e.scrollTo(t,n)}}function c(e){var t=e.scrollTop,n=e.scrollLeft;this.restore=function(){(e.scrollTop!==t||e.scrollLeft!==n)&&(e.scrollTop=t,e.scrollLeft=n)}}function d(e,n){var o=E[e]||x[e]||null;return!o&&n&&(o=E[e]=new t(e)),o}function f(e,t){d(e,!0).subscribe(t)}function p(e,t){var n=d(e,!1);n&&n.unsubscribe(t)}function m(){return e.getDOMDocument().activeElement===v}function g(){m()&&v.blur(),v.setAttribute("disabled","true")}function h(){v.removeAttribute("disabled")}function b(e){for(var t=[];e;)(e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight)&&t.push(new c(e)),e=e.parentNode;return t.push(new u(S)),t}function y(){var e;m()||(e=b(v),h(),v.focus(),e.forEach(function(e){e.restore()}))}var v,S=runtime.getWindow(),N={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},C={mousedown:!0,mouseup:!0,focus:!0},x={},E={},w=e.getCanvas().getElement(),T=this,O={};this.addFilter=function(e,t){d(e,!0).filters.push(t)},this.removeFilter=function(e,t){var n=d(e,!0),o=n.filters.indexOf(t);-1!==o&&n.filters.splice(o,1)},this.subscribe=f,this.unsubscribe=p,this.hasFocus=m,this.focus=y,this.getEventTrap=function(){return v},this.setEditing=function(e){var t=m();t&&v.blur(),e?v.removeAttribute("readOnly"):v.setAttribute("readOnly","true"),t&&y()},this.destroy=function(e){p("touchstart",l),Object.keys(O).forEach(function(e){o(parseInt(e,10))}),O.length=0,Object.keys(x).forEach(function(e){x[e].destroy()}),x={},p("mousedown",g),p("mouseup",h),p("contextmenu",h),Object.keys(E).forEach(function(e){E[e].destroy()}),E={},v.parentNode.removeChild(v),e()},function(){var t=e.getOdfCanvas().getSizer(),o=t.ownerDocument;runtime.assert(Boolean(S),"EventManager requires a window object to operate correctly"),v=o.createElement("textarea"),v.id="eventTrap",v.setAttribute("tabindex","-1"),v.setAttribute("readOnly","true"),v.setAttribute("rows","1"),t.appendChild(v),f("mousedown",g),f("mouseup",h),f("contextmenu",h),x.longpress=new n("longpress",["touchstart","touchmove","touchend"],i),x.drag=new n("drag",["touchstart","touchmove","touchend"],a),x.dragstop=new n("dragstop",["drag","touchend"],s),f("touchstart",l)}()},gui.IOSSafariSupport=function(e){function t(){n.innerHeight!==n.outerHeight&&(o.style.display="none",runtime.requestAnimationFrame(function(){o.style.display="block"}))}var n=runtime.getWindow(),o=e.getEventTrap();this.destroy=function(n){e.unsubscribe("focus",t),o.removeAttribute("autocapitalize"),o.style.WebkitTransform="",n()},e.subscribe("focus",t),o.setAttribute("autocapitalize","off"),o.style.WebkitTransform="translateX(-10000px)"},gui.HyperlinkController=function(e,t,n,o){function r(){var e=!0;!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(e=n.isLocalCursorWithinOwnAnnotation()),e!==u&&(u=e,l.emit(gui.HyperlinkController.enabledChanged,u))}function i(e){e.getMemberId()===o&&r()}var a=odf.OdfUtils,s=e.getOdtDocument(),l=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),u=!1;this.isEnabled=function(){return u},this.subscribe=function(e,t){l.subscribe(e,t)},this.unsubscribe=function(e,t){l.unsubscribe(e,t)},this.addHyperlink=function(t,n){if(u){var r=s.getCursorSelection(o),i=new ops.OpApplyHyperlink,a=[];(0===r.length||n)&&(n=n||t,i=new ops.OpInsertText,i.init({memberid:o,position:r.position,text:n}),r.length=n.length,a.push(i)),i=new ops.OpApplyHyperlink,i.init({memberid:o,position:r.position,length:r.length,hyperlink:t}),a.push(i),e.enqueue(a)}},this.removeHyperlinks=function(){if(u){var t,n,r=s.createPositionIterator(s.getRootNode()),i=s.getCursor(o).getSelectedRange(),l=a.getHyperlinkElements(i),c=i.collapsed&&1===l.length,d=s.getDOMDocument().createRange(),f=[];0!==l.length&&(l.forEach(function(e){d.selectNodeContents(e),t=s.convertDomToCursorRange({anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset}),n=new ops.OpRemoveHyperlink,n.init({memberid:o,position:t.position,length:t.length}),f.push(n)}),c||(c=l[0],-1===i.comparePoint(c,0)&&(d.setStart(c,0),d.setEnd(i.startContainer,i.startOffset),t=s.convertDomToCursorRange({anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset}),0<t.length&&(n=new ops.OpApplyHyperlink,n.init({memberid:o,position:t.position,length:t.length,hyperlink:a.getHyperlinkTarget(c)}),f.push(n))),l=l[l.length-1],r.moveToEndOfNode(l),r=r.unfilteredDomOffset(),1===i.comparePoint(l,r)&&(d.setStart(i.endContainer,i.endOffset),d.setEnd(l,r),t=s.convertDomToCursorRange({anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset}),0<t.length&&(n=new ops.OpApplyHyperlink,n.init({memberid:o,position:t.position,length:t.length,hyperlink:a.getHyperlinkTarget(l)}),f.push(n)))),e.enqueue(f),d.detach())}},this.destroy=function(e){s.unsubscribe(ops.Document.signalCursorMoved,i),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),e()},s.subscribe(ops.Document.signalCursorMoved,i),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),r()},gui.HyperlinkController.enabledChanged="enabled/changed",gui.ImageController=function(e,t,n,o,r){function i(){var e=!0;!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(e=n.isLocalCursorWithinOwnAnnotation()),e!==p&&(p=e,f.emit(gui.ImageController.enabledChanged,p))}function a(e){e.getMemberId()===o&&i()}var s={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},l=odf.Namespaces.textns,u=e.getOdtDocument(),c=odf.OdfUtils,d=u.getFormatting(),f=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),p=!1;
this.isEnabled=function(){return p},this.subscribe=function(e,t){f.subscribe(e,t)},this.unsubscribe=function(e,t){f.unsubscribe(e,t)},this.insertImage=function(t,n,i,a){if(p){if(runtime.assert(i>0&&a>0,"Both width and height of the image should be greater than 0px."),a={width:i,height:a},i=c.getParagraphElement(u.getCursor(o).getNode()).getAttributeNS(l,"style-name")){i=d.getContentSize(i,"paragraph");var f=1,m=1;a.width>i.width&&(f=i.width/a.width),a.height>i.height&&(m=i.height/a.height),i=Math.min(f,m),a={width:a.width*i,height:a.height*i}}i=a.width+"px",a=a.height+"px";var g,h=u.getOdfCanvas().odfContainer().rootElement.styles,f=t.toLowerCase(),m=s.hasOwnProperty(f)?s[f]:null,f=[];runtime.assert(null!==m,"Image type is not supported: "+t),m="Pictures/"+r.generateImageName()+m,g=new ops.OpSetBlob,g.init({memberid:o,filename:m,mimetype:t,content:n}),f.push(g),d.getStyleElement("Graphics","graphic",[h])||(t=new ops.OpAddStyle,t.init({memberid:o,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph","svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),f.push(t)),t=r.generateStyleName(),n=new ops.OpAddStyle,n.init({memberid:o,styleName:t,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline","style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}}),f.push(n),g=new ops.OpInsertImage,g.init({memberid:o,position:u.getCursorPosition(o),filename:m,frameWidth:i,frameHeight:a,frameStyleName:t,frameName:r.generateFrameName()}),f.push(g),e.enqueue(f)}},this.destroy=function(e){u.unsubscribe(ops.Document.signalCursorMoved,a),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,i),e()},u.subscribe(ops.Document.signalCursorMoved,a),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,i),i()},gui.ImageController.enabledChanged="enabled/changed",gui.ImageSelector=function(e){function t(){var t=e.getSizer(),n=r.createElement("div");return n.id="imageSelector",n.style.borderWidth="1px",t.appendChild(n),o.forEach(function(e){var t=r.createElement("div");t.className=e,n.appendChild(t)}),n}var n=odf.Namespaces.svgns,o="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),r=e.getElement().ownerDocument,i=!1;this.select=function(o){var a,s,l=r.getElementById("imageSelector");l||(l=t()),i=!0,a=l.parentNode,s=o.getBoundingClientRect();var u=a.getBoundingClientRect(),c=e.getZoomLevel();a=(s.left-u.left)/c-1,s=(s.top-u.top)/c-1,l.style.display="block",l.style.left=a+"px",l.style.top=s+"px",l.style.width=o.getAttributeNS(n,"width"),l.style.height=o.getAttributeNS(n,"height")},this.clearSelection=function(){var e;i&&(e=r.getElementById("imageSelector"))&&(e.style.display="none"),i=!1},this.isSelectorElement=function(e){var t=r.getElementById("imageSelector");return t?e===t||e.parentNode===t:!1}},function(){function e(e){function t(e){return i=e.which&&String.fromCharCode(e.which)===r,r=void 0,!1===i}function n(){i=!1}function o(e){r=e.data,i=!1}var r,i=!1;this.destroy=function(r){e.unsubscribe("textInput",n),e.unsubscribe("compositionend",o),e.removeFilter("keypress",t),r()},e.subscribe("textInput",n),e.subscribe("compositionend",o),e.addFilter("keypress",t)}gui.InputMethodEditor=function(t,n){function o(e){b&&(e?b.getNode().setAttributeNS(h,"composing","true"):(b.getNode().removeAttributeNS(h,"composing"),d.textContent=""))}function r(){S&&(S=!1,o(!1),C.emit(gui.InputMethodEditor.signalCompositionEnd,{data:N}),N="")}function i(){E||(E=!0,r(),y.value=b&&b.getSelectedRange().collapsed?"":m.writeToString(b.getSelectedRange().cloneContents()),y.setSelectionRange(0,y.value.length),E=!1)}function a(){n.hasFocus()&&f.trigger()}function s(){p=void 0,f.cancel(),o(!0),S||C.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function l(e){e=p=e.data,S=!0,N+=e,f.trigger()}function u(e){e.data!==p&&(e=e.data,S=!0,N+=e,f.trigger()),p=void 0}function c(){d.textContent=y.value}var d,f,p,m,g,h="urn:webodf:names:cursor",b=null,y=n.getEventTrap(),v=y.ownerDocument,S=!1,N="",C=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),x=[],E=!1;this.subscribe=C.subscribe,this.unsubscribe=C.unsubscribe,this.registerCursor=function(e){e.getMemberId()===t&&(b=e,b.getNode().appendChild(d),e.subscribe(ops.OdtCursor.signalCursorUpdated,a),n.subscribe("input",c),n.subscribe("compositionupdate",c))},this.removeCursor=function(e){b&&e===t&&(b.getNode().removeChild(d),b.unsubscribe(ops.OdtCursor.signalCursorUpdated,a),n.unsubscribe("input",c),n.unsubscribe("compositionupdate",c),b=null)},this.destroy=function(e){n.unsubscribe("compositionstart",s),n.unsubscribe("compositionend",l),n.unsubscribe("textInput",u),n.unsubscribe("keypress",r),n.unsubscribe("focus",i),core.Async.destroyAll(g,e)},function(){m=new odf.TextSerializer,m.filter=new odf.OdfNodeFilter,n.subscribe("compositionstart",s),n.subscribe("compositionend",l),n.subscribe("textInput",u),n.subscribe("keypress",r),n.subscribe("focus",i),x.push(new e(n)),g=x.map(function(e){return e.destroy}),d=v.createElement("span"),d.setAttribute("id","composer"),f=core.Task.createTimeoutTask(i,1),g.push(f.destroy)}()},gui.InputMethodEditor.signalCompositionStart="input/compositionstart",gui.InputMethodEditor.signalCompositionEnd="input/compositionend"}(),gui.MetadataController=function(e,t){function n(e){i.emit(gui.MetadataController.signalMetadataChanged,e)}function o(e){var t=-1===a.indexOf(e);return t||runtime.log("Setting "+e+" is restricted."),t}var r=e.getOdtDocument(),i=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),a=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(n,r){var i,a={},s="";n&&Object.keys(n).filter(o).forEach(function(e){a[e]=n[e]}),r&&(s=r.filter(o).join(",")),(0<s.length||0<Object.keys(a).length)&&(i=new ops.OpUpdateMetadata,i.init({memberid:t,setProperties:a,removedProperties:0<s.length?{attributes:s}:null}),e.enqueue([i]))},this.getMetadata=function(e){var t;return runtime.assert("string"==typeof e,"Property must be a string"),t=e.split(":"),runtime.assert(2===t.length,"Property must be a namespace-prefixed string"),e=odf.Namespaces.lookupNamespaceURI(t[0]),runtime.assert(Boolean(e),"Prefix must be for an ODF namespace."),r.getOdfCanvas().odfContainer().getMetadata(e,t[1])},this.subscribe=function(e,t){i.subscribe(e,t)},this.unsubscribe=function(e,t){i.unsubscribe(e,t)},this.destroy=function(e){r.unsubscribe(ops.OdtDocument.signalMetadataUpdated,n),e()},r.subscribe(ops.OdtDocument.signalMetadataUpdated,n)},gui.MetadataController.signalMetadataChanged="metadata/changed",gui.PasteController=function(e,t,n,o){function r(){s=!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?n.isLocalCursorWithinOwnAnnotation():!0}function i(e){e.getMemberId()===o&&r()}var a=e.getOdtDocument(),s=!1,l=odf.Namespaces.textns,u=core.StepDirection.NEXT,c=odf.OdfUtils;this.isEnabled=function(){return s},this.paste=function(t){if(s){var n=a.getCursorPosition(o),r=a.getCursor(o).getNode(),r=c.getParagraphElement(r),i=r.getAttributeNS(l,"style-name")||"",d=n,f=[],p=a.convertDomPointToCursorStep(r,0,u);t.replace(/\r/g,"").split("\n").forEach(function(e){var t=new ops.OpInsertText,n=new ops.OpSplitParagraph;t.init({memberid:o,position:d,text:e,moveCursor:!0}),f.push(t),d+=e.length,n.init({memberid:o,position:d,paragraphStyleName:i,sourceParagraphPosition:p,moveCursor:!0}),f.push(n),p=d+=1}),f.pop(),e.enqueue(f)}},this.destroy=function(e){a.unsubscribe(ops.Document.signalCursorMoved,i),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),e()},a.subscribe(ops.Document.signalCursorMoved,i),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),r()},gui.ClosestXOffsetScanner=function(e){function t(t){return null!==t&&void 0!==o?Math.abs(t-e)>o:!1}function n(n){null!==n&&!1===t(n)&&(o=Math.abs(n-e))}var o,r=this,i=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT;this.token=void 0,this.process=function(e,o,a){var s,l;return e.visualDirection===i?(s=o&&o.right,l=a&&a.left):(s=o&&o.left,l=a&&a.right),t(s)||t(l)?!0:((o||a)&&(n(s),n(l),r.token=e.token),!1)}},gui.LineBoundaryScanner=function(){var e=this,t=null;this.token=void 0,this.process=function(n,o,r){var i;if(i=r)if(t){var a=t;i=Math.min(a.bottom-a.top,r.bottom-r.top);var s=Math.max(a.top,r.top),a=Math.min(a.bottom,r.bottom)-s;i=.4>=(i>0?a/i:0)}else i=!1;return!o||r&&!i||(e.token=n.token),i?!0:(t=(n=t)&&o?{left:Math.min(n.left,o.left),right:Math.max(n.right,o.right),top:Math.min(n.top,o.top),bottom:Math.min(n.bottom,o.bottom)}:n||o,!1)}},gui.ParagraphBoundaryScanner=function(){var e,t=this,n=!1,o=odf.OdfUtils;this.token=void 0,this.process=function(r){var i=o.getParagraphElement(r.container());return n||(e=i,n=!0),e!==i?!0:(t.token=r.token,!1)}},odf.WordBoundaryFilter=function(e,t){function n(t,n,o){for(var r,i=null,a=e.getRootNode();t!==a&&null!==t&&null===i;)r=0>n?t.previousSibling:t.nextSibling,o(r)===NodeFilter.FILTER_ACCEPT&&(i=r),t=t.parentNode;return i}function o(e,t){var n;return null===e?p.NO_NEIGHBOUR:a.isCharacterElement(e)?p.SPACE_CHAR:e.nodeType===r||a.isTextSpan(e)||a.isHyperlink(e)?(n=e.textContent.charAt(t()),l.test(n)?p.SPACE_CHAR:s.test(n)?p.PUNCTUATION_CHAR:p.WORD_CHAR):p.OTHER}var r=Node.TEXT_NODE,i=Node.ELEMENT_NODE,a=odf.OdfUtils,s=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,l=/\s/,u=core.PositionFilter.FilterResult.FILTER_ACCEPT,c=core.PositionFilter.FilterResult.FILTER_REJECT,d=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,f=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,p={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(e){var r=e.container(),a=e.leftNode(),s=e.rightNode(),l=e.unfilteredDomOffset,m=function(){return e.unfilteredDomOffset()-1};return r.nodeType===i&&(null===s&&(s=n(r,1,e.getNodeFilter())),null===a&&(a=n(r,-1,e.getNodeFilter()))),r!==s&&(l=function(){return 0}),r!==a&&null!==a&&(m=function(){return a.textContent.length-1}),r=o(a,m),s=o(s,l),r===p.WORD_CHAR&&s===p.WORD_CHAR||r===p.PUNCTUATION_CHAR&&s===p.PUNCTUATION_CHAR||t===d&&r!==p.NO_NEIGHBOUR&&s===p.SPACE_CHAR||t===f&&r===p.SPACE_CHAR&&s!==p.NO_NEIGHBOUR?c:u}},odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2},gui.SelectionController=function(e,t){function n(e){var n=e.spec();(e.isEdit||n.memberid===t)&&(h=void 0,b.cancel())}function o(){var e=y.getCursor(t).getNode();return y.createStepIterator(e,0,[N,x],y.getRootElement(e))}function r(e,t,n){n=new odf.WordBoundaryFilter(y,n);var o=y.getRootElement(e)||y.getRootNode(),r=y.createRootFilter(o);return y.createStepIterator(e,t,[N,r,n],o)}function i(e,t){return t?{anchorNode:e.startContainer,anchorOffset:e.startOffset,focusNode:e.endContainer,focusOffset:e.endOffset}:{anchorNode:e.endContainer,anchorOffset:e.endOffset,focusNode:e.startContainer,focusOffset:e.startOffset}}function a(e,n,o){var r=new ops.OpMoveCursor;return r.init({memberid:t,position:e,length:n||0,selectionType:o}),r}function s(n,o,r){var s;s=y.getCursor(t),s=i(s.getSelectedRange(),s.hasForwardSelection()),s.focusNode=n,s.focusOffset=o,r||(s.anchorNode=s.focusNode,s.anchorOffset=s.focusOffset),n=y.convertDomToCursorRange(s),e.enqueue([a(n.position,n.length)])}function l(e){var t;t=r(e.startContainer,e.startOffset,w),t.roundToPreviousStep()&&e.setStart(t.container(),t.offset()),t=r(e.endContainer,e.endOffset,T),t.roundToNextStep()&&e.setEnd(t.container(),t.offset())}function u(e){var t=S.getParagraphElements(e),n=t[0],t=t[t.length-1];n&&e.setStart(n,0),t&&(S.isParagraph(e.endContainer)&&0===e.endOffset?e.setEndBefore(t):e.setEnd(t,t.childNodes.length))}function c(e,t,n,o){var r,i;o?(r=n.startContainer,i=n.startOffset):(r=n.endContainer,i=n.endOffset),v.containsNode(e,r)||(i=0>v.comparePoints(e,0,r,i)?0:e.childNodes.length,r=e),e=y.createStepIterator(r,i,t,S.getParagraphElement(r)||e),e.roundToClosestStep()||runtime.assert(!1,"No step found in requested range"),o?n.setStart(e.container(),e.offset()):n.setEnd(e.container(),e.offset())}function d(e,t){var n=o();n.advanceStep(e)&&s(n.container(),n.offset(),t)}function f(e,t){var n,r=h,i=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];void 0===r&&E&&(r=E()),isNaN(r)||(n=o(),C.moveToFilteredStep(n,e,i)&&n.advanceStep(e)&&(i=[new gui.ClosestXOffsetScanner(r),new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner],C.moveToFilteredStep(n,e,i)&&(s(n.container(),n.offset(),t),h=r,b.restart())))}function p(e,t){var n=o(),r=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];C.moveToFilteredStep(n,e,r)&&s(n.container(),n.offset(),t)}function m(e,n){var o=y.getCursor(t),o=i(o.getSelectedRange(),o.hasForwardSelection()),o=r(o.focusNode,o.focusOffset,w);o.advanceStep(e)&&s(o.container(),o.offset(),n)}function g(e,n,o){var r=!1,a=y.getCursor(t),a=i(a.getSelectedRange(),a.hasForwardSelection()),r=y.getRootElement(a.focusNode);runtime.assert(Boolean(r),"SelectionController: Cursor outside root"),a=y.createStepIterator(a.focusNode,a.focusOffset,[N,x],r),a.roundToClosestStep(),a.advanceStep(e)&&(o=o(a.container()))&&(e===O?(a.setPosition(o,0),r=a.roundToNextStep()):(a.setPosition(o,o.childNodes.length),r=a.roundToPreviousStep()),r&&s(a.container(),a.offset(),n))}var h,b,y=e.getOdtDocument(),v=core.DomUtils,S=odf.OdfUtils,N=y.getPositionFilter(),C=new gui.GuiStepUtils,x=y.createRootFilter(t),E=null,w=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,T=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,O=core.StepDirection.PREVIOUS,A=core.StepDirection.NEXT;this.selectionToRange=function(e){var t=0<=v.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),n=e.focusNode.ownerDocument.createRange();return t?(n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset)):(n.setStart(e.focusNode,e.focusOffset),n.setEnd(e.anchorNode,e.anchorOffset)),{range:n,hasForwardSelection:t}},this.rangeToSelection=i,this.selectImage=function(t){var n,o=y.getRootElement(t),r=y.createRootFilter(o),o=y.createStepIterator(t,0,[r,y.getPositionFilter()],o);o.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame"),r=o.container(),n=o.offset(),o.setPosition(t,t.childNodes.length),o.roundToNextStep()||runtime.assert(!1,"No walkable position after frame"),t=y.convertDomToCursorRange({anchorNode:r,anchorOffset:n,focusNode:o.container(),focusOffset:o.offset()}),t=a(t.position,t.length,ops.OdtCursor.RegionSelection),e.enqueue([t])},this.expandToWordBoundaries=l,this.expandToParagraphBoundaries=u,this.selectRange=function(n,o,r){var s,d=y.getOdfCanvas().getElement(),f=[N];s=v.containsNode(d,n.startContainer),d=v.containsNode(d,n.endContainer),(s||d)&&(s&&d&&(2===r?l(n):r>=3&&u(n)),(r=y.getRootElement(o?n.startContainer:n.endContainer))||(r=y.getRootNode()),f.push(y.createRootFilter(r)),c(r,f,n,!0),c(r,f,n,!1),n=i(n,o),o=y.convertDomToCursorRange(n),n=y.getCursorSelection(t),(o.position!==n.position||o.length!==n.length)&&(n=a(o.position,o.length,ops.OdtCursor.RangeSelection),e.enqueue([n])))},this.moveCursorToLeft=function(){return d(O,!1),!0},this.moveCursorToRight=function(){return d(A,!1),!0},this.extendSelectionToLeft=function(){return d(O,!0),!0},this.extendSelectionToRight=function(){return d(A,!0),!0},this.setCaretXPositionLocator=function(e){E=e},this.moveCursorUp=function(){return f(O,!1),!0},this.moveCursorDown=function(){return f(A,!1),!0},this.extendSelectionUp=function(){return f(O,!0),!0},this.extendSelectionDown=function(){return f(A,!0),!0},this.moveCursorBeforeWord=function(){return m(O,!1),!0},this.moveCursorPastWord=function(){return m(A,!1),!0},this.extendSelectionBeforeWord=function(){return m(O,!0),!0},this.extendSelectionPastWord=function(){return m(A,!0),!0},this.moveCursorToLineStart=function(){return p(O,!1),!0},this.moveCursorToLineEnd=function(){return p(A,!1),!0},this.extendSelectionToLineStart=function(){return p(O,!0),!0},this.extendSelectionToLineEnd=function(){return p(A,!0),!0},this.extendSelectionToParagraphStart=function(){return g(O,!0,S.getParagraphElement),!0},this.extendSelectionToParagraphEnd=function(){return g(A,!0,S.getParagraphElement),!0},this.moveCursorToParagraphStart=function(){return g(O,!1,S.getParagraphElement),!0},this.moveCursorToParagraphEnd=function(){return g(A,!1,S.getParagraphElement),!0},this.moveCursorToDocumentStart=function(){return g(O,!1,y.getRootElement),!0},this.moveCursorToDocumentEnd=function(){return g(A,!1,y.getRootElement),!0},this.extendSelectionToDocumentStart=function(){return g(O,!0,y.getRootElement),!0},this.extendSelectionToDocumentEnd=function(){return g(A,!0,y.getRootElement),!0},this.extendSelectionToEntireDocument=function(){var n,o,r,i=y.getCursor(t),i=y.getRootElement(i.getNode());return runtime.assert(Boolean(i),"SelectionController: Cursor outside root"),r=y.createStepIterator(i,0,[N,x],i),r.roundToClosestStep(),n=r.container(),o=r.offset(),r.setPosition(i,i.childNodes.length),r.roundToClosestStep(),i=y.convertDomToCursorRange({anchorNode:n,anchorOffset:o,focusNode:r.container(),focusOffset:r.offset()}),e.enqueue([a(i.position,i.length)]),!0},this.destroy=function(e){y.unsubscribe(ops.OdtDocument.signalOperationStart,n),core.Async.destroyAll([b.destroy],e)},function(){b=core.Task.createTimeoutTask(function(){h=void 0},2e3),y.subscribe(ops.OdtDocument.signalOperationStart,n)}()},gui.TextController=function(e,t,n,o,r,i){function a(){g=!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?n.isLocalCursorWithinOwnAnnotation():!0}function s(e){e.getMemberId()===o&&a()}function l(e,t,n){var o=[f.getPositionFilter()];return n&&o.push(f.createRootFilter(e.startContainer)),n=f.createStepIterator(e.startContainer,e.startOffset,o,t),n.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start"),t=f.convertDomPointToCursorStep(n.container(),n.offset()),e.collapsed?e=t:(n.setPosition(e.endContainer,e.endOffset),n.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),e=f.convertDomPointToCursorStep(n.container(),n.offset())),{position:t,length:e-t}}function u(e){var t,n,r,i=p.getParagraphElements(e),a=e.cloneRange(),s=[];return t=i[0],1<i.length&&(p.hasNoODFContent(t)&&(t=i[i.length-1]),n=t.getAttributeNS(odf.Namespaces.textns,"style-name")||""),i.forEach(function(t,i){var u,c;a.setStart(t,0),a.collapse(!0),u=l(a,t,!1).position,i>0&&(c=new ops.OpMergeParagraph,c.init({memberid:o,paragraphStyleName:n,destinationStartPosition:r,sourceStartPosition:u,moveCursor:1===i}),s.unshift(c)),r=u,a.selectNodeContents(t),(u=m.rangeIntersection(a,e))&&(u=l(u,t,!0),0<u.length&&(c=new ops.OpRemoveText,c.init({memberid:o,position:u.position,length:u.length}),s.unshift(c)))}),s}function c(e){return 0>e.length&&(e.position+=e.length,e.length=-e.length),e}function d(t){if(!g)return!1;var n,r,i=f.getCursor(o).getSelectedRange().cloneRange(),a=c(f.getCursorSelection(o));if(0===a.length){a=void 0,n=f.getCursor(o).getNode(),r=f.getRootElement(n);var s=[f.getPositionFilter(),f.createRootFilter(r)];r=f.createStepIterator(n,0,s,r),r.roundToClosestStep()&&(t?r.nextStep():r.previousStep())&&(a=c(f.convertDomToCursorRange({anchorNode:n,anchorOffset:0,focusNode:r.container(),focusOffset:r.offset()})),t?(i.setStart(n,0),i.setEnd(r.container(),r.offset())):(i.setStart(r.container(),r.offset()),i.setEnd(n,0)))}return a&&e.enqueue(u(i)),void 0!==a}var f=e.getOdtDocument(),p=odf.OdfUtils,m=core.DomUtils,g=!1,h=odf.Namespaces.textns,b=core.StepDirection.NEXT;this.isEnabled=function(){return g},this.enqueueParagraphSplittingOps=function(){if(!g)return!1;var t=f.getCursor(o),n=t.getSelectedRange(),r=c(f.getCursorSelection(o)),a=[],t=p.getParagraphElement(t.getNode()),s=t.getAttributeNS(h,"style-name")||"";return 0<r.length&&(a=a.concat(u(n))),n=new ops.OpSplitParagraph,n.init({memberid:o,position:r.position,paragraphStyleName:s,sourceParagraphPosition:f.convertDomPointToCursorStep(t,0,b),moveCursor:!0}),a.push(n),i&&(r=i(r.position+1),a=a.concat(r)),e.enqueue(a),!0},this.removeTextByBackspaceKey=function(){return d(!1)},this.removeTextByDeleteKey=function(){return d(!0)},this.removeCurrentSelection=function(){if(!g)return!1;var t=f.getCursor(o).getSelectedRange();return e.enqueue(u(t)),!0},this.insertText=function(t){if(g){var n=f.getCursor(o).getSelectedRange(),i=c(f.getCursorSelection(o)),a=[],s=!1;0<i.length&&(a=a.concat(u(n)),s=!0),n=new ops.OpInsertText,n.init({memberid:o,position:i.position,text:t,moveCursor:!0}),a.push(n),r&&(t=r(i.position,t.length,s))&&a.push(t),e.enqueue(a)}},this.destroy=function(e){f.unsubscribe(ops.Document.signalCursorMoved,s),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a),e()},f.subscribe(ops.Document.signalCursorMoved,s),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a),a()},gui.UndoManager=function(){},gui.UndoManager.prototype.subscribe=function(){},gui.UndoManager.prototype.unsubscribe=function(){},gui.UndoManager.prototype.setDocument=function(){},gui.UndoManager.prototype.setInitialState=function(){},gui.UndoManager.prototype.initialize=function(){},gui.UndoManager.prototype.purgeInitialState=function(){},gui.UndoManager.prototype.setPlaybackFunction=function(){},gui.UndoManager.prototype.hasUndoStates=function(){},gui.UndoManager.prototype.hasRedoStates=function(){},gui.UndoManager.prototype.moveForward=function(){},gui.UndoManager.prototype.moveBackward=function(){},gui.UndoManager.prototype.onOperationExecuted=function(){},gui.UndoManager.signalUndoStackChanged="undoStackChanged",gui.UndoManager.signalUndoStateCreated="undoStateCreated",gui.UndoManager.signalUndoStateModified="undoStateModified",gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1},function(){var e=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(t,n,o,r){function i(e){return e.target||e.srcElement||null}function a(e,t){var n=B.getDOMDocument(),o=null;return n.caretRangeFromPoint?(n=n.caretRangeFromPoint(e,t),o={container:n.startContainer,offset:n.startOffset}):n.caretPositionFromPoint&&(n=n.caretPositionFromPoint(e,t))&&n.offsetNode&&(o={container:n.offsetNode,offset:n.offset}),o}function s(e){var t=B.getCursor(n).getSelectedRange();t.collapsed?e.preventDefault():j.setDataFromRange(e,t)?nt.removeCurrentSelection():runtime.log("Cut operation failed")}function l(){return!1!==B.getCursor(n).getSelectedRange().collapsed}function u(e){var t=B.getCursor(n).getSelectedRange();t.collapsed?e.preventDefault():j.setDataFromRange(e,t)||runtime.log("Copy operation failed")}function c(e){var t;U.clipboardData&&U.clipboardData.getData?t=U.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(t=e.clipboardData.getData("text/plain")),t&&(nt.removeCurrentSelection(),at.paste(t)),e.preventDefault?e.preventDefault():e.returnValue=!1}function d(){return!1}function f(e){Y&&Y.onOperationExecuted(e)}function p(e){B.emit(ops.OdtDocument.signalUndoStackChanged,e)}function m(){var e;return Y?(e=Q.hasFocus(),Y.moveBackward(1),e&&Q.focus(),!0):!1}function g(){var e;return Y?(e=Q.hasFocus(),Y.moveForward(1),e&&Q.focus(),!0):!1}function h(t){var r=B.getCursor(n).getSelectedRange(),s=i(t).getAttribute("end");r&&s&&(t=a(t.clientX,t.clientY))&&(it.setUnfilteredPosition(t.container,t.offset),G.acceptPosition(it)===e&&(r=r.cloneRange(),"left"===s?r.setStart(it.container(),it.unfilteredDomOffset()):r.setEnd(it.container(),it.unfilteredDomOffset()),o.setSelectedRange(r,"right"===s),B.emit(ops.Document.signalCursorMoved,o)))}function b(){dt.selectRange(o.getSelectedRange(),o.hasForwardSelection(),1)}function y(){var t=U.getSelection(),n=0<t.rangeCount&&dt.selectionToRange(t);q&&n&&(J=!0,rt.clearSelection(),it.setUnfilteredPosition(t.focusNode,t.focusOffset),G.acceptPosition(it)===e&&(2===lt?dt.expandToWordBoundaries(n.range):lt>=3&&dt.expandToParagraphBoundaries(n.range),o.setSelectedRange(n.range,n.hasForwardSelection),B.emit(ops.Document.signalCursorMoved,o)))}function v(e){var t=i(e),o=B.getCursor(n);(q=null!==t&&H.containsNode(B.getOdfCanvas().getElement(),t))&&(J=!1,t=B.getRootElement(t)||B.getRootNode(),G=B.createRootFilter(t),lt=0===e.button?e.detail:0,o&&e.shiftKey?U.getSelection().collapse(o.getAnchorNode(),0):(e=U.getSelection(),t=o.getSelectedRange(),e.extend?o.hasForwardSelection()?(e.collapse(t.startContainer,t.startOffset),e.extend(t.endContainer,t.endOffset)):(e.collapse(t.endContainer,t.endOffset),e.extend(t.startContainer,t.startOffset)):(e.removeAllRanges(),e.addRange(t.cloneRange()))),lt>1&&y())}function S(e){var t=B.getRootElement(e),n=B.createRootFilter(t),t=B.createStepIterator(e,0,[n,B.getPositionFilter()],t);return t.setPosition(e,e.childNodes.length),t.roundToNextStep()?{container:t.container(),offset:t.offset()}:null}function N(e){var t;t=(t=U.getSelection())?{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}:null;var n,o,r=U.getSelection().isCollapsed;t.anchorNode||t.focusNode||!(n=a(e.clientX,e.clientY))||(t.anchorNode=n.container,t.anchorOffset=n.offset,t.focusNode=t.anchorNode,t.focusOffset=t.anchorOffset),z.isImage(t.focusNode)&&0===t.focusOffset&&z.isCharacterFrame(t.focusNode.parentNode)?(o=t.focusNode.parentNode,n=o.getBoundingClientRect(),e.clientX>n.left&&(n=S(o))&&(t.focusNode=n.container,t.focusOffset=n.offset,r&&(t.anchorNode=t.focusNode,t.anchorOffset=t.focusOffset))):z.isImage(t.focusNode.firstChild)&&1===t.focusOffset&&z.isCharacterFrame(t.focusNode)&&(n=S(t.focusNode))&&(t.anchorNode=t.focusNode=n.container,t.anchorOffset=t.focusOffset=n.offset),t.anchorNode&&t.focusNode&&(t=dt.selectionToRange(t),dt.selectRange(t.range,t.hasForwardSelection,0===e.button?e.detail:0)),Q.focus()}function C(e){var t;(t=a(e.clientX,e.clientY))&&(e=t.container,t=t.offset,e={anchorNode:e,anchorOffset:t,focusNode:e,focusOffset:t},e=dt.selectionToRange(e),dt.selectRange(e.range,e.hasForwardSelection,2),Q.focus())}function x(e){var t,n,r,a=i(e);I.processRequests(),q&&(z.isImage(a)&&z.isCharacterFrame(a.parentNode)&&U.getSelection().isCollapsed?(dt.selectImage(a.parentNode),Q.focus()):rt.isSelectorElement(a)?Q.focus():J?(a=o.getSelectedRange(),n=a.collapsed,z.isImage(a.endContainer)&&0===a.endOffset&&z.isCharacterFrame(a.endContainer.parentNode)&&(r=a.endContainer.parentNode,r=S(r))&&(a.setEnd(r.container,r.offset),n&&a.collapse(!1)),dt.selectRange(a,o.hasForwardSelection(),0===e.button?e.detail:0),Q.focus()):ht?N(e):(t=H.cloneEvent(e),k=runtime.setTimeout(function(){N(t)},0)),lt=0,J=q=!1)}function E(e){var t=B.getCursor(n).getSelectedRange();t.collapsed||W.exportRangeToDataTransfer(e.dataTransfer,t)}function w(){q&&Q.focus(),lt=0,J=q=!1}function T(e){x(e)}function O(e){var t=i(e),n=null;"annotationRemoveButton"===t.className?(runtime.assert($,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),n=t.parentNode.getElementsByTagNameNS(odf.Namespaces.officens,"annotation").item(0),et.removeAnnotation(n),Q.focus()):"webodf-draggable"!==t.getAttribute("class")&&x(e)}function A(e){(e=e.data)&&(-1===e.indexOf("\n")?nt.insertText(e):at.paste(e))}function R(e){return function(){return e(),!0}}function P(e){return function(t){return B.getCursor(n).getSelectionType()===ops.OdtCursor.RangeSelection?e(t):!0}}function D(e){Q.unsubscribe("keydown",X.handleEvent),Q.unsubscribe("keypress",V.handleEvent),Q.unsubscribe("keyup",Z.handleEvent),Q.unsubscribe("copy",u),Q.unsubscribe("mousedown",v),Q.unsubscribe("mousemove",I.trigger),Q.unsubscribe("mouseup",O),Q.unsubscribe("contextmenu",T),Q.unsubscribe("dragstart",E),Q.unsubscribe("dragend",w),Q.unsubscribe("click",ut.handleClick),Q.unsubscribe("longpress",C),Q.unsubscribe("drag",h),Q.unsubscribe("dragstop",b),B.unsubscribe(ops.OdtDocument.signalOperationEnd,F.trigger),B.unsubscribe(ops.Document.signalCursorAdded,st.registerCursor),B.unsubscribe(ops.Document.signalCursorRemoved,st.removeCursor),B.unsubscribe(ops.OdtDocument.signalOperationEnd,f),e()}var k,I,F,M,U=runtime.getWindow(),B=t.getOdtDocument(),L=new gui.SessionConstraints,_=new gui.SessionContext(t,n),H=core.DomUtils,z=odf.OdfUtils,W=new gui.MimeDataExporter,j=new gui.Clipboard(W),X=new gui.KeyboardHandler,V=new gui.KeyboardHandler,Z=new gui.KeyboardHandler,q=!1,K=new odf.ObjectNameGenerator(B.getOdfCanvas().odfContainer(),n),J=!1,G=null,Y=null,Q=new gui.EventManager(B),$=r.annotationsEnabled,et=new gui.AnnotationController(t,L,n),tt=new gui.DirectFormattingController(t,L,_,n,K,r.directTextStylingEnabled,r.directParagraphStylingEnabled),nt=new gui.TextController(t,L,_,n,tt.createCursorStyleOp,tt.createParagraphStyleOps),ot=new gui.ImageController(t,L,_,n,K),rt=new gui.ImageSelector(B.getOdfCanvas()),it=B.createPositionIterator(B.getRootNode()),at=new gui.PasteController(t,L,_,n),st=new gui.InputMethodEditor(n,Q),lt=0,ut=new gui.HyperlinkClickHandler(B.getOdfCanvas().getElement,X,Z),ct=new gui.HyperlinkController(t,L,_,n),dt=new gui.SelectionController(t,n),ft=new gui.MetadataController(t,n),pt=gui.KeyboardHandler.Modifier,mt=gui.KeyboardHandler.KeyCode,gt=-1!==U.navigator.appVersion.toLowerCase().indexOf("mac"),ht=-1!==["iPad","iPod","iPhone"].indexOf(U.navigator.platform);runtime.assert(null!==U,"Expected to be run in an environment which has a global window, like a browser."),this.undo=m,this.redo=g,this.insertLocalCursor=function(){runtime.assert(void 0===t.getOdtDocument().getCursor(n),"Inserting local cursor a second time.");var e=new ops.OpAddCursor;e.init({memberid:n}),t.enqueue([e]),Q.focus()},this.removeLocalCursor=function(){runtime.assert(void 0!==t.getOdtDocument().getCursor(n),"Removing local cursor without inserting before.");var e=new ops.OpRemoveCursor;e.init({memberid:n}),t.enqueue([e])},this.startEditing=function(){st.subscribe(gui.InputMethodEditor.signalCompositionStart,nt.removeCurrentSelection),st.subscribe(gui.InputMethodEditor.signalCompositionEnd,A),Q.subscribe("beforecut",l),Q.subscribe("cut",s),Q.subscribe("beforepaste",d),Q.subscribe("paste",c),Y&&Y.initialize(),Q.setEditing(!0),ut.setModifier(gt?pt.Meta:pt.Ctrl),X.bind(mt.Backspace,pt.None,R(nt.removeTextByBackspaceKey),!0),X.bind(mt.Delete,pt.None,nt.removeTextByDeleteKey),X.bind(mt.Tab,pt.None,P(function(){return nt.insertText("	"),!0
})),gt?(X.bind(mt.Clear,pt.None,nt.removeCurrentSelection),X.bind(mt.B,pt.Meta,P(tt.toggleBold)),X.bind(mt.I,pt.Meta,P(tt.toggleItalic)),X.bind(mt.U,pt.Meta,P(tt.toggleUnderline)),X.bind(mt.L,pt.MetaShift,P(tt.alignParagraphLeft)),X.bind(mt.E,pt.MetaShift,P(tt.alignParagraphCenter)),X.bind(mt.R,pt.MetaShift,P(tt.alignParagraphRight)),X.bind(mt.J,pt.MetaShift,P(tt.alignParagraphJustified)),$&&X.bind(mt.C,pt.MetaShift,et.addAnnotation),X.bind(mt.Z,pt.Meta,m),X.bind(mt.Z,pt.MetaShift,g)):(X.bind(mt.B,pt.Ctrl,P(tt.toggleBold)),X.bind(mt.I,pt.Ctrl,P(tt.toggleItalic)),X.bind(mt.U,pt.Ctrl,P(tt.toggleUnderline)),X.bind(mt.L,pt.CtrlShift,P(tt.alignParagraphLeft)),X.bind(mt.E,pt.CtrlShift,P(tt.alignParagraphCenter)),X.bind(mt.R,pt.CtrlShift,P(tt.alignParagraphRight)),X.bind(mt.J,pt.CtrlShift,P(tt.alignParagraphJustified)),$&&X.bind(mt.C,pt.CtrlAlt,et.addAnnotation),X.bind(mt.Z,pt.Ctrl,m),X.bind(mt.Z,pt.CtrlShift,g)),V.setDefault(P(function(e){var t;return t=null===e.which||void 0===e.which?String.fromCharCode(e.keyCode):0!==e.which&&0!==e.charCode?String.fromCharCode(e.which):null,!t||e.altKey||e.ctrlKey||e.metaKey?!1:(nt.insertText(t),!0)})),V.bind(mt.Enter,pt.None,P(nt.enqueueParagraphSplittingOps))},this.endEditing=function(){st.unsubscribe(gui.InputMethodEditor.signalCompositionStart,nt.removeCurrentSelection),st.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,A),Q.unsubscribe("cut",s),Q.unsubscribe("beforecut",l),Q.unsubscribe("paste",c),Q.unsubscribe("beforepaste",d),Q.setEditing(!1),ut.setModifier(pt.None),X.bind(mt.Backspace,pt.None,function(){return!0},!0),X.unbind(mt.Delete,pt.None),X.unbind(mt.Tab,pt.None),gt?(X.unbind(mt.Clear,pt.None),X.unbind(mt.B,pt.Meta),X.unbind(mt.I,pt.Meta),X.unbind(mt.U,pt.Meta),X.unbind(mt.L,pt.MetaShift),X.unbind(mt.E,pt.MetaShift),X.unbind(mt.R,pt.MetaShift),X.unbind(mt.J,pt.MetaShift),$&&X.unbind(mt.C,pt.MetaShift),X.unbind(mt.Z,pt.Meta),X.unbind(mt.Z,pt.MetaShift)):(X.unbind(mt.B,pt.Ctrl),X.unbind(mt.I,pt.Ctrl),X.unbind(mt.U,pt.Ctrl),X.unbind(mt.L,pt.CtrlShift),X.unbind(mt.E,pt.CtrlShift),X.unbind(mt.R,pt.CtrlShift),X.unbind(mt.J,pt.CtrlShift),$&&X.unbind(mt.C,pt.CtrlAlt),X.unbind(mt.Z,pt.Ctrl),X.unbind(mt.Z,pt.CtrlShift)),V.setDefault(null),V.unbind(mt.Enter,pt.None)},this.getInputMemberId=function(){return n},this.getSession=function(){return t},this.getSessionConstraints=function(){return L},this.setUndoManager=function(e){Y&&Y.unsubscribe(gui.UndoManager.signalUndoStackChanged,p),(Y=e)&&(Y.setDocument(B),Y.setPlaybackFunction(t.enqueue),Y.subscribe(gui.UndoManager.signalUndoStackChanged,p))},this.getUndoManager=function(){return Y},this.getMetadataController=function(){return ft},this.getAnnotationController=function(){return et},this.getDirectFormattingController=function(){return tt},this.getHyperlinkClickHandler=function(){return ut},this.getHyperlinkController=function(){return ct},this.getImageController=function(){return ot},this.getSelectionController=function(){return dt},this.getTextController=function(){return nt},this.getEventManager=function(){return Q},this.getKeyboardHandlers=function(){return{keydown:X,keypress:V}},this.destroy=function(e){var t=[I.destroy,F.destroy,tt.destroy,st.destroy,Q.destroy,ut.destroy,ct.destroy,ft.destroy,dt.destroy,nt.destroy,D];M&&t.unshift(M.destroy),runtime.clearTimeout(k),core.Async.destroyAll(t,e)},I=core.Task.createRedrawTask(y),F=core.Task.createRedrawTask(function(){var e=B.getCursor(n);return e&&e.getSelectionType()===ops.OdtCursor.RegionSelection&&(e=z.getImageElements(e.getSelectedRange())[0])?void rt.select(e.parentNode):void rt.clearSelection()}),X.bind(mt.Left,pt.None,P(dt.moveCursorToLeft)),X.bind(mt.Right,pt.None,P(dt.moveCursorToRight)),X.bind(mt.Up,pt.None,P(dt.moveCursorUp)),X.bind(mt.Down,pt.None,P(dt.moveCursorDown)),X.bind(mt.Left,pt.Shift,P(dt.extendSelectionToLeft)),X.bind(mt.Right,pt.Shift,P(dt.extendSelectionToRight)),X.bind(mt.Up,pt.Shift,P(dt.extendSelectionUp)),X.bind(mt.Down,pt.Shift,P(dt.extendSelectionDown)),X.bind(mt.Home,pt.None,P(dt.moveCursorToLineStart)),X.bind(mt.End,pt.None,P(dt.moveCursorToLineEnd)),X.bind(mt.Home,pt.Ctrl,P(dt.moveCursorToDocumentStart)),X.bind(mt.End,pt.Ctrl,P(dt.moveCursorToDocumentEnd)),X.bind(mt.Home,pt.Shift,P(dt.extendSelectionToLineStart)),X.bind(mt.End,pt.Shift,P(dt.extendSelectionToLineEnd)),X.bind(mt.Up,pt.CtrlShift,P(dt.extendSelectionToParagraphStart)),X.bind(mt.Down,pt.CtrlShift,P(dt.extendSelectionToParagraphEnd)),X.bind(mt.Home,pt.CtrlShift,P(dt.extendSelectionToDocumentStart)),X.bind(mt.End,pt.CtrlShift,P(dt.extendSelectionToDocumentEnd)),gt?(X.bind(mt.Left,pt.Alt,P(dt.moveCursorBeforeWord)),X.bind(mt.Right,pt.Alt,P(dt.moveCursorPastWord)),X.bind(mt.Left,pt.Meta,P(dt.moveCursorToLineStart)),X.bind(mt.Right,pt.Meta,P(dt.moveCursorToLineEnd)),X.bind(mt.Home,pt.Meta,P(dt.moveCursorToDocumentStart)),X.bind(mt.End,pt.Meta,P(dt.moveCursorToDocumentEnd)),X.bind(mt.Left,pt.AltShift,P(dt.extendSelectionBeforeWord)),X.bind(mt.Right,pt.AltShift,P(dt.extendSelectionPastWord)),X.bind(mt.Left,pt.MetaShift,P(dt.extendSelectionToLineStart)),X.bind(mt.Right,pt.MetaShift,P(dt.extendSelectionToLineEnd)),X.bind(mt.Up,pt.AltShift,P(dt.extendSelectionToParagraphStart)),X.bind(mt.Down,pt.AltShift,P(dt.extendSelectionToParagraphEnd)),X.bind(mt.Up,pt.MetaShift,P(dt.extendSelectionToDocumentStart)),X.bind(mt.Down,pt.MetaShift,P(dt.extendSelectionToDocumentEnd)),X.bind(mt.A,pt.Meta,P(dt.extendSelectionToEntireDocument))):(X.bind(mt.Left,pt.Ctrl,P(dt.moveCursorBeforeWord)),X.bind(mt.Right,pt.Ctrl,P(dt.moveCursorPastWord)),X.bind(mt.Left,pt.CtrlShift,P(dt.extendSelectionBeforeWord)),X.bind(mt.Right,pt.CtrlShift,P(dt.extendSelectionPastWord)),X.bind(mt.A,pt.Ctrl,P(dt.extendSelectionToEntireDocument))),ht&&(M=new gui.IOSSafariSupport(Q)),Q.subscribe("keydown",X.handleEvent),Q.subscribe("keypress",V.handleEvent),Q.subscribe("keyup",Z.handleEvent),Q.subscribe("copy",u),Q.subscribe("mousedown",v),Q.subscribe("mousemove",I.trigger),Q.subscribe("mouseup",O),Q.subscribe("contextmenu",T),Q.subscribe("dragstart",E),Q.subscribe("dragend",w),Q.subscribe("click",ut.handleClick),Q.subscribe("longpress",C),Q.subscribe("drag",h),Q.subscribe("dragstop",b),B.subscribe(ops.OdtDocument.signalOperationEnd,F.trigger),B.subscribe(ops.Document.signalCursorAdded,st.registerCursor),B.subscribe(ops.Document.signalCursorRemoved,st.removeCursor),B.subscribe(ops.OdtDocument.signalOperationEnd,f)}}(),gui.CaretManager=function(e,t){function n(e){return i.hasOwnProperty(e)?i[e]:null}function o(){return Object.keys(i).map(function(e){return i[e]})}function r(t){var n=i[t];n&&(delete i[t],t===e.getInputMemberId()?(s.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,n.ensureVisible),s.unsubscribe(ops.Document.signalCursorMoved,n.refreshCursorBlinking),l.unsubscribe("compositionupdate",n.handleUpdate),l.unsubscribe("compositionend",n.handleUpdate),l.unsubscribe("focus",n.setFocus),l.unsubscribe("blur",n.removeFocus),a.removeEventListener("focus",n.show,!1),a.removeEventListener("blur",n.hide,!1)):s.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,n.handleUpdate),n.destroy(function(){}))}var i={},a=runtime.getWindow(),s=e.getSession().getOdtDocument(),l=e.getEventManager();this.registerCursor=function(n,o,r){var u=n.getMemberId();return n=new gui.Caret(n,t,o,r),i[u]=n,u===e.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+u),s.subscribe(ops.OdtDocument.signalProcessingBatchEnd,n.ensureVisible),s.subscribe(ops.Document.signalCursorMoved,n.refreshCursorBlinking),l.subscribe("compositionupdate",n.handleUpdate),l.subscribe("compositionend",n.handleUpdate),l.subscribe("focus",n.setFocus),l.subscribe("blur",n.removeFocus),a.addEventListener("focus",n.show,!1),a.addEventListener("blur",n.hide,!1),n.setOverlayElement(l.getEventTrap())):s.subscribe(ops.OdtDocument.signalProcessingBatchEnd,n.handleUpdate),n},this.getCaret=n,this.getCarets=o,this.destroy=function(t){var n=o().map(function(e){return e.destroy});e.getSelectionController().setCaretXPositionLocator(null),s.unsubscribe(ops.Document.signalCursorRemoved,r),i={},core.Async.destroyAll(n,t)},e.getSelectionController().setCaretXPositionLocator(function(){var t,o=n(e.getInputMemberId());return o&&(t=o.getBoundingClientRect()),t?t.right:void 0}),s.subscribe(ops.Document.signalCursorRemoved,r)},gui.EditInfoHandle=function(e){var t,n=[],o=e.ownerDocument,r=o.documentElement.namespaceURI;this.setEdits=function(e){n=e;var i,a,s,l;for(t.innerHTML="",e=0;e<n.length;e+=1)i=o.createElementNS(r,"div"),i.className="editInfo",a=o.createElementNS(r,"span"),a.className="editInfoColor",a.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),s=o.createElementNS(r,"span"),s.className="editInfoAuthor",s.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),l=o.createElementNS(r,"span"),l.className="editInfoTime",l.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),l.innerHTML=n[e].time,i.appendChild(a),i.appendChild(s),i.appendChild(l),t.appendChild(i)},this.show=function(){t.style.display="block"},this.hide=function(){t.style.display="none"},this.destroy=function(n){e.removeChild(t),n()},t=o.createElementNS(r,"div"),t.setAttribute("class","editInfoHandle"),t.style.display="none",e.appendChild(t)},ops.EditInfo=function(e,t){function n(){var e,t=[];for(e in r)r.hasOwnProperty(e)&&t.push({memberid:e,time:r[e].time});return t.sort(function(e,t){return e.time-t.time}),t}var o,r={};this.getNode=function(){return o},this.getOdtDocument=function(){return t},this.getEdits=function(){return r},this.getSortedEdits=function(){return n()},this.addEdit=function(e,t){r[e]={time:t}},this.clearEdits=function(){r={}},this.destroy=function(t){e.parentNode&&e.removeChild(o),t()},o=t.getDOMDocument().createElementNS("urn:webodf:names:editinfo","editinfo"),e.insertBefore(o,e.firstChild)},gui.EditInfoMarker=function(e,t){function n(e,t){return runtime.setTimeout(function(){i.style.opacity=e},t)}var o,r,i,a,s,l,u=this;this.addEdit=function(t,o){var u=Date.now()-o;e.addEdit(t,o),r.setEdits(e.getSortedEdits()),i.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",t),runtime.clearTimeout(s),runtime.clearTimeout(l),1e4>u?(a=n(1,0),s=n(.5,1e4-u),l=n(.2,2e4-u)):u>=1e4&&2e4>u?(a=n(.5,0),l=n(.2,2e4-u)):a=n(.2,0)},this.getEdits=function(){return e.getEdits()},this.clearEdits=function(){e.clearEdits(),r.setEdits([]),i.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&i.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")},this.getEditInfo=function(){return e},this.show=function(){i.style.display="block"},this.hide=function(){u.hideHandle(),i.style.display="none"},this.showHandle=function(){r.show()},this.hideHandle=function(){r.hide()},this.destroy=function(t){runtime.clearTimeout(a),runtime.clearTimeout(s),runtime.clearTimeout(l),o.removeChild(i),r.destroy(function(n){n?t(n):e.destroy(t)})},function(){var n=e.getOdtDocument().getDOMDocument();i=n.createElementNS(n.documentElement.namespaceURI,"div"),i.setAttribute("class","editInfoMarker"),i.onmouseover=function(){u.showHandle()},i.onmouseout=function(){u.hideHandle()},o=e.getNode(),o.appendChild(i),r=new gui.EditInfoHandle(o),t||u.hide()}()},gui.HyperlinkTooltipView=function(e,t){var n,o,r,i=core.DomUtils,a=odf.OdfUtils,s=runtime.getWindow();runtime.assert(null!==s,"Expected to be run in an environment which has a global window, like a browser."),this.showTooltip=function(l){var u,c=l.target||l.srcElement,d=e.getSizer(),f=e.getZoomLevel();e:{for(;c;){if(a.isHyperlink(c))break e;if(a.isParagraph(c)||a.isInlineRoot(c))break;c=c.parentNode}c=null}if(c){i.containsNode(d,r)||d.appendChild(r),u=o;var p;switch(t()){case gui.KeyboardHandler.Modifier.Ctrl:p=runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:p=runtime.tr("⌘-click to follow link");break;default:p=""}u.textContent=p,n.textContent=a.getHyperlinkTarget(c),r.style.display="block",u=s.innerWidth-r.offsetWidth-15,c=l.clientX>u?u:l.clientX+15,u=s.innerHeight-r.offsetHeight-10,l=l.clientY>u?u:l.clientY+10,d=d.getBoundingClientRect(),c=(c-d.left)/f,l=(l-d.top)/f,r.style.left=c+"px",r.style.top=l+"px"}},this.hideTooltip=function(){r.style.display="none"},this.destroy=function(e){r.parentNode&&r.parentNode.removeChild(r),e()},function(){var t=e.getElement().ownerDocument;n=t.createElement("span"),o=t.createElement("span"),n.className="webodf-hyperlinkTooltipLink",o.className="webodf-hyperlinkTooltipText",r=t.createElement("div"),r.className="webodf-hyperlinkTooltip",r.appendChild(n),r.appendChild(o),e.getElement().appendChild(r)}()},gui.OdfFieldView=function(e){function t(){var e=odf.OdfSchema.getFields().map(function(e){return e.replace(":","|")}),t=e.join(",\n")+"\n{ background-color: #D0D0D0; }\n",e=e.map(function(e){return e+":empty::after"}).join(",\n")+"\n{ content:' '; white-space: pre; }\n";return t+"\n"+e}var n,o=e.getElement().ownerDocument;this.showFieldHighlight=function(){n.appendChild(o.createTextNode(t()))},this.hideFieldHighlight=function(){for(var e=n.sheet,t=e.cssRules;t.length;)e.deleteRule(t.length-1)},this.destroy=function(e){n.parentNode&&n.parentNode.removeChild(n),e()},n=function(){var e=o.getElementsByTagName("head").item(0),t=o.createElement("style"),n="";return t.type="text/css",t.media="screen, print, handheld, projection",odf.Namespaces.forEachPrefix(function(e,t){n+="@namespace "+e+" url("+t+");\n"}),t.appendChild(o.createTextNode(n)),e.appendChild(t),t}()},gui.ShadowCursor=function(e){var t=e.getDOMDocument().createRange(),n=!0;this.removeFromDocument=function(){},this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId},this.getSelectedRange=function(){return t},this.setSelectedRange=function(e,o){t=e,n=!1!==o},this.hasForwardSelection=function(){return n},this.getDocument=function(){return e},this.getSelectionType=function(){return ops.OdtCursor.RangeSelection},t.setStart(e.getRootNode(),0)},gui.ShadowCursor.ShadowCursorMemberId="",gui.SelectionView=function(){},gui.SelectionView.prototype.rerender=function(){},gui.SelectionView.prototype.show=function(){},gui.SelectionView.prototype.hide=function(){},gui.SelectionView.prototype.destroy=function(){},gui.SelectionViewManager=function(e){function t(){return Object.keys(n).map(function(e){return n[e]})}var n={};this.getSelectionView=function(e){return n.hasOwnProperty(e)?n[e]:null},this.getSelectionViews=t,this.removeSelectionView=function(e){n.hasOwnProperty(e)&&(n[e].destroy(function(){}),delete n[e])},this.hideSelectionView=function(e){n.hasOwnProperty(e)&&n[e].hide()},this.showSelectionView=function(e){n.hasOwnProperty(e)&&n[e].show()},this.rerenderSelectionViews=function(){Object.keys(n).forEach(function(e){n[e].rerender()})},this.registerCursor=function(t,o){var r=t.getMemberId(),i=new e(t);return o?i.show():i.hide(),n[r]=i},this.destroy=function(e){function n(t,r){r?e(r):t<o.length?o[t].destroy(function(e){n(t+1,e)}):e()}var o=t();n(0,void 0)}},gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0},function(){gui.SessionView=function(e,t,n,o,r,i){function a(e){e.memberId===t&&N.getViewport().scrollIntoView(e.annotation.getBoundingClientRect())}function s(){var e=document.getElementsByTagName("head").item(0),t=document.createElement("style");return t.type="text/css",t.media="screen, print, handheld, projection",e.appendChild(t),t}function l(e,n,o){function r(t,n,o){n=t+'[editinfo|memberid="'+e+'"]'+o+n;e:{var r=y.firstChild;for(t=t+'[editinfo|memberid="'+e+'"]'+o+"{";r;){if(r.nodeType===Node.TEXT_NODE&&0===r.data.indexOf(t)){t=r;break e}r=r.nextSibling}t=null}t?t.data=n:y.appendChild(document.createTextNode(n))}r("div.editInfoMarker","{ background-color: "+o+"; }",""),r("span.editInfoColor","{ background-color: "+o+"; }",""),r("span.editInfoAuthor",'{ content: "'+n+'"; }',":before"),r("dc|creator","{ background-color: "+o+"; }",""),r(".webodf-selectionOverlay","{ fill: "+o+"; stroke: "+o+";}",""),e===t&&(r(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"),e=gui.ShadowCursor.ShadowCursorMemberId,r(".webodf-selectionOverlay","{ fill: "+o+"; stroke: "+o+";}",""),r(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"))}function u(e){var t,n;for(n in E)E.hasOwnProperty(n)&&(t=E[n],e?t.show():t.hide())}function c(e){r.getCarets().forEach(function(t){e?t.showHandle():t.hideHandle()})}function d(e){var t=e.getMemberId();e=e.getProperties(),l(t,e.fullName,e.color)}function f(e){var t=e.getMemberId(),o=n.getOdtDocument().getMember(t).getProperties();r.registerCursor(e,T,O),i.registerCursor(e,!0),(e=r.getCaret(t))&&(e.setAvatarImageUrl(o.imageUrl),e.setColor(o.color)),runtime.log("+++ View here +++ eagerly created an Caret for '"+t+"'! +++")}function p(e){e=e.getMemberId();var n=i.getSelectionView(t),o=i.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),a=r.getCaret(t);e===t?(o.hide(),n&&n.show(),a&&a.show()):e===gui.ShadowCursor.ShadowCursorMemberId&&(o.show(),n&&n.hide(),a&&a.hide())}function m(e){i.removeSelectionView(e)}function g(e){var t=e.paragraphElement,o=e.memberId;e=e.timeStamp;var r,i="",a=t.getElementsByTagNameNS(x,"editinfo").item(0);a?(i=a.getAttributeNS(x,"id"),r=E[i]):(i=Math.random().toString(),r=new ops.EditInfo(t,n.getOdtDocument()),r=new gui.EditInfoMarker(r,w),a=t.getElementsByTagNameNS(x,"editinfo").item(0),a.setAttributeNS(x,"id",i),E[i]=r),r.addEdit(o,new Date(e)),C.trigger()}function h(){var e;""!==v.innerHTML&&(v.innerHTML=""),!0===o.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(e=n.getOdtDocument().getMember(t))&&(e=e.getProperties().fullName,v.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+e+"']) .annotationRemoveButton { display: none; }")))}function b(e){var t=Object.keys(E).map(function(e){return E[e]});S.unsubscribe(ops.Document.signalMemberAdded,d),S.unsubscribe(ops.Document.signalMemberUpdated,d),S.unsubscribe(ops.Document.signalCursorAdded,f),S.unsubscribe(ops.Document.signalCursorRemoved,m),S.unsubscribe(ops.OdtDocument.signalParagraphChanged,g),S.unsubscribe(ops.Document.signalCursorMoved,p),S.unsubscribe(ops.OdtDocument.signalParagraphChanged,i.rerenderSelectionViews),S.unsubscribe(ops.OdtDocument.signalTableAdded,i.rerenderSelectionViews),S.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,i.rerenderSelectionViews),o.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,h),S.unsubscribe(ops.Document.signalMemberAdded,h),S.unsubscribe(ops.Document.signalMemberUpdated,h),y.parentNode.removeChild(y),v.parentNode.removeChild(v),function n(o,r){r?e(r):o<t.length?t[o].destroy(function(e){n(o+1,e)}):e()}(0,void 0)}var y,v,S,N,C,x="urn:webodf:names:editinfo",E={},w=void 0!==e.editInfoMarkersInitiallyVisible?Boolean(e.editInfoMarkersInitiallyVisible):!0,T=void 0!==e.caretAvatarsInitiallyVisible?Boolean(e.caretAvatarsInitiallyVisible):!0,O=void 0!==e.caretBlinksOnRangeSelect?Boolean(e.caretBlinksOnRangeSelect):!0;this.showEditInfoMarkers=function(){w||(w=!0,u(w))},this.hideEditInfoMarkers=function(){w&&(w=!1,u(w))},this.showCaretAvatars=function(){T||(T=!0,c(T))},this.hideCaretAvatars=function(){T&&(T=!1,c(T))},this.getSession=function(){return n},this.getCaret=function(e){return r.getCaret(e)},this.destroy=function(e){var t=[C.destroy,b];S.unsubscribe(ops.OdtDocument.signalAnnotationAdded,a),core.Async.destroyAll(t,e)},S=n.getOdtDocument(),N=S.getOdfCanvas(),S.subscribe(ops.OdtDocument.signalAnnotationAdded,a),S.subscribe(ops.Document.signalMemberAdded,d),S.subscribe(ops.Document.signalMemberUpdated,d),S.subscribe(ops.Document.signalCursorAdded,f),S.subscribe(ops.Document.signalCursorRemoved,m),S.subscribe(ops.OdtDocument.signalParagraphChanged,g),S.subscribe(ops.Document.signalCursorMoved,p),S.subscribe(ops.OdtDocument.signalParagraphChanged,i.rerenderSelectionViews),S.subscribe(ops.OdtDocument.signalTableAdded,i.rerenderSelectionViews),S.subscribe(ops.OdtDocument.signalParagraphStyleModified,i.rerenderSelectionViews),o.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,h),S.subscribe(ops.Document.signalMemberAdded,h),S.subscribe(ops.Document.signalMemberUpdated,h),y=s(),y.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);")),y.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);")),v=s(),h(),C=core.Task.createRedrawTask(function(){var e=N.getAnnotationViewManager();e&&(e.rehighlightAnnotations(),S.fixCursorPositions())})}}(),gui.SvgSelectionView=function(e){function t(){var e=g.getRootNode();f!==e&&(f=e,p=g.getCanvas().getSizer(),p.appendChild(b),b.setAttribute("class","webodf-selectionOverlay"),v.setAttribute("class","webodf-draggable"),S.setAttribute("class","webodf-draggable"),v.setAttribute("end","left"),S.setAttribute("end","right"),v.setAttribute("r",8),S.setAttribute("r",8),b.appendChild(y),b.appendChild(v),b.appendChild(S))}function n(e){return e=e.getBoundingClientRect(),Boolean(e&&0!==e.height)}function o(e){var t=N.getTextElements(e,!0,!1),o=e.cloneRange(),r=e.cloneRange();if(e=e.cloneRange(),!t.length)return null;var i;e:{i=0;var a=t[i],s=o.startContainer===a?o.startOffset:0,l=s;for(o.setStart(a,s),o.setEnd(a,l);!n(o);){if(a.nodeType===Node.ELEMENT_NODE&&l<a.childNodes.length)l=a.childNodes.length;else if(a.nodeType===Node.TEXT_NODE&&l<a.length)l+=1;else{if(!t[i]){i=!1;break e}a=t[i],i+=1,s=l=0}o.setStart(a,s),o.setEnd(a,l)}i=!0}if(!i)return null;e:{for(i=t.length-1,a=t[i],l=s=r.endContainer===a?r.endOffset:a.nodeType===Node.TEXT_NODE?a.length:a.childNodes.length,r.setStart(a,s),r.setEnd(a,l);!n(r);){if(a.nodeType===Node.ELEMENT_NODE&&s>0)s=0;else if(a.nodeType===Node.TEXT_NODE&&s>0)s-=1;else{if(!t[i]){t=!1;break e}a=t[i],i-=1,s=l=a.length||a.childNodes.length}r.setStart(a,s),r.setEnd(a,l)}t=!0}return t?(e.setStart(o.startContainer,o.startOffset),e.setEnd(r.endContainer,r.endOffset),{firstRange:o,lastRange:r,fillerRange:e}):null}function r(e,t){var n={};return n.top=Math.min(e.top,t.top),n.left=Math.min(e.left,t.left),n.right=Math.max(e.right,t.right),n.bottom=Math.max(e.bottom,t.bottom),n.width=n.right-n.left,n.height=n.bottom-n.top,n}function i(e,t){return t&&0<t.width&&0<t.height&&(e=e?r(e,t):t),e}function a(e){function t(e){return w.setUnfilteredPosition(e,0),y.acceptNode(e)===T&&s.acceptPosition(w)===T?T:O}function n(e){var n=null;return t(e)===T&&(n=C.getBoundingClientRect(e)),n}var o,r,a,s,l,u=e.commonAncestorContainer,c=e.startContainer,d=e.endContainer,f=e.startOffset,p=e.endOffset,m=null,b=h.createRange(),y=new odf.OdfNodeFilter;if(c===u||d===u)return b=e.cloneRange(),m=b.getBoundingClientRect(),b.detach(),m;for(e=c;e.parentNode!==u;)e=e.parentNode;for(r=d;r.parentNode!==u;)r=r.parentNode;for(s=g.createRootFilter(c),u=e.nextSibling;u&&u!==r;)a=n(u),m=i(m,a),u=u.nextSibling;if(N.isParagraph(e))m=i(m,C.getBoundingClientRect(e));else if(e.nodeType===Node.TEXT_NODE)u=e,b.setStart(u,f),b.setEnd(u,u===r?p:u.length),a=b.getBoundingClientRect(),m=i(m,a);else for(l=h.createTreeWalker(e,NodeFilter.SHOW_TEXT,t,!1),u=l.currentNode=c;u&&u!==d;)b.setStart(u,f),b.setEnd(u,u.length),a=b.getBoundingClientRect(),m=i(m,a),o=u,f=0,u=l.nextNode();if(o||(o=c),N.isParagraph(r))m=i(m,C.getBoundingClientRect(r));else if(r.nodeType===Node.TEXT_NODE)u=r,b.setStart(u,u===e?f:0),b.setEnd(u,p),a=b.getBoundingClientRect(),m=i(m,a);else for(l=h.createTreeWalker(r,NodeFilter.SHOW_TEXT,t,!1),u=l.currentNode=d;u&&u!==o;)b.setStart(u,0),b.setEnd(u,p),a=b.getBoundingClientRect(),m=i(m,a),(u=l.previousNode())&&(p=u.length);return m}function s(e,t){var n=e.getBoundingClientRect(),o={width:0};return o.top=n.top,o.bottom=n.bottom,o.height=n.height,o.left=o.right=t?n.right:n.left,o}function l(){var n,i=e.getSelectedRange();if(n=E&&e.getSelectionType()===ops.OdtCursor.RangeSelection&&!i.collapsed){t();var l,u,c,d,f,m,g=C.getBoundingClientRect(p),h=x.getZoomLevel(),i=o(i);if(i){n=i.firstRange,l=i.lastRange,u=i.fillerRange,c=C.translateRect(s(n,!1),g,h),f=C.translateRect(s(l,!0),g,h),d=(d=a(u))?C.translateRect(d,g,h):r(c,f),m=d.left,d=c.left+Math.max(0,d.width-(c.left-d.left)),g=Math.min(c.top,f.top),h=f.top+f.height,m=[{x:c.left,y:g+c.height},{x:c.left,y:g},{x:d,y:g},{x:d,y:h-f.height},{x:f.right,y:h-f.height},{x:f.right,y:h},{x:m,y:h},{x:m,y:g+c.height},{x:c.left,y:g+c.height}],d="";var N;for(N=0;N<m.length;N+=1)d+=m[N].x+","+m[N].y+" ";y.setAttribute("points",d),v.setAttribute("cx",c.left),v.setAttribute("cy",g+c.height/2),S.setAttribute("cx",f.right),S.setAttribute("cy",h-f.height/2),n.detach(),l.detach(),u.detach()}n=Boolean(i)}b.style.display=n?"block":"none"}function u(t){E&&t===e&&m.trigger()}function c(e){e=8/e,v.setAttribute("r",e),S.setAttribute("r",e)}function d(t){p.removeChild(b),p.classList.remove("webodf-virtualSelections"),e.getDocument().unsubscribe(ops.Document.signalCursorMoved,u),x.unsubscribe(gui.ZoomHelper.signalZoomChanged,c),t()}var f,p,m,g=e.getDocument(),h=g.getDOMDocument(),b=h.createElementNS("http://www.w3.org/2000/svg","svg"),y=h.createElementNS("http://www.w3.org/2000/svg","polygon"),v=h.createElementNS("http://www.w3.org/2000/svg","circle"),S=h.createElementNS("http://www.w3.org/2000/svg","circle"),N=odf.OdfUtils,C=core.DomUtils,x=g.getCanvas().getZoomHelper(),E=!0,w=e.getDocument().createPositionIterator(g.getRootNode()),T=NodeFilter.FILTER_ACCEPT,O=NodeFilter.FILTER_REJECT;this.rerender=function(){E&&m.trigger()},this.show=function(){E=!0,m.trigger()},this.hide=function(){E=!1,m.trigger()},this.destroy=function(e){core.Async.destroyAll([m.destroy,d],e)},function(){var n=e.getMemberId();m=core.Task.createRedrawTask(l),t(),b.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n),p.classList.add("webodf-virtualSelections"),e.getDocument().subscribe(ops.Document.signalCursorMoved,u),x.subscribe(gui.ZoomHelper.signalZoomChanged,c),c(x.getZoomLevel())}()},gui.UndoStateRules=function(){function e(e,t){var n=e.length;this.previous=function(){for(n-=1;n>=0;n-=1)if(t(e[n]))return e[n];return null}}function t(e){e=e.spec();var t;return e.hasOwnProperty("position")&&(t=e.position),t}function n(e){return e.isEdit}function o(e,n,o){return o?(e=t(e),n=t(n),o=t(o),e-n===n-o):(o=t(e)-t(n),0===o||1===Math.abs(o))}this.isEditOperation=n,this.isPartOfOperationSet=function(t,r){var i,a=void 0!==t.group;if(!t.isEdit||0===r.length)return!0;if(i=r[r.length-1],a&&t.group===i.group)return!0;e:switch(t.spec().optype){case"RemoveText":case"InsertText":i=!0;break e;default:i=!1}if(i&&r.some(n)){if(a){var s;a=t.spec().optype,i=new e(r,n);var l,u,c=i.previous(),d=null;for(runtime.assert(Boolean(c),"No edit operations found in state"),u=c.group,runtime.assert(void 0!==u,"Operation has no group"),l=1;c&&c.group===u;){if(a===c.spec().optype){s=c;break}c=i.previous()}if(s){for(c=i.previous();c;){if(c.group!==u){if(2===l)break;u=c.group,l+=1}if(a===c.spec().optype){d=c;break}c=i.previous()}s=o(t,s,d)}else s=!1;return s}return s=t.spec().optype,a=new e(r,n),i=a.previous(),runtime.assert(Boolean(i),"No edit operations found in state"),s=s===i.spec().optype?o(t,i,a.previous()):!1}return!1}},gui.TrivialUndoManager=function(e){function t(e){0<e.length&&(S=!0,u(e),S=!1)}function n(){y.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:d.hasUndoStates(),redoAvailable:d.hasRedoStates()})}function o(){g!==m&&g!==h[h.length-1]&&h.push(g)}function r(e){var t=e.previousSibling||e.nextSibling;e.parentNode.removeChild(e),p.normalizeTextNodes(t)}function i(e){return Object.keys(e).map(function(t){return e[t]})}function a(e){function t(e){var t=e.spec();if(a[t.memberid])switch(t.optype){case"AddCursor":o[t.memberid]||(o[t.memberid]=e,delete a[t.memberid],n-=1);break;case"MoveCursor":r[t.memberid]||(r[t.memberid]=e)}}var n,o={},r={},a={},s=e.pop();for(c.getMemberIds().forEach(function(e){a[e]=!0}),n=Object.keys(a).length;s&&n>0;)s.reverse(),s.forEach(t),s=e.pop();return i(o).concat(i(r))}function s(){var e=l=c.cloneDocumentElement();p.getElementsByTagNameNS(e,f,"cursor").forEach(r),p.getElementsByTagNameNS(e,f,"anchor").forEach(r),o(),g=m=a([m].concat(h)),h.length=0,b.length=0,n()}var l,u,c,d=this,f="urn:webodf:names:cursor",p=core.DomUtils,m=[],g=[],h=[],b=[],y=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.TrivialUndoManager.signalDocumentRootReplaced]),v=e||new gui.UndoStateRules,S=!1;this.subscribe=function(e,t){y.subscribe(e,t)},this.unsubscribe=function(e,t){y.unsubscribe(e,t)},this.hasUndoStates=function(){return 0<h.length},this.hasRedoStates=function(){return 0<b.length},this.setDocument=function(e){c=e},this.purgeInitialState=function(){h.length=0,b.length=0,m.length=0,g.length=0,l=null,n()},this.setInitialState=s,this.initialize=function(){l||s()},this.setPlaybackFunction=function(e){u=e},this.onOperationExecuted=function(e){S||(v.isEditOperation(e)&&(g===m||0<b.length)||!v.isPartOfOperationSet(e,g)?(b.length=0,o(),g=[e],h.push(g),y.emit(gui.UndoManager.signalUndoStateCreated,{operations:g}),n()):(g.push(e),y.emit(gui.UndoManager.signalUndoStateModified,{operations:g})))},this.moveForward=function(e){for(var o,r=0;e&&b.length;)o=b.pop(),h.push(o),t(o),e-=1,r+=1;return r&&(g=h[h.length-1],n()),r},this.moveBackward=function(e){for(var o=0;e&&h.length;)b.push(h.pop()),e-=1,o+=1;return o&&(c.getMemberIds().forEach(function(e){c.removeCursor(e)}),c.setDocumentElement(l.cloneNode(!0)),y.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),t(m),h.forEach(t),g=h[h.length-1]||m,n()),o}},gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced",odf.GraphicProperties=function(e,t,n){var o=this,r=odf.Namespaces.stylens,i=odf.Namespaces.svgns;this.verticalPos=function(){return o.data.value("verticalPos")},this.verticalRel=function(){return o.data.value("verticalRel")},this.horizontalPos=function(){return o.data.value("horizontalPos")},this.horizontalRel=function(){return o.data.value("horizontalRel")},this.strokeWidth=function(){return o.data.value("strokeWidth")},o.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{verticalPos:function(){var t=e.getAttributeNS(r,"vertical-pos");return""===t?void 0:t},verticalRel:function(){var t=e.getAttributeNS(r,"vertical-rel");return""===t?void 0:t},horizontalPos:function(){var t=e.getAttributeNS(r,"horizontal-pos");return""===t?void 0:t},horizontalRel:function(){var t=e.getAttributeNS(r,"horizontal-rel");return""===t?void 0:t},strokeWidth:function(){var n=e.getAttributeNS(i,"stroke-width");return t.parseLength(n)}})},odf.ComputedGraphicProperties=function(){var e;this.setGraphicProperties=function(t){e=t},this.verticalPos=function(){return e&&e.verticalPos()||"from-top"},this.verticalRel=function(){return e&&e.verticalRel()||"page"},this.horizontalPos=function(){return e&&e.horizontalPos()||"from-left"},this.horizontalRel=function(){return e&&e.horizontalRel()||"page"}},odf.PageLayoutProperties=function(e,t,n){var o=this,r=odf.Namespaces.fons;this.pageHeight=function(){return o.data.value("pageHeight")||1123},this.pageWidth=function(){return o.data.value("pageWidth")||794},o.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{pageHeight:function(){var n;return e&&(n=e.getAttributeNS(r,"page-height"),n=t.parseLength(n)),n},pageWidth:function(){var n;return e&&(n=e.getAttributeNS(r,"page-width"),n=t.parseLength(n)),n}})},odf.PageLayout=function(e,t,n){var o=null;e&&(o=t.getPropertiesElement("page-layout-properties",e)),this.pageLayout=new odf.PageLayoutProperties(o,t,n&&n.pageLayout)},odf.PageLayoutCache=function(){},odf.PageLayoutCache.prototype.getPageLayout=function(){},odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){},odf.ParagraphProperties=function(e,t,n){var o=this,r=odf.Namespaces.fons;this.marginTop=function(){return o.data.value("marginTop")},o.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{marginTop:function(){var o=e.getAttributeNS(r,"margin-top");
return t.parsePositiveLengthOrPercent(o,"marginTop",n&&n.data)}})},odf.ComputedParagraphProperties=function(){var e={},t=[];this.setStyleChain=function(n){t=n,e={}},this.marginTop=function(){var n,o;if(e.hasOwnProperty("marginTop"))n=e.marginTop;else{for(o=0;void 0===n&&o<t.length;o+=1)n=t[o].marginTop();e.marginTop=n}return n||0}},odf.TextProperties=function(e,t,n){var o=this,r=odf.Namespaces.fons;this.fontSize=function(){return o.data.value("fontSize")},o.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{fontSize:function(){var o=e.getAttributeNS(r,"font-size");return t.parsePositiveLengthOrPercent(o,"fontSize",n&&n.data)}})},odf.ComputedTextProperties=function(){var e={},t=[];this.setStyleChain=function(n){t=n,e={}},this.fontSize=function(){var n,o;if(e.hasOwnProperty("fontSize"))n=e.fontSize;else{for(o=0;void 0===n&&o<t.length;o+=1)n=t[o].fontSize();e.fontSize=n}return n||12}},odf.MasterPage=function(e,t){var n;e?(n=e.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=t.getPageLayout(n)):this.pageLayout=t.getDefaultPageLayout()},odf.MasterPageCache=function(){},odf.MasterPageCache.prototype.getMasterPage=function(){},odf.StylePileEntry=function(e,t,n,o){this.masterPage=function(){var t=e.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),o=null;return t&&(o=n.getMasterPage(t)),o},function(n){var r=e.getAttributeNS(odf.Namespaces.stylens,"family"),i=null;("graphic"===r||"chart"===r)&&(n.graphic=void 0===o?void 0:o.graphic,i=t.getPropertiesElement("graphic-properties",e,i),null!==i&&(n.graphic=new odf.GraphicProperties(i,t,n.graphic))),("paragraph"===r||"table-cell"===r||"graphic"===r||"presentation"===r||"chart"===r)&&(n.paragraph=void 0===o?void 0:o.paragraph,i=t.getPropertiesElement("paragraph-properties",e,i),null!==i&&(n.paragraph=new odf.ParagraphProperties(i,t,n.paragraph))),("text"===r||"paragraph"===r||"table-cell"===r||"graphic"===r||"presentation"===r||"chart"===r)&&(n.text=void 0===o?void 0:o.text,i=t.getPropertiesElement("text-properties",e,i),null!==i&&(n.text=new odf.TextProperties(i,t,n.text)))}(this)},odf.StylePile=function(e,t){function n(n,o){var a,s;return n.hasAttributeNS(i,"parent-style-name")&&(s=n.getAttributeNS(i,"parent-style-name"),-1===o.indexOf(s)&&(a=r(s,o))),new odf.StylePileEntry(n,e,t,a)}var o,r,i=odf.Namespaces.stylens,a={},s={},l={},u={};r=function(e,t){var o,r=l[e];return!r&&(o=a[e])&&(t.push(e),r=n(o,t),l[e]=r),r},this.getStyle=function(e){var t,o=u[e]||l[e],r=[];return o||(t=s[e],t||(t=a[e])&&r.push(e),t&&(o=n(t,r))),o},this.addCommonStyle=function(e){var t;e.hasAttributeNS(i,"name")&&(t=e.getAttributeNS(i,"name"),a.hasOwnProperty(t)||(a[t]=e))},this.addAutomaticStyle=function(e){var t;e.hasAttributeNS(i,"name")&&(t=e.getAttributeNS(i,"name"),s.hasOwnProperty(t)||(s[t]=e))},this.setDefaultStyle=function(e){void 0===o&&(o=n(e,[]))},this.getDefaultStyle=function(){return o}},odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties,this.paragraph=new odf.ComputedParagraphProperties,this.graphic=new odf.ComputedGraphicProperties},odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties,this.paragraph=new odf.ComputedParagraphProperties},odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties},odf.StyleCache=function(e){function t(e,t,n,o){t=n.getAttributeNS(t,"class-names");var r;if(t)for(t=t.split(" "),r=0;r<t.length;r+=1)(n=t[r])&&(o.push(e),o.push(n))}function n(e,n){var o=C.getStyleName("paragraph",e);return void 0!==o&&(n.push("paragraph"),n.push(o)),e.namespaceURI!==S||"h"!==e.localName&&"p"!==e.localName||t("paragraph",S,e,n),n}function o(e,t,n){var o,r,i,s,l=[];for(o=0;o<e.length;o+=2)i=e[o],s=e[o+1],i=a[i],s=i.getStyle(s),void 0!==s&&(s=s[t],void 0!==s&&s!==r&&(l.push(s),r=s));return i=a[n],(s=i.getDefaultStyle())&&(s=s[t],void 0!==s&&s!==r&&l.push(s)),l}function r(o,i){var a=C.getStyleName("text",o),s=o.parentNode;return void 0!==a&&(i.push("text"),i.push(a)),"span"===o.localName&&o.namespaceURI===S&&t("text",S,o,i),s&&s!==e?(s.namespaceURI!==S||"p"!==s.localName&&"h"!==s.localName?r(s,i):n(s,i),i):i}function i(e){return e=e.getAttributeNS(N,"family"),a[e]}var a,s,l,u,c,d,f,p,m,g,h,b,y,v=this,S=odf.Namespaces.textns,N=odf.Namespaces.stylens,C=new odf.StyleInfo,x=new odf.StyleParseUtils;this.getComputedGraphicStyle=function(e){var t=[];e=C.getStyleName("graphic",e),void 0!==e&&(t.push("graphic"),t.push(e)),e=t.join("/");var n=u[e];return runtime.assert(0===t.length%2,"Invalid style chain."),void 0===n&&(n=new odf.ComputedGraphicStyle,n.graphic.setGraphicProperties(o(t,"graphic","graphic")[0]),n.text.setStyleChain(o(t,"text","graphic")),n.paragraph.setStyleChain(o(t,"paragraph","graphic")),u[e]=n),n},this.getComputedParagraphStyle=function(e){e=n(e,[]);var t=e.join("/"),r=l[t];return runtime.assert(0===e.length%2,"Invalid style chain."),void 0===r&&(r=new odf.ComputedParagraphStyle,r.text.setStyleChain(o(e,"text","paragraph")),r.paragraph.setStyleChain(o(e,"paragraph","paragraph")),l[t]=r),r},this.getComputedTextStyle=function(e){e=r(e,[]);var t=e.join("/"),n=s[t];return runtime.assert(0===e.length%2,"Invalid style chain."),void 0===n&&(n=new odf.ComputedTextStyle,n.text.setStyleChain(o(e,"text","text")),s[t]=n),n},this.getPageLayout=function(e){var t=y[e];return t||((t=b[e])?(t=new odf.PageLayout(t,x,h),y[e]=t):t=h),t},this.getDefaultPageLayout=function(){return h},this.getMasterPage=function(e){var t=m[e];return void 0===t&&((t=p[e])?(t=new odf.MasterPage(t,v),m[e]=t):t=null),t},this.getDefaultMasterPage=function(){return g},this.update=function(){var t,n,o=null,r=null;for(s={},l={},u={},p={},m={},y={},b={},c=new odf.StylePile(x,v),d=new odf.StylePile(x,v),f=new odf.StylePile(x,v),a={text:c,paragraph:d,graphic:f},t=e.styles.firstElementChild;t;)t.namespaceURI===N&&((n=i(t))?"style"===t.localName?n.addCommonStyle(t):"default-style"===t.localName&&n.setDefaultStyle(t):"default-page-layout"===t.localName&&(o=t)),t=t.nextElementSibling;for(h=new odf.PageLayout(o,x),t=e.automaticStyles.firstElementChild;t;)t.namespaceURI===N&&((n=i(t))&&"style"===t.localName?n.addAutomaticStyle(t):"page-layout"===t.localName&&(b[t.getAttributeNS(N,"name")]=t)),t=t.nextElementSibling;for(t=e.masterStyles.firstElementChild;t;)t.namespaceURI===N&&"master-page"===t.localName&&(r=r||t,n=t,o=n.getAttributeNS(N,"name"),0<o.length&&!p.hasOwnProperty(o)&&(p[o]=n)),t=t.nextElementSibling;g=new odf.MasterPage(r,v)}},ops.OperationTransformMatrix=function(){function e(e){e.position+=e.length,e.length*=-1}function t(t){var n=0>t.length;return n&&e(t),n}function n(e,t){function n(n){e[n]===t&&o.push(n)}var o=[];return e&&["style:parent-style-name","style:next-style-name"].forEach(n),o}function o(e,t){function n(n){e[n]===t&&delete e[n]}e&&["style:parent-style-name","style:next-style-name"].forEach(n)}function r(e){var t={};return Object.keys(e).forEach(function(n){t[n]="object"==typeof e[n]?r(e[n]):e[n]}),t}function i(e,t,n,o){var r,i,a=!1,s=!1,l=[];if(o&&o.attributes&&(l=o.attributes.split(",")),e&&(n||0<l.length)&&Object.keys(e).forEach(function(t){var o,r=e[t];"object"!=typeof r&&(n&&(o=n[t]),void 0!==o?(delete e[t],s=!0,o===r&&(delete n[t],a=!0)):-1!==l.indexOf(t)&&(delete e[t],s=!0))}),t&&t.attributes&&(n||0<l.length)){for(i=t.attributes.split(","),o=0;o<i.length;o+=1)r=i[o],(n&&void 0!==n[r]||l&&-1!==l.indexOf(r))&&(i.splice(o,1),o-=1,s=!0);0<i.length?t.attributes=i.join(","):delete t.attributes}return{majorChanged:a,minorChanged:s}}function a(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}function s(e){for(var t in e)if(e.hasOwnProperty(t)&&("attributes"!==t||0<e.attributes.length))return!0;return!1}function l(e,t,n,o,r){var l,u=e?e[r]:null,c=t?t[r]:null,d=n?n[r]:null,f=o?o[r]:null;return l=i(u,c,d,f),u&&!a(u)&&delete e[r],c&&!s(c)&&delete t[r],d&&!a(d)&&delete n[r],f&&!s(f)&&delete o[r],l}function u(e,t){return{opSpecsA:[e],opSpecsB:[t]}}var c;c={AddCursor:{AddCursor:u,AddMember:u,AddStyle:u,ApplyDirectStyling:u,InsertText:u,MergeParagraph:u,MoveCursor:u,RemoveCursor:u,RemoveMember:u,RemoveStyle:u,RemoveText:u,SetParagraphStyle:u,SplitParagraph:u,UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},AddMember:{AddStyle:u,ApplyDirectStyling:u,InsertText:u,MergeParagraph:u,MoveCursor:u,RemoveCursor:u,RemoveStyle:u,RemoveText:u,SetParagraphStyle:u,SplitParagraph:u,UpdateMetadata:u,UpdateParagraphStyle:u},AddStyle:{AddStyle:u,ApplyDirectStyling:u,InsertText:u,MergeParagraph:u,MoveCursor:u,RemoveCursor:u,RemoveMember:u,RemoveStyle:function(e,t){var r,i=[e],a=[t];return e.styleFamily===t.styleFamily&&(r=n(e.setProperties,t.styleName),0<r.length&&(r={optype:"UpdateParagraphStyle",memberid:t.memberid,timestamp:t.timestamp,styleName:e.styleName,removedProperties:{attributes:r.join(",")}},a.unshift(r)),o(e.setProperties,t.styleName)),{opSpecsA:i,opSpecsB:a}},RemoveText:u,SetParagraphStyle:u,SplitParagraph:u,UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},ApplyDirectStyling:{ApplyDirectStyling:function(e,t,n){var o,i,s,u,c,d,f,p;return u=[e],s=[t],e.position+e.length<=t.position||e.position>=t.position+t.length||(o=n?e:t,i=n?t:e,(e.position!==t.position||e.length!==t.length)&&(d=r(o),f=r(i)),t=l(i.setProperties,null,o.setProperties,null,"style:text-properties"),(t.majorChanged||t.minorChanged)&&(s=[],e=[],u=o.position+o.length,c=i.position+i.length,i.position<o.position?t.minorChanged&&(p=r(f),p.length=o.position-i.position,e.push(p),i.position=o.position,i.length=c-i.position):o.position<i.position&&t.majorChanged&&(p=r(d),p.length=i.position-o.position,s.push(p),o.position=i.position,o.length=u-o.position),c>u?t.minorChanged&&(d=f,d.position=u,d.length=c-u,e.push(d),i.length=u-i.position):u>c&&t.majorChanged&&(d.position=c,d.length=u-c,s.push(d),o.length=c-o.position),o.setProperties&&a(o.setProperties)&&s.push(o),i.setProperties&&a(i.setProperties)&&e.push(i),n?(u=s,s=e):u=e)),{opSpecsA:u,opSpecsB:s}},InsertText:function(e,t){return t.position<=e.position?e.position+=t.text.length:t.position<=e.position+e.length&&(e.length+=t.text.length),{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){var n=e.position,o=e.position+e.length;return n>=t.sourceStartPosition&&(n-=1),o>=t.sourceStartPosition&&(o-=1),e.position=n,e.length=o-n,{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:u,RemoveCursor:u,RemoveMember:u,RemoveStyle:u,RemoveText:function(e,t){var n=e.position+e.length,o=t.position+t.length,r=[e],i=[t];return o<=e.position?e.position-=t.length:t.position<n&&(e.position<t.position?e.length=n>o?e.length-t.length:t.position-e.position:(e.position=t.position,n>o?e.length=n-o:r=[])),{opSpecsA:r,opSpecsB:i}},SetParagraphStyle:u,SplitParagraph:function(e,t){return t.position<e.position?e.position+=1:t.position<e.position+e.length&&(e.length+=1),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},InsertText:{InsertText:function(e,t,n){return e.position<t.position?t.position+=e.text.length:e.position>t.position?e.position+=t.text.length:n?t.position+=e.text.length:e.position+=t.text.length,{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){return e.position>=t.sourceStartPosition?e.position-=1:(e.position<t.sourceStartPosition&&(t.sourceStartPosition+=e.text.length),e.position<t.destinationStartPosition&&(t.destinationStartPosition+=e.text.length)),{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:function(n,o){var r=t(o);return n.position<o.position?o.position+=n.text.length:n.position<o.position+o.length&&(o.length+=n.text.length),r&&e(o),{opSpecsA:[n],opSpecsB:[o]}},RemoveCursor:u,RemoveMember:u,RemoveStyle:u,RemoveText:function(e,t){var n;n=t.position+t.length;var o=[e],r=[t];return n<=e.position?e.position-=t.length:e.position<=t.position?t.position+=e.text.length:(t.length=e.position-t.position,n={optype:"RemoveText",memberid:t.memberid,timestamp:t.timestamp,position:e.position+e.text.length,length:n-e.position},r.unshift(n),e.position=t.position),{opSpecsA:o,opSpecsB:r}},SetParagraphStyle:function(e,t){return t.position>e.position&&(t.position+=e.text.length),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){return e.position<t.sourceParagraphPosition&&(t.sourceParagraphPosition+=e.text.length),e.position<=t.position?t.position+=e.text.length:e.position+=1,{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},MergeParagraph:{MergeParagraph:function(e,t,n){var o,r=[e],i=[t];return e.destinationStartPosition===t.destinationStartPosition?(r=[],i=[],e.moveCursor&&(o={optype:"MoveCursor",memberid:e.memberid,timestamp:e.timestamp,position:e.sourceStartPosition-1},r.push(o)),t.moveCursor&&(o={optype:"MoveCursor",memberid:t.memberid,timestamp:t.timestamp,position:t.sourceStartPosition-1},i.push(o)),e=n?e:t,e={optype:"SetParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,position:e.destinationStartPosition,styleName:e.paragraphStyleName},n?r.push(e):i.push(e)):t.sourceStartPosition===e.destinationStartPosition?(e.destinationStartPosition=t.destinationStartPosition,e.sourceStartPosition-=1,e.paragraphStyleName=t.paragraphStyleName):e.sourceStartPosition===t.destinationStartPosition?(t.destinationStartPosition=e.destinationStartPosition,t.sourceStartPosition-=1,t.paragraphStyleName=e.paragraphStyleName):e.destinationStartPosition<t.destinationStartPosition?(t.destinationStartPosition-=1,t.sourceStartPosition-=1):(e.destinationStartPosition-=1,e.sourceStartPosition-=1),{opSpecsA:r,opSpecsB:i}},MoveCursor:function(e,t){var n=t.position,o=t.position+t.length,r=Math.min(n,o),n=Math.max(n,o);return r>=e.sourceStartPosition&&(r-=1),n>=e.sourceStartPosition&&(n-=1),0<=t.length?(t.position=r,t.length=n-r):(t.position=n,t.length=r-n),{opSpecsA:[e],opSpecsB:[t]}},RemoveCursor:u,RemoveMember:u,RemoveStyle:u,RemoveText:function(e,t){return t.position>=e.sourceStartPosition?t.position-=1:(t.position<e.destinationStartPosition&&(e.destinationStartPosition-=t.length),t.position<e.sourceStartPosition&&(e.sourceStartPosition-=t.length)),{opSpecsA:[e],opSpecsB:[t]}},SetParagraphStyle:function(e,t){var n=[e],o=[t];return t.position>e.sourceStartPosition?t.position-=1:(t.position===e.destinationStartPosition||t.position===e.sourceStartPosition)&&(t.position=e.destinationStartPosition,e.paragraphStyleName=t.styleName),{opSpecsA:n,opSpecsB:o}},SplitParagraph:function(e,t){var n,o=[e],r=[t];return t.position<e.destinationStartPosition?(e.destinationStartPosition+=1,e.sourceStartPosition+=1):t.position>=e.destinationStartPosition&&t.position<e.sourceStartPosition?(t.paragraphStyleName=e.paragraphStyleName,n={optype:"SetParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,position:e.destinationStartPosition,styleName:e.paragraphStyleName},o.push(n),t.position===e.sourceStartPosition-1&&e.moveCursor&&(n={optype:"MoveCursor",memberid:e.memberid,timestamp:e.timestamp,position:t.position,length:0},o.push(n)),e.destinationStartPosition=t.position+1,e.sourceStartPosition+=1):t.position>=e.sourceStartPosition&&(t.position-=1,t.sourceParagraphPosition-=1),{opSpecsA:o,opSpecsB:r}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},MoveCursor:{MoveCursor:u,RemoveCursor:function(e,t){return{opSpecsA:e.memberid===t.memberid?[]:[e],opSpecsB:[t]}},RemoveMember:u,RemoveStyle:u,RemoveText:function(n,o){var r=t(n),i=n.position+n.length,a=o.position+o.length;return a<=n.position?n.position-=o.length:o.position<i&&(n.position<o.position?n.length=i>a?n.length-o.length:o.position-n.position:(n.position=o.position,n.length=i>a?i-a:0)),r&&e(n),{opSpecsA:[n],opSpecsB:[o]}},SetParagraphStyle:u,SplitParagraph:function(n,o){var r=t(n);return o.position<n.position?n.position+=1:o.position<n.position+n.length&&(n.length+=1),r&&e(n),{opSpecsA:[n],opSpecsB:[o]}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},RemoveCursor:{RemoveCursor:function(e,t){var n=e.memberid===t.memberid;return{opSpecsA:n?[]:[e],opSpecsB:n?[]:[t]}},RemoveMember:u,RemoveStyle:u,RemoveText:u,SetParagraphStyle:u,SplitParagraph:u,UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},RemoveMember:{RemoveStyle:u,RemoveText:u,SetParagraphStyle:u,SplitParagraph:u,UpdateMetadata:u,UpdateParagraphStyle:u},RemoveStyle:{RemoveStyle:function(e,t){var n=e.styleName===t.styleName&&e.styleFamily===t.styleFamily;return{opSpecsA:n?[]:[e],opSpecsB:n?[]:[t]}},RemoveText:u,SetParagraphStyle:function(e,t){var n,o=[e],r=[t];return"paragraph"===e.styleFamily&&e.styleName===t.styleName&&(n={optype:"SetParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,position:t.position,styleName:""},o.unshift(n),t.styleName=""),{opSpecsA:o,opSpecsB:r}},SplitParagraph:u,UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:function(e,t){var r,i=[e],a=[t];return"paragraph"===e.styleFamily&&(r=n(t.setProperties,e.styleName),0<r.length&&(r={optype:"UpdateParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,styleName:t.styleName,removedProperties:{attributes:r.join(",")}},i.unshift(r)),e.styleName===t.styleName?a=[]:o(t.setProperties,e.styleName)),{opSpecsA:i,opSpecsB:a}}},RemoveText:{RemoveText:function(e,t){var n=e.position+e.length,o=t.position+t.length,r=[e],i=[t];return o<=e.position?e.position-=t.length:n<=t.position?t.position-=e.length:t.position<n&&(e.position<t.position?(e.length=n>o?e.length-t.length:t.position-e.position,o>n?(t.position=e.position,t.length=o-n):i=[]):(o>n?t.length-=e.length:t.position<e.position?t.length=e.position-t.position:i=[],n>o?(e.position=t.position,e.length=n-o):r=[])),{opSpecsA:r,opSpecsB:i}},SetParagraphStyle:function(e,t){return e.position<t.position&&(t.position-=e.length),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){var n=e.position+e.length,o=[e],r=[t];return t.position<=e.position?e.position+=1:t.position<n&&(e.length=t.position-e.position,n={optype:"RemoveText",memberid:e.memberid,timestamp:e.timestamp,position:t.position+1,length:n-t.position},o.unshift(n)),e.position+e.length<=t.position?t.position-=e.length:e.position<t.position&&(t.position=e.position),e.position+e.length<t.sourceParagraphPosition&&(t.sourceParagraphPosition-=e.length),{opSpecsA:o,opSpecsB:r}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},SetParagraphStyle:{SetParagraphStyle:function(e,t,n){return e.position===t.position&&(n?t.styleName=e.styleName:e.styleName=t.styleName),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){var n,o=[e],i=[t];return e.position>t.position?e.position+=1:e.position===t.sourceParagraphPosition&&(t.paragraphStyleName=e.styleName,n=r(e),n.position=t.position+1,o.push(n)),{opSpecsA:o,opSpecsB:i}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},SplitParagraph:{SplitParagraph:function(e,t,n){var o,r;return e.position<t.position?o=!0:t.position<e.position?r=!0:e.position===t.position&&(n?o=!0:r=!0),o?(t.position+=1,t.sourceParagraphPosition=e.position<t.sourceParagraphPosition?t.sourceParagraphPosition+1:e.position+1):r&&(e.position+=1,e.sourceParagraphPosition=t.position<t.sourceParagraphPosition?e.sourceParagraphPosition+1:t.position+1),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:u,UpdateMetadata:u,UpdateParagraphStyle:u},UpdateMember:{UpdateMetadata:u,UpdateParagraphStyle:u},UpdateMetadata:{UpdateMetadata:function(e,t,n){var o,r=[e],l=[t];return o=n?e:t,e=n?t:e,i(e.setProperties||null,e.removedProperties||null,o.setProperties||null,o.removedProperties||null),o.setProperties&&a(o.setProperties)||o.removedProperties&&s(o.removedProperties)||(n?r=[]:l=[]),e.setProperties&&a(e.setProperties)||e.removedProperties&&s(e.removedProperties)||(n?l=[]:r=[]),{opSpecsA:r,opSpecsB:l}},UpdateParagraphStyle:u},UpdateParagraphStyle:{UpdateParagraphStyle:function(e,t,n){var o,r=[e],u=[t];return e.styleName===t.styleName&&(o=n?e:t,e=n?t:e,l(e.setProperties,e.removedProperties,o.setProperties,o.removedProperties,"style:paragraph-properties"),l(e.setProperties,e.removedProperties,o.setProperties,o.removedProperties,"style:text-properties"),i(e.setProperties||null,e.removedProperties||null,o.setProperties||null,o.removedProperties||null),o.setProperties&&a(o.setProperties)||o.removedProperties&&s(o.removedProperties)||(n?r=[]:u=[]),e.setProperties&&a(e.setProperties)||e.removedProperties&&s(e.removedProperties)||(n?u=[]:r=[])),{opSpecsA:r,opSpecsB:u}}}},this.passUnchanged=u,this.extendTransformations=function(e){Object.keys(e).forEach(function(t){var n,o=e[t],r=c.hasOwnProperty(t);runtime.log((r?"Extending":"Adding")+" map for optypeA: "+t),r||(c[t]={}),n=c[t],Object.keys(o).forEach(function(e){var r=n.hasOwnProperty(e);runtime.assert(e>=t,"Wrong order:"+t+", "+e),runtime.log("  "+(r?"Overwriting":"Adding")+" entry for optypeB: "+e),n[e]=o[e]})})},this.transformOpspecVsOpspec=function(e,t){var n,o=e.optype<=t.optype;return runtime.log("Crosstransforming:"),runtime.log(runtime.toJson(e)),runtime.log(runtime.toJson(t)),o||(n=e,e=t,t=n),(n=(n=c[e.optype])&&n[t.optype])?(n=n(e,t,!o),o||null===n||(n={opSpecsA:n.opSpecsB,opSpecsB:n.opSpecsA})):n=null,runtime.log("result:"),n?(runtime.log(runtime.toJson(n.opSpecsA)),runtime.log(runtime.toJson(n.opSpecsB))):runtime.log("null"),n}},ops.OperationTransformer=function(){function e(n,o){for(var r,i,a=[],s=[];0<n.length&&o;){if(r=n.shift(),r=t.transformOpspecVsOpspec(r,o),!r)return null;if(a=a.concat(r.opSpecsA),0===r.opSpecsB.length){a=a.concat(n),o=null;break}for(;1<r.opSpecsB.length;){if(i=e(n,r.opSpecsB.shift()),!i)return null;s=s.concat(i.opSpecsB),n=i.opSpecsA}o=r.opSpecsB.pop()}return o&&s.push(o),{opSpecsA:a,opSpecsB:s}}var t=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return t},this.transform=function(t,n){for(var o,r=[];0<n.length;){if(o=e(t,n.shift()),!o)return null;t=o.opSpecsA,r=r.concat(o.opSpecsB)}return{opSpecsA:t,opSpecsB:r}}};var webodf_css='@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);@namespace webodfhelper url(urn:webodf:names:helper);@namespace cursor url(urn:webodf:names:cursor);@namespace editinfo url(urn:webodf:names:editinfo);@namespace annotation url(urn:webodf:names:annotation);@namespace dc url(http://purl.org/dc/elements/1.1/);@namespace svgns url(http://www.w3.org/2000/svg);office|document > *, office|document-content > * {display: none;}office|body, office|document {display: inline-block;position: relative;}text|p, text|h {display: block;padding: 0;margin: 0;line-height: normal;position: relative;}text|p::after, text|h::after {content: "\\200B";white-space: pre;}*[webodfhelper|containsparagraphanchor] {position: relative;}text|s {white-space: pre;}text|tab {display: inline;white-space: pre;}text|tracked-changes {display: none;}office|binary-data {display: none;}office|text {display: block;text-align: left;overflow: visible;word-wrap: break-word;}office|text::selection {background: transparent;}.webodf-virtualSelections *::selection {background: transparent;}.webodf-virtualSelections *::-moz-selection {background: transparent;}office|text * draw|text-box {display: block;border: 1px solid #d3d3d3;}office|text draw|frame {z-index: 1;}office|spreadsheet {display: block;border-collapse: collapse;empty-cells: show;font-family: sans-serif;font-size: 10pt;text-align: left;page-break-inside: avoid;overflow: hidden;}office|presentation {display: inline-block;text-align: left;}#shadowContent {display: inline-block;text-align: left;}draw|page {display: block;position: relative;overflow: hidden;}presentation|notes, presentation|footer-decl, presentation|date-time-decl {display: none;}@media print {draw|page {border: 1pt solid black;page-break-inside: avoid;}presentation|notes {}}office|spreadsheet text|p {border: 0px;padding: 1px;margin: 0px;}office|spreadsheet table|table {margin: 3px;}office|spreadsheet table|table:after {}office|spreadsheet table|table-row {counter-increment: row;}office|spreadsheet table|table-row:before {width: 3em;background: #cccccc;border: 1px solid black;text-align: center;content: counter(row);display: table-cell;}office|spreadsheet table|table-cell {border: 1px solid #cccccc;}table|table {display: table;}draw|frame table|table {width: 100%;height: 100%;background: white;}table|table-header-rows {display: table-header-group;}table|table-row {display: table-row;}table|table-column {display: table-column;}table|table-cell {width: 0.889in;display: table-cell;word-break: break-all;}draw|frame {display: block;}draw|image {display: block;width: 100%;height: 100%;top: 0px;left: 0px;background-repeat: no-repeat;background-size: 100% 100%;-moz-background-size: 100% 100%;}draw|frame > draw|image:nth-of-type(n+2) {display: none;}text|list:before {display: none;content:"";}text|list {display: block;}text|list-item {display: block;}text|number {display:none;}text|a {color: blue;text-decoration: underline;cursor: pointer;}.webodf-inactiveLinks text|a {cursor: text;}text|note-citation {vertical-align: super;font-size: smaller;}text|note-body {display: none;}text|note:hover text|note-citation {background: #dddddd;}text|note:hover text|note-body {display: block;left:1em;max-width: 80%;position: absolute;background: #ffffaa;}text|bibliography-source {display: none;}svg|title, svg|desc {display: none;}video {width: 100%;height: 100%}cursor|anchor {display: none;}cursor|cursor {display: none;}.webodf-caretOverlay {position: absolute;top: 5%;height: 1em;z-index: 10;padding-left: 1px;pointer-events: none;}.webodf-caretOverlay .caret {position: absolute;border-left: 2px solid black;top: 0;bottom: 0;right: 0;}.webodf-caretOverlay .handle {position: absolute;margin-top: 5px;padding-top: 3px;margin-left: auto;margin-right: auto;width: 64px;height: 68px;border-radius: 5px;opacity: 0.3;text-align: center;background-color: black;box-shadow: 0px 0px 5px rgb(90, 90, 90);border: 1px solid black;top: -85px;right: -32px;}.webodf-caretOverlay .handle > img {box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;background-color: rgb(200, 200, 200);border-radius: 5px;border: 2px solid;height: 60px;width: 60px;display: block;margin: auto;}.webodf-caretOverlay .handle.active {opacity: 0.8;}.webodf-caretOverlay .handle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 43%;}.webodf-caretSizer {display: inline-block;width: 0;visibility: hidden;}#eventTrap {display: block;position: absolute;bottom: 0;left: 0;outline: none;opacity: 0;color: rgba(255, 255, 255, 0);pointer-events: none;white-space: pre;overflow: hidden;}cursor|cursor > #composer {text-decoration: underline;}cursor|cursor[cursor|caret-sizer-active="true"],cursor|cursor[cursor|composing="true"] {display: inline;}editinfo|editinfo {display: inline-block;}.editInfoMarker {position: absolute;width: 10px;height: 100%;left: -20px;opacity: 0.8;top: 0;border-radius: 5px;background-color: transparent;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);}.editInfoMarker:hover {box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);}.editInfoHandle {position: absolute;background-color: black;padding: 5px;border-radius: 5px;opacity: 0.8;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);bottom: 100%;margin-bottom: 10px;z-index: 3;left: -25px;}.editInfoHandle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 5px;}.editInfo {font-family: sans-serif;font-weight: normal;font-style: normal;text-decoration: none;color: white;width: 100%;height: 12pt;}.editInfoColor {float: left;width: 10pt;height: 10pt;border: 1px solid white;}.editInfoAuthor {float: left;margin-left: 5pt;font-size: 10pt;text-align: left;height: 12pt;line-height: 12pt;}.editInfoTime {float: right;margin-left: 30pt;font-size: 8pt;font-style: italic;color: yellow;height: 12pt;line-height: 12pt;}.annotationWrapper {display: inline;position: relative;}.annotationRemoveButton:before {content: "×";color: white;padding: 5px;line-height: 1em;}.annotationRemoveButton {width: 20px;height: 20px;border-radius: 10px;background-color: black;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);position: absolute;top: -10px;left: -10px;z-index: 3;text-align: center;font-family: sans-serif;font-style: normal;font-weight: normal;text-decoration: none;font-size: 15px;}.annotationRemoveButton:hover {cursor: pointer;box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);}.annotationNote {width: 4cm;position: absolute;display: inline;z-index: 10;top: 0;}.annotationNote > office|annotation {display: block;text-align: left;}.annotationConnector {position: absolute;display: inline;top: 0;z-index: 2;border-top: 1px dashed brown;}.annotationConnector.angular {-moz-transform-origin: left top;-webkit-transform-origin: left top;-ms-transform-origin: left top;transform-origin: left top;}.annotationConnector.horizontal {left: 0;}.annotationConnector.horizontal:before {content: "";display: inline;position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: brown transparent transparent transparent;top: -1px;left: -5px;}office|annotation {width: 100%;height: 100%;display: none;background: rgb(198, 238, 184);background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);box-shadow: 0 3px 4px -3px #ccc;}office|annotation > dc|creator {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;color: white;background-color: brown;padding: 4px;}office|annotation > dc|date {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;border: 4px solid transparent;color: black;}office|annotation > text|list {display: block;padding: 5px;}office|annotation text|p {font-size: 10pt;color: black;font-weight: normal;font-style: normal;text-decoration: none;font-family: sans-serif;}#annotationsPane {background-color: #EAEAEA;width: 4cm;height: 100%;display: none;position: absolute;outline: 1px solid #ccc;}.webodf-annotationHighlight {background-color: yellow;position: relative;}.webodf-selectionOverlay {position: absolute;pointer-events: none;top: 0;left: 0;top: 0;left: 0;width: 100%;height: 100%;z-index: 15;}.webodf-selectionOverlay > polygon {fill-opacity: 0.3;stroke-opacity: 0.8;stroke-width: 1;fill-rule: evenodd;}.webodf-selectionOverlay > .webodf-draggable {fill-opacity: 0.8;stroke-opacity: 0;stroke-width: 8;pointer-events: all;display: none;-moz-transform-origin: center center;-webkit-transform-origin: center center;-ms-transform-origin: center center;transform-origin: center center;}#imageSelector {display: none;position: absolute;border-style: solid;border-color: black;}#imageSelector > div {width: 5px;height: 5px;display: block;position: absolute;border: 1px solid black;background-color: #ffffff;}#imageSelector > .topLeft {top: -4px;left: -4px;}#imageSelector > .topRight {top: -4px;right: -4px;}#imageSelector > .bottomRight {right: -4px;bottom: -4px;}#imageSelector > .bottomLeft {bottom: -4px;left: -4px;}#imageSelector > .topMiddle {top: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .rightMiddle {top: 50%;right: -4px;margin-top: -2.5px;}#imageSelector > .bottomMiddle {bottom: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .leftMiddle {top: 50%;left: -4px;margin-top: -2.5px;}div.webodf-customScrollbars::-webkit-scrollbar{width: 8px;height: 8px;background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-track{background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-thumb{background-color: #444;border-radius: 4px;}.webodf-hyperlinkTooltip {display: none;color: white;background-color: black;border-radius: 5px;box-shadow: 2px 2px 5px gray;padding: 3px;position: absolute;max-width: 210px;text-align: left;word-break: break-all;z-index: 16;}.webodf-hyperlinkTooltipText {display: block;font-weight: bold;}';
